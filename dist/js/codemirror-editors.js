function markHint(){var e=[],r=0,o=0,n=editor_js.getValue(),t=esprima.tokenize(n,{range:!0}),i=[].slice.call(arguments).map(function(e){return null===e?{canBeAnything:!0}:("string"==typeof e&&(e={value:e}),e)}),a=function(e,r){return!!e.canBeAnything||("value"in e?r.value===e.value:"type"in e?r.type==e.type:void 0)};t.forEach(function(n,t){var l=i[r];a(l,n)?(r++,l.highlight&&e.push(n),i.length==r&&(e.forEach(function(e){var r=editor_js.posFromIndex(e.range[0]),n=editor_js.posFromIndex(e.range[1]);0==o++&&editor_js.scrollIntoView(r),editor_js.markText(r,n,{className:"js-hint"})}),r=0)):(r=0,e=[])})}function readOnlyToken(){var e=[],r=0,o=0,n=editor_js.getValue(),t=esprima.tokenize(n,{range:!0}),i=[].slice.call(arguments).map(function(e){return null===e?{canBeAnything:!0}:("string"==typeof e&&(e={value:e}),e)}),a=function(e,r){return!!e.canBeAnything||("value"in e?r.value===e.value:"type"in e?r.type==e.type:void 0)};t.forEach(function(n,t){var l=i[r];a(l,n)?(r++,l.highlight&&e.push(n),i.length==r&&(e.forEach(function(e){var r=editor_js.posFromIndex(e.range[0]),n=editor_js.posFromIndex(e.range[1]);0==o++&&editor_js.scrollIntoView(r),editor_js.markText(r,n,{className:"js-read-only",readOnly:!0})}),r=0)):(r=0,e=[])})}function markJsErrorAtLine(e){console.log("Marking error at: "+e);var r={line:e-1,ch:0};editor_js.markText(r,{line:e,ch:0},{className:"js-error",clearOnEnter:!0}),editor_js.scrollIntoView(r)}function refreshPreview(){console.log("Refreshing view");var e=editor_js.getValue();if(CustomErrors.test(e))return!1;if("undefined"!=typeof esprima)try{esprima.parse(e)}catch(r){if(r.lineNumber)return markJsErrorAtLine(r.lineNumber),$("#errorModal p.error-text").text(r.description+" at line "+r.lineNumber),void $("#errorModal").foundation("reveal","open")}try{console.log("Eval js"),document.getElementById("preview").contentWindow.remove&&(document.getElementById("preview").contentWindow.eval(e+"//# sourceURL=user-level.js"),document.getElementById("preview").contentWindow.remove(),document.getElementById("preview").contentWindow.p5PlayRebind(),document.getElementById("preview").contentWindow.eval("new p5();"))}catch(o){StackTrace.fromError(o,{offline:!0,filter:function(e){return/user-level\.js/.test(e.fileName)}}).then(function(e){e.length&&markJsErrorAtLine(e[0].lineNumber)}),console.log("ERROR"),console.log(o),$("#errorModal p.error-text").text(o),$("#errorModal").foundation("reveal","open")}$("#preview").focus(),$("#preview").contents().find("canvas").focus()}function insertEditoTooltip(e,r,o){$("body").prepend('<span id="editor-tooltip" data-tooltip class="has-tip" title="'+e+'"></span>'),editor_js.addWidget({ch:o,line:r-1},$("#editor-tooltip")[0],!0),$(document).foundation("tooltip","reflow"),Foundation.libs.tooltip.showTip($("#editor-tooltip"))}var originalEditorContent="",editor_js=CodeMirror($("#js_editor")[0],{lineNumbers:!0,lineWrapping:!0,foldGutter:!0,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter"],mode:"javascript"});editor_js.on("changes",function(){editor_js.isClean()?$("#undo").prop("disabled",!0):$("#undo").prop("disabled",!1)});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpzL2NvZGVtaXJyb3ItZWRpdG9ycy5qcyJdLCJuYW1lcyI6WyJtYXJrSGludCIsImNhbmRpZGF0ZU1hcmtzIiwiY2FuZGlkYXRlSW5kZXgiLCJudW1IaWdobGlnaHRzIiwiY29kZSIsImVkaXRvcl9qcyIsImdldFZhbHVlIiwidG9rZW5zIiwiZXNwcmltYSIsInRva2VuaXplIiwicmFuZ2UiLCJwYXR0ZXJuIiwic2xpY2UiLCJjYWxsIiwiYXJndW1lbnRzIiwibWFwIiwiYXJnIiwiY2FuQmVBbnl0aGluZyIsInZhbHVlIiwicGF0dGVyblBhcnRNYXRjaGVzIiwicGF0dGVyblBhcnQiLCJ0b2tlbiIsInR5cGUiLCJmb3JFYWNoIiwiaSIsImhpZ2hsaWdodCIsInB1c2giLCJsZW5ndGgiLCJzdGFydCIsInBvc0Zyb21JbmRleCIsImVuZCIsInNjcm9sbEludG9WaWV3IiwibWFya1RleHQiLCJjbGFzc05hbWUiLCJyZWFkT25seVRva2VuIiwicmVhZE9ubHkiLCJtYXJrSnNFcnJvckF0TGluZSIsImxpbmUiLCJjb25zb2xlIiwibG9nIiwiY2giLCJjbGVhck9uRW50ZXIiLCJyZWZyZXNoUHJldmlldyIsImpzX2NvbnRlbnQiLCJDdXN0b21FcnJvcnMiLCJ0ZXN0IiwicGFyc2UiLCJlIiwibGluZU51bWJlciIsIiQiLCJ0ZXh0IiwiZGVzY3JpcHRpb24iLCJmb3VuZGF0aW9uIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsImNvbnRlbnRXaW5kb3ciLCJyZW1vdmUiLCJldmFsIiwicDVQbGF5UmViaW5kIiwiZXJyIiwiU3RhY2tUcmFjZSIsImZyb21FcnJvciIsIm9mZmxpbmUiLCJmaWx0ZXIiLCJzdGFja0ZyYW1lIiwiZmlsZU5hbWUiLCJ0aGVuIiwiZnJhbWVzIiwiZm9jdXMiLCJjb250ZW50cyIsImZpbmQiLCJpbnNlcnRFZGl0b1Rvb2x0aXAiLCJwcmVwZW5kIiwiYWRkV2lkZ2V0IiwiRm91bmRhdGlvbiIsImxpYnMiLCJ0b29sdGlwIiwic2hvd1RpcCIsIm9yaWdpbmFsRWRpdG9yQ29udGVudCIsIkNvZGVNaXJyb3IiLCJsaW5lTnVtYmVycyIsImxpbmVXcmFwcGluZyIsImZvbGRHdXR0ZXIiLCJndXR0ZXJzIiwibW9kZSIsIm9uIiwiaXNDbGVhbiIsInByb3AiXSwibWFwcGluZ3MiOiJBQW1CQSxRQUFTQSxZQUNQLEdBQUlDLE1BQ0FDLEVBQWlCLEVBQ2pCQyxFQUFnQixFQUNoQkMsRUFBT0MsVUFBVUMsV0FJakJDLEVBQVNDLFFBQVFDLFNBQVNMLEdBQU9NLE9BQU8sSUFFeENDLEtBQWFDLE1BQU1DLEtBQUtDLFdBQVdDLElBQUksU0FBU0MsR0FDbEQsTUFBWSxRQUFSQSxHQUFzQkMsZUFBZSxJQUN0QixnQkFBVCxLQUNSRCxHQUFPRSxNQUFPRixJQUVUQSxLQUVMRyxFQUFxQixTQUFTQyxFQUFhQyxHQUM3QyxRQUFJRCxFQUFZSCxnQkFDWixTQUFXRyxHQUNOQyxFQUFNSCxRQUFVRSxFQUFZRixNQUVqQyxRQUFVRSxHQUNMQyxFQUFNQyxNQUFRRixFQUFZRSxLQURuQyxRQUtGZixHQUFPZ0IsUUFBUSxTQUFTRixFQUFPRyxHQUM3QixHQUFJSixHQUFjVCxFQUFRVCxFQUV0QmlCLEdBQW1CQyxFQUFhQyxJQUNsQ25CLElBQ0lrQixFQUFZSyxXQUNkeEIsRUFBZXlCLEtBQUtMLEdBRWxCVixFQUFRZ0IsUUFBVXpCLElBQ3BCRCxFQUFlc0IsUUFBUSxTQUFTRixHQUM5QixHQUFJTyxHQUFRdkIsVUFBVXdCLGFBQWFSLEVBQU1YLE1BQU0sSUFDM0NvQixFQUFNekIsVUFBVXdCLGFBQWFSLEVBQU1YLE1BQU0sR0FFdEIsSUFBbkJQLEtBQ0ZFLFVBQVUwQixlQUFlSCxHQUUzQnZCLFVBQVUyQixTQUFTSixFQUFPRSxHQUN4QkcsVUFBVyxjQUdmL0IsRUFBaUIsS0FHbkJBLEVBQWlCLEVBQ2pCRCxRQU9OLFFBQVNpQyxpQkFDUCxHQUFJakMsTUFDQUMsRUFBaUIsRUFDakJDLEVBQWdCLEVBQ2hCQyxFQUFPQyxVQUFVQyxXQU1qQkMsRUFBU0MsUUFBUUMs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YkMsY0FBYyxFQUNkQyxZQUFZLEVBQ1pDLFNBQVUseUJBQTBCLHlCQUNwQ0MsS0FBTSxjQUlSL0UsV0FBVWdGLEdBQUcsVUFBVyxXQUNqQmhGLFVBQVVpRixVQUNickMsRUFBRSxTQUFTc0MsS0FBSyxZQUFXLEdBRTNCdEMsRUFBRSxTQUFTc0MsS0FBSyxZQUFXIiwiZmlsZSI6ImpzL2NvZGVtaXJyb3ItZWRpdG9ycy5qcyIsInNvdXJjZXNDb250ZW50IjpbInZhciBvcmlnaW5hbEVkaXRvckNvbnRlbnQgPSAnJztcblxudmFyIGVkaXRvcl9qcyA9IENvZGVNaXJyb3IoJCgnI2pzX2VkaXRvcicpWzBdLCB7XG4gIGxpbmVOdW1iZXJzOiB0cnVlLFxuICBsaW5lV3JhcHBpbmc6IHRydWUsXG4gIGZvbGRHdXR0ZXI6IHRydWUsXG4gIGd1dHRlcnM6IFtcIkNvZGVNaXJyb3ItbGluZW51bWJlcnNcIiwgXCJDb2RlTWlycm9yLWZvbGRndXR0ZXJcIl0sXG4gIG1vZGU6ICdqYXZhc2NyaXB0JyxcbiAgLy8gdGhlbWUgOiAnbW9ub2thaSdcbn0pO1xuXG5lZGl0b3JfanMub24oJ2NoYW5nZXMnLCBmdW5jdGlvbigpIHtcbiAgaWYgKCBlZGl0b3JfanMuaXNDbGVhbigpICkge1xuICAgICQoXCIjdW5kb1wiKS5wcm9wKFwiZGlzYWJsZWRcIix0cnVlKTtcbiAgfSBlbHNlIHtcbiAgICAkKFwiI3VuZG9cIikucHJvcChcImRpc2FibGVkXCIsZmFsc2UpO1xuICB9XG59KTtcblxuZnVuY3Rpb24gbWFya0hpbnQoLyogZXNwcmltYSB0b2tlbiBtYXRjaCBwYXR0ZXJuIC4uLiAqLykge1xuICB2YXIgY2FuZGlkYXRlTWFya3MgPSBbXTtcbiAgdmFyIGNhbmRpZGF0ZUluZGV4ID0gMDtcbiAgdmFyIG51bUhpZ2hsaWdodHMgPSAwO1xuICB2YXIgY29kZSA9IGVkaXRvcl9qcy5nZXRWYWx1ZSgpO1xuXG4gIC8vIEZvciBndWlkYW5jZSBvbiB3aGF0IHRoaXMgbWlnaHQgbG9vayBsaWtlIGluIHByYWN0aWNlLCBwbGF5IGFyb3VuZFxuICAvLyB3aXRoIGh0dHA6Ly9lc3ByaW1hLm9yZy9kZW1vL3BhcnNlLmh0bWwgYW5kIHNlbGVjdCB0aGUgXCJUb2tlbnNcIiB0YWIuXG4gIHZhciB0b2tlbnMgPSBlc3ByaW1hLnRva2VuaXplKGNvZGUsIHtyYW5nZTogdHJ1ZX0pO1xuXG4gIHZhciBwYXR0ZXJuID0gW10uc2xpY2UuY2FsbChhcmd1bWVudHMpLm1hcChmdW5jdGlvbihhcmcpIHtcbiAgICBpZiAoYXJnID09PSBudWxsKSByZXR1cm4ge2NhbkJlQW55dGhpbmc6IHRydWV9O1xuICAgIGlmICh0eXBlb2YoYXJnKSA9PSAnc3RyaW5nJykge1xuICAgICAgYXJnID0ge3ZhbHVlOiBhcmd9O1xuICAgIH1cbiAgICByZXR1cm4gYXJnO1xuICB9KTtcbiAgdmFyIHBhdHRlcm5QYXJ0TWF0Y2hlcyA9IGZ1bmN0aW9uKHBhdHRlcm5QYXJ0LCB0b2tlbikge1xuICAgIGlmIChwYXR0ZXJuUGFydC5jYW5CZUFueXRoaW5nKSByZXR1cm4gdHJ1ZTtcbiAgICBpZiAoJ3ZhbHVlJyBpbiBwYXR0ZXJuUGFydCkge1xuICAgICAgcmV0dXJuIHRva2VuLnZhbHVlID09PSBwYXR0ZXJuUGFydC52YWx1ZTtcbiAgICB9XG4gICAgaWYgKCd0eXBlJyBpbiBwYXR0ZXJuUGFydCkge1xuICAgICAgcmV0dXJuIHRva2VuLnR5cGUgPT0gcGF0dGVyblBhcnQudHlwZTtcbiAgICB9XG4gIH07XG5cbiAgdG9rZW5zLmZvckVhY2goZnVuY3Rpb24odG9rZW4sIGkpIHtcbiAgICB2YXIgcGF0dGVyblBhcnQgPSBwYXR0ZXJuW2NhbmRpZGF0ZUluZGV4XTtcblxuICAgIGlmIChwYXR0ZXJuUGFydE1hdGNoZXMocGF0dGVyblBhcnQsIHRva2VuKSkge1xuICAgICAgY2FuZGlkYXRlSW5kZXgrKztcbiAgICAgIGlmIChwYXR0ZXJuUGFydC5oaWdobGlnaHQpIHtcbiAgICAgICAgY2FuZGlkYXRlTWFya3MucHVzaCh0b2tlbik7XG4gICAgICB9XG4gICAgICBpZiAocGF0dGVybi5sZW5ndGggPT0gY2FuZGlkYXRlSW5kZXgpIHtcbiAgICAgICAgY2FuZGlkYXRlTWFya3MuZm9yRWFjaChmdW5jdGlvbih0b2tlbikge1xuICAgICAgICAgIHZhciBzdGFydCA9IGVkaXRvcl9qcy5wb3NGcm9tSW5kZXgodG9rZW4ucmFuZ2VbMF0pO1xuICAgICAgICAgIHZhciBlbmQgPSBlZGl0b3JfanMucG9zRnJvbUluZGV4KHRva2VuLnJhbmdlWzFdKTtcblxuICAgICAgICAgIGlmIChudW1IaWdobGlnaHRzKysgPT0gMCkge1xuICAgICAgICAgICAgZWRpdG9yX2pzLnNjcm9sbEludG9WaWV3KHN0YXJ0KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZWRpdG9yX2pzLm1hcmtUZXh0KHN0YXJ0LCBlbmQsIHtcbiAgICAgICAgICAgIGNsYXNzTmFtZTogJ2pzLWhpbnQnXG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgICBjYW5kaWRhdGVJbmRleCA9IDA7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGNhbmRpZGF0ZUluZGV4ID0gMDtcbiAgICAgIGNhbmRpZGF0ZU1hcmtzID0gW107XG4gICAgfVxuICB9KTtcbn1cblxuLy8gTWFrZSBpbmxpbmUgY2hhcnMgcmVhZG9ubHlcbi8vIFJldXNpbmcgbWFya0hpbnRcbmZ1bmN0aW9uIHJlYWRPbmx5VG9rZW4oLyogZXNwcmltYSB0b2tlbiBtYXRjaCBwYXR0ZXJuIC4uLiAqLykge1xuICB2YXIgY2FuZGlkYXRlTWFya3MgPSBbXTtcbiAgdmFyIGNhbmRpZGF0ZUluZGV4ID0gMDtcbiAgdmFyIG51bUhpZ2hsaWdodHMgPSAwO1xuICB2YXIgY29kZSA9IGVkaXRvcl9qcy5nZXRWYWx1ZSgpO1xuXG5cblxuICAvLyBGb3IgZ3VpZGFuY2Ugb24gd2hhdCB0aGlzIG1pZ2h0IGxvb2sgbGlrZSBpbiBwcmFjdGljZSwgcGxheSBhcm91bmRcbiAgLy8gd2l0aCBodHRwOi8vZXNwcmltYS5vcmcvZGVtby9wYXJzZS5odG1sIGFuZCBzZWxlY3QgdGhlIFwiVG9rZW5zXCIgdGFiLlxuICB2YXIgdG9rZW5zID0gZXNwcmltYS50b2tlbml6ZShjb2RlLCB7cmFuZ2U6IHRydWV9KTtcblxuICB2YXIgcGF0dGVybiA9IFtdLnNsaWNlLmNhbGwoYXJndW1lbnRzKS5tYXAoZnVuY3Rpb24oYXJnKSB7XG4gICAgaWYgKGFyZyA9PT0gbnVsbCkgcmV0dXJuIHtjYW5CZUFueXRoaW5nOiB0cnVlfTtcbiAgICBpZiAodHlwZW9mKGFyZykgPT0gJ3N0cmluZycpIHtcbiAgICAgIGFyZyA9IHt2YWx1ZTogYXJnfTtcbiAgICB9XG4gICAgcmV0dXJuIGFyZztcbiAgfSk7XG4gIHZhciBwYXR0ZXJuUGFydE1hdGNoZXMgPSBmdW5jdGlvbihwYXR0ZXJuUGFydCwgdG9rZW4pIHtcbiAgICBpZiAocGF0dGVyblBhcnQuY2FuQmVBbnl0aGluZykgcmV0dXJuIHRydWU7XG4gICAgaWYgKCd2YWx1ZScgaW4gcGF0dGVyblBhcnQpIHtcbiAgICAgIHJldHVybiB0b2tlbi52YWx1ZSA9PT0gcGF0dGVyblBhcnQudmFsdWU7XG4gICAgfVxuICAgIGlmICgndHlwZScgaW4gcGF0dGVyblBhcnQpIHtcbiAgICAgIHJldHVybiB0b2tlbi50eXBlID09IHBhdHRlcm5QYXJ0LnR5cGU7XG4gICAgfVxuICB9O1xuXG4gIHRva2Vucy5mb3JFYWNoKGZ1bmN0aW9uKHRva2VuLCBpKSB7XG4gICAgdmFyIHBhdHRlcm5QYXJ0ID0gcGF0dGVybltjYW5kaWRhdGVJbmRleF07XG5cbiAgICBpZiAocGF0dGVyblBhcnRNYXRjaGVzKHBhdHRlcm5QYXJ0LCB0b2tlbikpIHtcbiAgICAgIGNhbmRpZGF0ZUluZGV4Kys7XG4gICAgICBpZiAocGF0dGVyblBhcnQuaGlnaGxpZ2h0KSB7XG4gICAgICAgIGNhbmRpZGF0ZU1hcmtzLnB1c2godG9rZW4pO1xuICAgICAgfVxuICAgICAgaWYgKHBhdHRlcm4ubGVuZ3RoID09IGNhbmRpZGF0ZUluZGV4KSB7XG4gICAgICAgIGNhbmRpZGF0ZU1hcmtzLmZvckVhY2goZnVuY3Rpb24odG9rZW4pIHtcbiAgICAgICAgICB2YXIgc3RhcnQgPSBlZGl0b3JfanMucG9zRnJvbUluZGV4KHRva2VuLnJhbmdlWzBdKTtcbiAgICAgICAgICB2YXIgZW5kID0gZWRpdG9yX2pzLnBvc0Zyb21JbmRleCh0b2tlbi5yYW5nZVsxXSk7XG5cbiAgICAgICAgICBpZiAobnVtSGlnaGxpZ2h0cysrID09IDApIHtcbiAgICAgICAgICAgIGVkaXRvcl9qcy5zY3JvbGxJbnRvVmlldyhzdGFydCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVkaXRvcl9qcy5tYXJrVGV4dChzdGFydCwgZW5kLCB7XG4gICAgICAgICAgICBjbGFzc05hbWU6ICdqcy1yZWFkLW9ubHknLFxuICAgICAgICAgICAgcmVhZE9ubHk6IHRydWVcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIGNhbmRpZGF0ZUluZGV4ID0gMDtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgY2FuZGlkYXRlSW5kZXggPSAwO1xuICAgICAgY2FuZGlkYXRlTWFya3MgPSBbXTtcbiAgICB9XG4gIH0pO1xufVxuXG5mdW5jdGlvbiBtYXJrSnNFcnJvckF0TGluZShsaW5lKSB7XG4gIGNvbnNvbGUubG9nKFwiTWFya2luZyBlcnJvciBhdDogXCIgKyBsaW5lKTtcbiAgdmFyIHN0YXJ0ID0ge2xpbmU6IGxpbmUgLSAxLCBjaDogMH07XG4gIGVkaXRvcl9qcy5tYXJrVGV4dChzdGFydCwge2xpbmU6IGxpbmUsIGNoOiAwfSwge1xuICAgIGNsYXNzTmFtZTogJ2pzLWVycm9yJyxcbiAgICBjbGVhck9uRW50ZXI6IHRydWVcbiAgfSk7XG4gIGVkaXRvcl9qcy5zY3JvbGxJbnRvVmlldyhzdGFydCk7XG59XG5cbmZ1bmN0aW9uIHJlZnJlc2hQcmV2aWV3KCkge1xuICBjb25zb2xlLmxvZyhcIlJlZnJlc2hpbmcgdmlld1wiKTtcblxuICAvLyBFcnJvciBmZWVkYmFjayBmYWxsYmFja1xuICAvLyBUT0RPOiBDdXJyZW50bHkgY2F0Y2hpbmcgZXJyb3JzIHdpdGggZXNwcmltYSBhbmQgZXZhbC5cbiAgdmFyIGpzX2NvbnRlbnQgPSBlZGl0b3JfanMuZ2V0VmFsdWUoKTtcblxuICAvLyBUZXN0IGZvciBjdXN0b20gZmVlZGJhY2sgZmlyc3QgYW5kIGV4aXQgaWYgZm91bmQuIFxuICAvLyBFcnJvcnMgd2lsbCBiZSBkaXNwbGF5ZWQgdG8gdGhlIHVzZXIuXG4gIGlmKCBDdXN0b21FcnJvcnMudGVzdCgganNfY29udGVudCApICl7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIFxuICAvLyB2YXIgZXJyID0gQ3VzdG9tRXJyb3JzLnRlc3QoIGpzX2NvbnRlbnQgKTtcbiAgLy8gaWYoIGVyciApe1xuICAvLyAgIC8vIEN1c3RvbUVycm9ycy5kaXNwbGF5RXJyb3IoZXJyKTtcbiAgLy8gICByZXR1cm47XG4gIC8vIH1cblxuICBpZiAodHlwZW9mKGVzcHJpbWEpICE9PSAndW5kZWZpbmVkJykge1xuICAgIHRyeSB7XG4gICAgICBlc3ByaW1hLnBhcnNlKGpzX2NvbnRlbnQpO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIGlmIChlLmxpbmVOdW1iZXIpIHtcbiAgICAgICAgbWFya0pzRXJyb3JBdExpbmUoZS5saW5lTnVtYmVyKTtcblxuICAgICAgICAvLyBhbGVydChlLmRlc2NyaXB0aW9uICsgXCIgYXQgbGluZSBcIiArIGUubGluZU51bWJlcik7XG4gICAgICAgICQoJyNlcnJvck1vZGFsIHAuZXJyb3ItdGV4dCcpLnRleHQoIGUuZGVzY3JpcHRpb24gKyBcIiBhdCBsaW5lIFwiICsgZS5saW5lTnVtYmVyICk7XG4gICAgICAgICQoJyNlcnJvck1vZGFsJykuZm91bmRhdGlvbigncmV2ZWFsJywgJ29wZW4nKTtcblxuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLy9FcnJvciBjaGVja2luZyAocHJvdmlkZSB1c2VyIGZlZWRiYWNrKVxuICB0cnkge1xuICAgICBjb25zb2xlLmxvZyhcIkV2YWwganNcIik7XG5cbiAgICBpZiggZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3ByZXZpZXcnKS5jb250ZW50V2luZG93LnJlbW92ZSApe1xuICAgICAgLy9FdmFsIHRoZSBjb2RlIHRvIG92ZXJ3cml0ZSBleGlzdGluZyBmdW5jdGlvbi4gQWNjZXNzIHRoZSBpZnJhbWUgYnkgbmFtZVxuICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3ByZXZpZXcnKS5jb250ZW50V2luZG93LmV2YWwoanNfY29udGVudCArICcvLyMgc291cmNlVVJMPXVzZXItbGV2ZWwuanMnKTtcbiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcmV2aWV3JykuY29udGVudFdpbmRvdy5yZW1vdmUoKTtcbiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcmV2aWV3JykuY29udGVudFdpbmRvdy5wNVBsYXlSZWJpbmQoKTtcbiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcmV2aWV3JykuY29udGVudFdpbmRvdy5ldmFsKFwibmV3IHA1KCk7XCIpO1xuICAgIH1cbiAgICBcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgU3RhY2tUcmFjZS5mcm9tRXJyb3IoZXJyLCB7XG4gICAgICBvZmZsaW5lOiB0cnVlLFxuICAgICAgZmlsdGVyOiBmdW5jdGlvbihzdGFja0ZyYW1lKSB7XG4gICAgICAgIHJldHVybiAvdXNlci1sZXZlbFxcLmpzLy50ZXN0KHN0YWNrRnJhbWUuZmlsZU5hbWUpO1xuICAgICAgfVxuICAgIH0pLnRoZW4oZnVuY3Rpb24oZnJhbWVzKSB7XG4gICAgICBpZiAoZnJhbWVzLmxlbmd0aCkge1xuICAgICAgICBtYXJrSnNFcnJvckF0TGluZShmcmFtZXNbMF0ubGluZU51bWJlcik7XG4gICAgICB9XG4gICAgfSk7XG4gICAgICAvLyBSZWZlcmVuY2VFcnJvcjogYWxwaCBpcyBub3QgZGVmaW5lZFxuICAgICAgY29uc29sZS5sb2coXCJFUlJPUlwiKTtcbiAgICAgIGNvbnNvbGUubG9nKGVycik7XG4gICAgICBcbiAgICAgICQoJyNlcnJvck1vZGFsIHAuZXJyb3ItdGV4dCcpLnRleHQoIGVyciApO1xuICAgICAgJCgnI2Vycm9yTW9kYWwnKS5mb3VuZGF0aW9uKCdyZXZlYWwnLCAnb3BlbicpO1xuICAgICAgLy8gYWxlcnQoXCJNYWtlIHN1cmUgeW91J3ZlIGRlZmluZWQgeW91ciB2YXJpYWJsZSBiZWZvcmUgdHJ5aW5nIHRvIHVzZSBpdFwiKTtcbiAgfVxuXG4gIC8vIEdpdmUgZm9jdXMgdG8gZ2FtZVxuICAkKCcjcHJldmlldycpLmZvY3VzKCk7XG4gICQoJyNwcmV2aWV3JykuY29udGVudHMoKS5maW5kKCdjYW52YXMnKS5mb2N1cygpO1xufVxuXG5mdW5jdGlvbiBpbnNlcnRFZGl0b1Rvb2x0aXAodGV4dCwgbGluZSwgY2gpe1xuICAvLyAqKioqIEVYQU1QTEUgVVNFICoqKioqOlxuICAvLyBFRElUT1I6IGluc2VydFRvb2x0aXAoXCJMaW5lcyB0aGF0IGJlZ2luIHdpdGggJy8vJyBhcmUgY29tbWVudHMgYW5kIGNhbid0IGJlIHJlYWQgYnkgdGhlIGNvbXB1dGVyLlwiLCA0LCAwKTtcbiAgXG4gIC8vIENyZWF0ZSBhIG5ldyB0b29sdGlwXG4gIC8vIFVwZGF0aW5nIHRoZSB0aXRsZSBwcm9wZXJ0eSBvZiB0aGUgdG9vbHRpcCBpcyBwcm9ibGVtYXRpYyBhZnRlciBmb3VuZGF0aW9uLFxuICAvLyBzbyB3ZSBjcmVhdGUgYSBuZXcgb25lIGV2ZXJ5IHRpbWUuIFdlIGFsc28gZGVsZXRlIHRoZSB0b29sdGlwIHdoZW4gaXRzIGNsaWNrZWQgdG8gY2xvc2UuXG4gIC8vIFRPT0Q6IEltcHJvdmUgdG8gaGF2ZSBhIHNpbmdsZSB0b29sdGlwP1xuICAkKCdib2R5JykucHJlcGVuZCgnPHNwYW4gaWQ9XCJlZGl0b3ItdG9vbHRpcFwiIGRhdGEtdG9vbHRpcCBjbGFzcz1cImhhcy10aXBcIiB0aXRsZT1cIicrdGV4dCsnXCI+PC9zcGFuPicpO1xuICBcbiAgLy8gV2lkZ2V0IGdldHMgaW5zZXJ0ZWQgb25lIGxpbmUgYmVsb3cuIFVzZSBsaW5lIC0gMSB0byBhY2NvdW50IGZvciB0aGlzXG4gIGVkaXRvcl9qcy5hZGRXaWRnZXQoe2NoOiBjaCAsIGxpbmU6IGxpbmUtMX0sICQoJyNlZGl0b3ItdG9vbHRpcCcpWzBdLCB0cnVlKTtcblxuICAkKGRvY3VtZW50KS5mb3VuZGF0aW9uKCd0b29sdGlwJywgJ3JlZmxvdycpO1xuICBGb3VuZGF0aW9uLmxpYnMudG9vbHRpcC5zaG93VGlwKCAkKCcjZWRpdG9yLXRvb2x0aXAnKSApO1xuXG59XG4iXX0=
