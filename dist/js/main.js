function startWalkthrough(){$(document).foundation("joyride","start",{pre_ride_callback:function(){$("#showHints").css("display","block"),$("#previous").css("display","block"),$("#next").css("display","block")},pre_step_callback:function(){console.log(this.$target.first().attr("id")),"preview"==this.$target.first().attr("id")?$("iframe").contents().find("canvas").addClass("joyride-highlight"):this.$target.first().addClass("joyride-highlight")},post_step_callback:function(){"preview"==this.$target.first().attr("id")?$("iframe").contents().find("canvas").removeClass("joyride-highlight"):this.$target.first().removeClass("joyride-highlight")},post_ride_callback:function(){console.log("JOYRIDE CLOSED"),$("#showHints").css("display","none"),$("#previous").css("display","none"),$("#next").css("display","none")},abort_on_close:!1})}function levelSelectMenu(){$("#levelSelectMenuModal").foundation("reveal","open")}function skipToLevel(e){return $("#levelSelectMenuModal").foundation("reveal","close"),"sandbox"==e?(storage.set("skipToSandbox",!0),void loadMiniCourse()):(currentLevel=e,void loadMiniCourse())}function revertMiniCourse(){loadMiniCourse(refreshPreview)}function publishPrompt(){$("#publishModal").foundation("reveal","open")}function undo(){editor_js.undo()}function publish(){console.log("PARENT PUBLISH"),generatedHTML=null,MinicoursePublisher.generateHTML({baseURL:"./mini/",baseLevel:maxLevel,js:editor_js.getValue(),formInfo:'<span id="first_name">'+$("#first_name").val().charAt(0).toUpperCase()+$("#first_name").val().slice(1)+'</span> from <span id="school">'+$("#00NU0000005PN7e").val()+'</span><span id="grade" style="display: none;">'+$("#grade").val()+'</span><span id="city" style="display: none;">'+$("#city").val()+'</span><span id="state" style="display: none;">'+$("#state").val()+'</span><span id="country" style="display: none;">'+$("#country").val()+"</span>"},function(e,n){if(e)return void alert("Error generating published HTML: "+e.message);if(generatedHTML=n,console.log("GENERATED HTML"),console.log(generatedHTML),!generatedHTML)return void alert("There was an error publishing your game. Please try again later!");$("#published").hide(),$("#publishing").fadeIn();var o;o=window.location.hostname.indexOf("code.globaloria.com")>-1?"http://globaloria.com:8000/":window.location.hostname.indexOf("makequest.globaloria.com")>-1?"https://publish.globaloria.com/":"https://publish-dev.herokuapp.com/",$.ajax({type:"POST",url:o+"publish",data:{html:generatedHTML},crossDomain:!0,dataType:"json",error:function(e,n,o){alert("It looks like something went wrong. Please verify your internet connection and click Publish again."),console.log(arguments),ga("send","event","Ajax Error",n,"publisher",{nonInteraction:1})},success:function(e){var n=e["published-url"];language&&"es"==language&&(n+="?lang=es"),$("#published").fadeIn().find("a").attr("href",n).text(n)},complete:function(){$("#publishing").hide()}})})}function loadMiniCourse(cb){cb=cb||function(){},console.log("Loading mini course template");var zeroPaddedLevel=currentLevel<10?"0"+currentLevel:currentLevel;"true"==storage.get("skipToSandbox")?(zeroPaddedLevel=maxLevel,$("#levelMenu").css("display","none")):$("#levelMenu").css("display","block");var codeUrl="mini/"+languagePath+"levels/"+zeroPaddedLevel+".js";remixUrl&&"true"==storage.get("skipToSandbox")&&(codeUrl=window.location.href.match(/code.globaloria.com/)?"http://mycode.globaloria.com/"+remixUrl[1]:window.location.href.match(/makequest.globaloria.com/)?"https://mymakequest.globaloria.com/"+remixUrl[1]:"https://hackpub-publisher-dev.s3.amazonaws.com/"+remixUrl[1]),$.get(codeUrl,function(data){if(remixUrl){debug2=data;var remixCode=data.match(/<script id="published-level-code">([\s\S])+?<\/script>/g);remixCode&&(data=remixCode[0].replace('<script id="published-level-code">',"").replace("</script>",""),console.log("NEW DATA"),console.log(data))}var markHints=[],readOnlyTokens=[],readOnlyRanges=[],foldedRanges=[],currLineNumber=0,currIndentation=0,editorTooltips=[],editorCommands={markHint:function(){markHints.push(arguments)},readOnlyToken:function(){readOnlyTokens.push(arguments)},beginReadOnly:function(){readOnlyRanges.push([currLineNumber])},endReadOnly:function(){var e=readOnlyRanges[readOnlyRanges.length-1];e.push(currLineNumber)},beginCodeFold:function(e){foldedRanges.push({begin:currLineNumber,indentation:currIndentation,linkText:e||"Moreâ€¦"})},endCodeFold:function(){var e=foldedRanges[foldedRanges.length-1];e.end=currLineNumber},insertTooltip:function(){editorTooltips.push(arguments)}};console.log("Course retrieved: "),console.log(data),data=data.replace(/\r\n/g,"\n"),data=data.replace(/}\n*$/,"\n\n\n\n\n\n\n\n\n\n}\n"),data=data.split("\n").filter(function(line){var match=line.match(/(\s*)\/\/\s*EDITOR:(.*)/);if(!match)return currLineNumber++,!0;with(currIndentation=match[1],editorCommands)console.log("Executing editor command: "+match[2]),eval(match[2]);return!1}).join("\n"),originalEditorContent=data,editor_js.setValue(data),editor_js.markClean(),$("#undo").prop("disabled",!0),readOnlyRanges.push([0,1]),readOnlyRanges.push([editor_js.lineCount()-2,editor_js.lineCount()]),readOnlyRanges.forEach(function(e){editor_js.markText({line:e[0],ch:0},{line:e[1],ch:0},{className:"js-read-only",readOnly:!0})}),readOnlyTokens.forEach(function(e){readOnlyToken.apply(this,e)}),markHints.forEach(function(e){markHint.apply(this,e)}),$("#js_editor").removeClass("show-js-hints"),markHints.length?$("#showHints").show():$("#showHints").hide(),foldedRanges.forEach(function(e){var n={line:e.begin,ch:0},o=$('<span class="cm-comment">'+e.indentation+"// </span>");$('<span class="js-code-fold-link"></span>').text(e.linkText).appendTo(o),editor_js.foldCode(n,{widget:o[0],rangeFinder:function(o,t){return{from:n,to:{line:e.end-1,ch:editor_js.getLine(e.end-1).length}}}})}),editorTooltips.forEach(function(e){insertEditoTooltip.apply(this,e)}),cb()}),storage.set("currentLevel",currentLevel),document.getElementById("preview").contentWindow.location.reload()}function showHints(){$("#js_editor").addClass("show-js-hints"),$("#showHints").fadeOut()}function nextLevel(){currentLevel==maxLevel?maxLevel:currentLevel++,loadMiniCourse()}function prevLevel(){1==currentLevel?1:currentLevel--,loadMiniCourse()}for(var maxLevel=gameConstants.MAX_LEVEL,remixUrl=window.location.href.match(/remix=(.+)/),queryParams=window.location.search.substring(1).split("&"),language="",languagePath="",i=0;i<queryParams.length;i++)queryParams[i].indexOf("lang")>-1&&(language=queryParams[i].split("=")[1],languagePath=language+"/");$(document).ready(function(){storage.set("languagePath",languagePath),storage.set("skipToSandbox",!1),remixUrl&&storage.set("skipToSandbox",!0),$("main").css("height",window.innerHeight-36),remixUrl||startWalkthrough(),$(document).on("close.fndtn.reveal","#welcomeModal",function(){startWalkthrough()}),$(document).on("click",".joyride-close-tip",function(){console.log(this)});var e=0,n=window.location.search.match(/debugLevel=(\d+)/);n&&(e=parseInt(n[1])),window.sessionStorage.currentLevel=e,currentLevel=e,$instructions=$("#instructions"),$(document).on("click","span.tooltip",function(){Foundation.libs.tooltip.hide($("#editor-tooltip")),$(this).remove(),$("#editor-tooltip").remove()}),$(document).on("click","#signupButton",function(e){e.preventDefault(),console.log("signup"),console.log(this);var n=document.getElementById("sign_up_email").value,o=document.getElementById("sign_up_password").value;createUserAndLogin({email:n,password:o}),$("#signupModal").foundation("reveal","close")}),$(document).on("click","#logout",function(e){e.preventDefault(),console.log("logout"),console.log(this),logout()}),loadMiniCourse(refreshPreview),setTimeout(function(){console.log("REFRESH 2000"),refreshPreview()},2e3),$("iframe#preview").attr("src","mini/index.html").focus(),$("form #00NU0000005PN7j").on("change",function(){console.log($(this).prop("checked")),$(this).prop("checked")?($("#first_name").prop("disabled",!1),$("#email").prop("disabled",!1),$("#phone").prop("disabled",!1)):($("#first_name").val(""),$("#email").val(""),$("#phone").val(""),$("#first_name").prop("disabled",!0),$("#email").prop("disabled",!0),$("#phone").prop("disabled",!0))}),$("#publish-form").submit(function(e){return console.log("VALIDATING"),""==$("#00NU0000005PN7e").val()||""==$("#city").val()||""==$("#country").val()||""==$("#state").val()?(console.log("VALIDATION FAILED"),!1):(console.log("PUBLISHING"),publish(),e.preventDefault(),!1)})});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpzL21haW4uanMiXSwibmFtZXMiOlsic3RhcnRXYWxrdGhyb3VnaCIsIiQiLCJkb2N1bWVudCIsImZvdW5kYXRpb24iLCJwcmVfcmlkZV9jYWxsYmFjayIsImNzcyIsInByZV9zdGVwX2NhbGxiYWNrIiwiY29uc29sZSIsImxvZyIsInRoaXMiLCIkdGFyZ2V0IiwiZmlyc3QiLCJhdHRyIiwiY29udGVudHMiLCJmaW5kIiwiYWRkQ2xhc3MiLCJwb3N0X3N0ZXBfY2FsbGJhY2siLCJyZW1vdmVDbGFzcyIsInBvc3RfcmlkZV9jYWxsYmFjayIsImFib3J0X29uX2Nsb3NlIiwibGV2ZWxTZWxlY3RNZW51Iiwic2tpcFRvTGV2ZWwiLCJsZXZlbCIsInN0b3JhZ2UiLCJzZXQiLCJsb2FkTWluaUNvdXJzZSIsImN1cnJlbnRMZXZlbCIsInJldmVydE1pbmlDb3Vyc2UiLCJyZWZyZXNoUHJldmlldyIsInB1Ymxpc2hQcm9tcHQiLCJ1bmRvIiwiZWRpdG9yX2pzIiwicHVibGlzaCIsImdlbmVyYXRlZEhUTUwiLCJNaW5pY291cnNlUHVibGlzaGVyIiwiZ2VuZXJhdGVIVE1MIiwiYmFzZVVSTCIsImJhc2VMZXZlbCIsIm1heExldmVsIiwianMiLCJnZXRWYWx1ZSIsImZvcm1JbmZvIiwidmFsIiwiY2hhckF0IiwidG9VcHBlckNhc2UiLCJzbGljZSIsImVyciIsImh0bWwiLCJhbGVydCIsIm1lc3NhZ2UiLCJoaWRlIiwiZmFkZUluIiwid2luZG93IiwibG9jYXRpb24iLCJob3N0bmFtZSIsImluZGV4T2YiLCJhamF4IiwidHlwZSIsInVybCIsImRhdGEiLCJjcm9zc0RvbWFpbiIsImRhdGFUeXBlIiwiZXJyb3IiLCJ4aHIiLCJzdGF0dXMiLCJhcmd1bWVudHMiLCJnYSIsIm5vbkludGVyYWN0aW9uIiwic3VjY2VzcyIsImxhbmd1YWdlIiwidGV4dCIsImNvbXBsZXRlIiwiY2IiLCJ6ZXJvUGFkZGVkTGV2ZWwiLCJnZXQiLCJjb2RlVXJsIiwibGFuZ3VhZ2VQYXRoIiwicmVtaXhVcmwiLCJocmVmIiwibWF0Y2giLCJkZWJ1ZzIiLCJyZW1peENvZGUiLCJyZXBsYWNlIiwibWFya0hpbnRzIiwicmVhZE9ubHlUb2tlbnMiLCJyZWFkT25seVJhbmdlcyIsImZvbGRlZFJhbmdlcyIsImN1cnJMaW5lTnVtYmVyIiwiY3VyckluZGVudGF0aW9uIiwiZWRpdG9yVG9vbHRpcHMiLCJlZGl0b3JDb21tYW5kcyIsIm1hcmtIaW50IiwicHVzaCIsInJlYWRPbmx5VG9rZW4iLCJiZWdpblJlYWRPbmx5IiwiZW5kUmVhZE9ubHkiLCJjdXJyUmFuZ2UiLCJsZW5ndGgiLCJiZWdpbkNvZGVGb2xkIiwibGlua1RleHQiLCJiZWdpbiIsImluZGVudGF0aW9uIiwiZW5kQ29kZUZvbGQiLCJlbmQiLCJpbnNlcnRUb29sdGlwIiwic3BsaXQiLCJmaWx0ZXIiLCJsaW5lIiwiZXZhbCIsImpvaW4iLCJvcmlnaW5hbEVkaXRvckNvbnRlbnQiLCJzZXRWYWx1ZSIsIm1hcmtDbGVhbiIsInByb3AiLCJsaW5lQ291bnQiLCJmb3JFYWNoIiwicmFuZ2UiLCJtYXJrVGV4dCIsImNoIiwiY2xhc3NOYW1lIiwicmVhZE9ubHkiLCJhcHBseSIsInNob3ciLCJzdGFydCIsInNwYW4iLCJhcHBlbmRUbyIsImZvbGRDb2RlIiwid2lkZ2V0IiwicmFuZ2VGaW5kZXIiLCJjbSIsInBvcyIsImZyb20iLCJ0byIsImdldExpbmUiLCJpbnNlcnRFZGl0b1Rvb2x0aXAiLCJnZXRFbGVtZW50QnlJZCIsImNvbnRlbnRXaW5kb3ciLCJyZWxvYWQiLCJzaG93SGludHMiLCJmYWRlT3V0IiwibmV4dExldmVsIiwicHJldkxldmVsIiwiZ2FtZUNvbnN0YW50cyIsIk1BWF9MRVZFTCIsInF1ZXJ5UGFyYW1zIiwic2VhcmNoIiwic3Vic3RyaW5nIiwiaSIsInJlYWR5IiwiaW5uZXJIZWlnaHQiLCJvbiIsInN0YXJ0TGV2ZWwiLCJkZWJ1Z0xldmVsIiwicGFyc2VJbnQiLCJzZXNzaW9uU3RvcmFnZSIsIiRpbnN0cnVjdGlvbnMiLCJGb3VuZGF0aW9uIiwibGlicyIsInRvb2x0aXAiLCJyZW1vdmUiLCJlIiwicHJldmVudERlZmF1bHQiLCJlbWFpbCIsInZhbHVlIiwicGFzc3dvcmQiLCJjcmVhdGVVc2VyQW5kTG9naW4iLCJsb2dvdXQiLCJzZXRUaW1lb3V0IiwiZm9jdXMiLCJzdWJtaXQiLCJldmVudCJdLCJtYXBwaW5ncyI6IkFBOEpBLFFBQVNBLG9CQUNMQyxFQUFFQyxVQUFVQyxXQUFXLFVBQVcsU0FFOUJDLGtCQUF5QixXQUVDSCxFQUFFLGNBQWNJLElBQUksVUFBVyxTQUMvQkosRUFBRSxhQUFhSSxJQUFJLFVBQVcsU0FDOUJKLEVBQUUsU0FBU0ksSUFBSSxVQUFXLFVBRXBEQyxrQkFBeUIsV0FDQ0MsUUFBUUMsSUFBSUMsS0FBS0MsUUFBUUMsUUFBUUMsS0FBSyxPQUNBLFdBQW5DSCxLQUFLQyxRQUFRQyxRQUFRQyxLQUFLLE1BQzNCWCxFQUFFLFVBQVVZLFdBQVdDLEtBQUssVUFBVUMsU0FBUyxxQkFFL0NOLEtBQUtDLFFBQVFDLFFBQVFJLFNBQVMsc0JBRzFEQyxtQkFBeUIsV0FDdUMsV0FBbkNQLEtBQUtDLFFBQVFDLFFBQVFDLEtBQUssTUFDM0JYLEVBQUUsVUFBVVksV0FBV0MsS0FBSyxVQUFVRyxZQUFZLHFCQUVsRFIsS0FBS0MsUUFBUUMsUUFBUU0sWUFBWSxzQkFHN0RDLG1CQUF5QixXQUNEWCxRQUFRQyxJQUFJLGtCQUVWUCxFQUFFLGNBQWNJLElBQUksVUFBVyxRQUMvQkosRUFBRSxhQUFhSSxJQUFJLFVBQVcsUUFDOUJKLEVBQUUsU0FBU0ksSUFBSSxVQUFXLFNBRXBEYyxnQkFBMkIsSUFJbkMsUUFBU0MsbUJBQ1BuQixFQUFFLHlCQUF5QkUsV0FBVyxTQUFVLFFBR2xELFFBQVNrQixhQUFZQyxHQUdqQixNQUZBckIsR0FBRSx5QkFBeUJFLFdBQVcsU0FBVSxTQUVwQyxXQUFUbUIsR0FDQ0MsUUFBUUMsSUFBSSxpQkFBaUIsT0FDN0JDLG9CQUlKQyxhQUFlSixNQUNmRyxtQkFHSixRQUFTRSxvQkFDTEYsZUFB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UUMsSUFBSSxVQUNaRCxRQUFRQyxJQUFJQyxNQUVaNkosV0FHSjdJLGVBQWVHLGdCQUlmMkksV0FBVyxXQUNQaEssUUFBUUMsSUFBSSxnQkFDWm9CLGtCQUNELEtBR0gzQixFQUFFLGtCQUFrQlcsS0FBSyxNQUFPLG1CQUFtQjRKLFFBSW5EdkssRUFBRSx5QkFBeUJxSixHQUFHLFNBQVUsV0FDcEMvSSxRQUFRQyxJQUFLUCxFQUFFUSxNQUFNd0csS0FBSyxZQUN0QmhILEVBQUVRLE1BQU13RyxLQUFLLFlBQ2JoSCxFQUFFLGVBQWVnSCxLQUFLLFlBQVksR0FFbENoSCxFQUFFLFVBQVVnSCxLQUFLLFlBQVksR0FDN0JoSCxFQUFFLFVBQVVnSCxLQUFLLFlBQVksS0FFN0JoSCxFQUFFLGVBQWV5QyxJQUFJLElBRXJCekMsRUFBRSxVQUFVeUMsSUFBSSxJQUNoQnpDLEVBQUUsVUFBVXlDLElBQUksSUFFaEJ6QyxFQUFFLGVBQWVnSCxLQUFLLFlBQVksR0FFbENoSCxFQUFFLFVBQVVnSCxLQUFLLFlBQVksR0FDN0JoSCxFQUFFLFVBQVVnSCxLQUFLLFlBQVksTUFJckNoSCxFQUFFLGlCQUFpQndLLE9BQU8sU0FBU0MsR0FHL0IsTUFGQW5LLFNBQVFDLElBQUksY0FFdUIsSUFBL0JQLEVBQUUsb0JBQW9CeUMsT0FDQyxJQUFwQnpDLEVBQUUsU0FBU3lDLE9BQ1ksSUFBdkJ6QyxFQUFFLFlBQVl5QyxPQUNPLElBQXJCekMsRUFBRSxVQUFVeUMsT0FFZm5DLFFBQVFDLElBQUksc0JBQ0wsSUFNWEQsUUFBUUMsSUFBSSxjQUNad0IsVUFDQTBJLEVBQU1ULGtCQUNDIiwiZmlsZSI6ImpzL21haW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgbWF4TGV2ZWwgPSBnYW1lQ29uc3RhbnRzLk1BWF9MRVZFTDtcbi8vIENoZWNrIGlmIHdlJ3JlIGFjY2Vzc2luZyBhIHJlbWl4IHVybCwgaWYgc28sIHN0b3JlIHRoZSB1cmwgZm9yIGxhdGVyIHVzZVxudmFyIHJlbWl4VXJsID0gd2luZG93LmxvY2F0aW9uLmhyZWYubWF0Y2goL3JlbWl4PSguKykvKTtcblxuLy8gU2V0IGxhbmd1YWdlXG52YXIgcXVlcnlQYXJhbXMgPSB3aW5kb3cubG9jYXRpb24uc2VhcmNoLnN1YnN0cmluZygxKS5zcGxpdCgnJicpO1xuLy8gRGVmYXVsdCB0byBlbmdsaXNoID0+ICcnXG52YXIgbGFuZ3VhZ2UgPSAnJztcbnZhciBsYW5ndWFnZVBhdGggPSAnJztcbmZvciAodmFyIGkgPSAwOyBpIDwgcXVlcnlQYXJhbXMubGVuZ3RoOyBpKyspIHtcbiAgICBpZihxdWVyeVBhcmFtc1tpXS5pbmRleE9mKCdsYW5nJyk+LTEpe1xuICAgICAgbGFuZ3VhZ2UgPSBxdWVyeVBhcmFtc1tpXS5zcGxpdCgnPScpWzFdO1xuICAgICAgbGFuZ3VhZ2VQYXRoID0gbGFuZ3VhZ2UrJy8nO1xuICAgIH1cbn1cblxuJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7XG4gICAgLy8gU2V0IGxhbmd1YWdlIGluIHN0b3JhZ2VcbiAgICBzdG9yYWdlLnNldCgnbGFuZ3VhZ2VQYXRoJywgbGFuZ3VhZ2VQYXRoKTtcbiAgICBcbiAgICAvLyBEb24ndCBzdGFydCBpbiBzYW5kYm94IGlmIHRoZSBwYWdlIGlzIHJlZnJlc2hlZCBhbmQgd2UncmUgbm90IGluIHJlbWl4IG1vZGVcbiAgICBzdG9yYWdlLnNldCgnc2tpcFRvU2FuZGJveCcsIGZhbHNlKTtcbiAgICBpZihyZW1peFVybCl7XG4gICAgICAgIHN0b3JhZ2Uuc2V0KCdza2lwVG9TYW5kYm94JywgdHJ1ZSk7XG4gICAgfVxuXG4gICAgLy9SZXNpemUgdG8gdmlld3BvcnRcbiAgICAkKFwibWFpblwiKS5jc3MoXCJoZWlnaHRcIiwgd2luZG93LmlubmVySGVpZ2h0LTM2KTtcblxuICAgIFxuXG4gICAgLy9PcGVuIHdlbGNvbWUgbW9kYWwgb24gZmlyc3QgbG9hZFxuICAgIC8vIGNvZGUuZ2xvYmFsb3JpYS5jb20gb25seVxuICAgIC8vICQoJyN3ZWxjb21lTW9kYWwnKS5mb3VuZGF0aW9uKCdyZXZlYWwnLCAnb3BlbicpO1xuICAgIFxuICAgIC8vT3BlbiB3YWxrdGhyb3VnaCBvbiBmaXJzdCBsb2FkXG4gICAgLy8gbWFrZXF1ZXN0Lmdsb2JhbG9yaWEuY29tIG9ubHlcbiAgICBpZiggIXJlbWl4VXJsICl7XG4gICAgICAgIHN0YXJ0V2Fsa3Rocm91Z2goKTtcbiAgICB9XG5cblxuXG5cbiAgICAvLyBJbml0IGpveXJpZGUgYWZ0ZXIgV2VsY29tZSBNb2RhbFxuICAgICQoZG9jdW1lbnQpLm9uKCdjbG9zZS5mbmR0bi5yZXZlYWwnLCAnI3dlbGNvbWVNb2RhbCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgIFxuICAgICAgICBzdGFydFdhbGt0aHJvdWdoKCk7XG4gICAgICBcbiAgICB9KTtcbiAgICAkKGRvY3VtZW50KS5vbignY2xpY2snLCAnLmpveXJpZGUtY2xvc2UtdGlwJywgZnVuY3Rpb24oKXtcbiAgICAgIGNvbnNvbGUubG9nKHRoaXMpO1xuICAgIH0pO1xuXG5cbiAgICB2YXIgc3RhcnRMZXZlbCA9IDA7XG4gICAgdmFyIGRlYnVnTGV2ZWwgPSB3aW5kb3cubG9jYXRpb24uc2VhcmNoLm1hdGNoKC9kZWJ1Z0xldmVsPShcXGQrKS8pO1xuXG4gICAgaWYgKGRlYnVnTGV2ZWwpIHtcbiAgICAgICAgc3RhcnRMZXZlbCA9IHBhcnNlSW50KGRlYnVnTGV2ZWxbMV0pO1xuICAgIH1cblxuXG4gICAgLy9SZXNldCBzZXNzaW9uU3RvcmFnZSB0byBrZWVwIGVkaXRvciBhbmQgaWZyYW1lIGluIHN5bmNcbiAgICB3aW5kb3cuc2Vzc2lvblN0b3JhZ2VbJ2N1cnJlbnRMZXZlbCddID0gc3RhcnRMZXZlbDtcblxuICAgIGN1cnJlbnRMZXZlbCA9IHN0YXJ0TGV2ZWw7XG5cbiAgICAkaW5zdHJ1Y3Rpb25zID0gJChcIiNpbnN0cnVjdGlvbnNcIik7XG5cbiAgICAvL1JlbW92ZSB0b29sdGlwcyBmcm9tIGNvZGUgZWRpdG9yXG4gICAgJChkb2N1bWVudCkub24oJ2NsaWNrJywgJ3NwYW4udG9vbHRpcCcsIGZ1bmN0aW9uKCl7XG4gICAgICAgIEZvdW5kYXRpb24ubGlicy50b29sdGlwLmhpZGUoICQoJyNlZGl0b3ItdG9vbHRpcCcpICk7XG4gICAgICAgICQodGhpcykucmVtb3ZlKCk7XG4gICAgICAgICQoJyNlZGl0b3ItdG9vbHRpcCcpLnJlbW92ZSgpO1xuICAgIH0pO1xuXG4gICAgJChkb2N1bWVudCkub24oJ2NsaWNrJywgJyNzaWdudXBCdXR0b24nLCBmdW5jdGlvbihlKSB7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgY29uc29sZS5sb2coXCJzaWdudXBcIik7XG4gICAgICAgIGNvbnNvbGUubG9nKHRoaXMpO1xuICAgICAgICBcbiAgICAgICAgdmFyIGVtYWlsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NpZ25fdXBfZW1haWwnKS52YWx1ZTtcbiAgICAgICAgdmFyIHBhc3N3b3JkID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NpZ25fdXBfcGFzc3dvcmQnKS52YWx1ZTtcblxuICAgICAgICBjcmVhdGVVc2VyQW5kTG9naW4oe1xuICAgICAgICAgICAgZW1haWw6IGVtYWlsLFxuICAgICAgICAgICAgcGFzc3dvcmQ6IHBhc3N3b3JkXG4gICAgICAgIH0pO1xuICAgICAgICBcblxuICAgICAgICAkKCcjc2lnbnVwTW9kYWwnKS5mb3VuZGF0aW9uKCdyZXZlYWwnLCAnY2xvc2UnKTtcbiAgICB9KTtcblxuICAgICQoZG9jdW1lbnQpLm9uKCdjbGljaycsICcjbG9nb3V0JywgZnVuY3Rpb24oZSkge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGNvbnNvbGUubG9nKFwibG9nb3V0XCIpO1xuICAgICAgICBjb25zb2xlLmxvZyh0aGlzKTtcblxuICAgICAgICBsb2dvdXQoKTtcbiAgICB9KTtcblxuICAgIGxvYWRNaW5pQ291cnNlKHJlZnJlc2hQcmV2aWV3KTtcblxuICAgIC8vIEZpeCB0aGlzIHVnbHkgaGFjayBzbyB0aGF0IHRoZSBnYW1lIGlzIGRpc3BsYXllZCBjb3JyZWN0bHkgd2hlbiByZW1peGluZy5cbiAgICAvLyBDdXJyZW50bHkgaGF2ZSB0byBoaXQgUnVuIHdoZW4gb3BlbmluZyBmb3IgUmVtaXggb3IgdXNlIHRoaXMgdGltZW91dCBjYWxsOiBcbiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiUkVGUkVTSCAyMDAwXCIpO1xuICAgICAgICByZWZyZXNoUHJldmlldygpO1xuICAgIH0sIDIwMDApO1xuXG4gICAgLy9TZXQgaWZyYW1lIHRvIHJpZ2h0IGxldmVsXG4gICAgJCgnaWZyYW1lI3ByZXZpZXcnKS5hdHRyKCdzcmMnLCAnbWluaS9pbmRleC5odG1sJykuZm9jdXMoKTtcblxuICAgIC8vIFB1Ymxpc2hpbmcgZm9ybSBzdWJtaXNzaW9uXG4gICAgLy9pcy1hZHVsdFxuICAgICQoJ2Zvcm0gIzAwTlUwMDAwMDA1UE43aicpLm9uKCdjaGFuZ2UnLCBmdW5jdGlvbigpe1xuICAgICAgICBjb25zb2xlLmxvZyggJCh0aGlzKS5wcm9wKCdjaGVja2VkJykgKTtcbiAgICAgICAgaWYoICQodGhpcykucHJvcCgnY2hlY2tlZCcpICl7XG4gICAgICAgICAgICAkKCcjZmlyc3RfbmFtZScpLnByb3AoJ2Rpc2FibGVkJywgZmFsc2UpO1xuICAgICAgICAgICAgLy8gJCgnI2xhc3RfbmFtZScpLnByb3AoJ2Rpc2FibGVkJywgZmFsc2UpO1xuICAgICAgICAgICAgJCgnI2VtYWlsJykucHJvcCgnZGlzYWJsZWQnLCBmYWxzZSk7XG4gICAgICAgICAgICAkKCcjcGhvbmUnKS5wcm9wKCdkaXNhYmxlZCcsIGZhbHNlKTtcbiAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAkKCcjZmlyc3RfbmFtZScpLnZhbCgnJyk7XG4gICAgICAgICAgICAvLyAkKCcjbGFzdF9uYW1lJykudmFsKCcnKTtcbiAgICAgICAgICAgICQoJyNlbWFpbCcpLnZhbCgnJyk7XG4gICAgICAgICAgICAkKCcjcGhvbmUnKS52YWwoJycpO1xuXG4gICAgICAgICAgICAkKCcjZmlyc3RfbmFtZScpLnByb3AoJ2Rpc2FibGVkJywgdHJ1ZSk7XG4gICAgICAgICAgICAvLyAkKCcjbGFzdF9uYW1lJykucHJvcCgnZGlzYWJsZWQnLCB0cnVlKTtcbiAgICAgICAgICAgICQoJyNlbWFpbCcpLnByb3AoJ2Rpc2FibGVkJywgdHJ1ZSk7XG4gICAgICAgICAgICAkKCcjcGhvbmUnKS5wcm9wKCdkaXNhYmxlZCcsIHRydWUpO1xuICAgICAgICB9XG4gICAgfSk7XG4gICAgXG4gICAgJCgnI3B1Ymxpc2gtZm9ybScpLnN1Ym1pdChmdW5jdGlvbihldmVudCkge1xuICAgICAgICBjb25zb2xlLmxvZyhcIlZBTElEQVRJTkdcIik7XG4gICAgICAgIC8vIEZvcm0gdmFsaWRhdGlvblxuICAgICAgICBpZiggJCgnIzAwTlUwMDAwMDA1UE43ZScpLnZhbCgpID09IFwiXCJcbiAgICAgICAgICAgIHx8ICQoJyNjaXR5JykudmFsKCkgPT0gXCJcIlxuICAgICAgICAgICAgfHwgJCgnI2NvdW50cnknKS52YWwoKSA9PSBcIlwiXG4gICAgICAgICAgICB8fCAkKCcjc3RhdGUnKS52YWwoKSA9PSBcIlwiXG4gICAgICAgICAgICApe1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJWQUxJREFUSU9OIEZBSUxFRFwiKTtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFByZXZlbnQgZm9ybSBzdWJtaXNzaW9uXG4gICAgICAgIC8vIFB1Ymxpc2ggZ2FtZSBhbmQgc2V0IHVybCBhcyB0aGUgcmV0dXJuIHBhcmFtZXRlciBmb3IgdGhlIGZvcm0uXG4gICAgICAgIC8vIFN1Ym1pdCB0aGUgZm9ybSBmcm9tIHB1Ymxpc2hcbiAgICAgICAgY29uc29sZS5sb2coXCJQVUJMSVNISU5HXCIpO1xuICAgICAgICBwdWJsaXNoKCk7XG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9KTtcbn0pO1xuXG5mdW5jdGlvbiBzdGFydFdhbGt0aHJvdWdoKCl7XG4gICAgJChkb2N1bWVudCkuZm91bmRhdGlvbignam95cmlkZScsICdzdGFydCcsIHtcbiAgICAgICAgXG4gICAgICAgIHByZV9yaWRlX2NhbGxiYWNrICAgICAgOiBmdW5jdGlvbiAoKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL0Rpc3BsYXkgYWxsIGJ1dHRvbnMgZm9yIGpveXJpZGVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKFwiI3Nob3dIaW50c1wiKS5jc3MoJ2Rpc3BsYXknLCAnYmxvY2snKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKFwiI3ByZXZpb3VzXCIpLmNzcygnZGlzcGxheScsICdibG9jaycpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoXCIjbmV4dFwiKS5jc3MoJ2Rpc3BsYXknLCAnYmxvY2snKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgcHJlX3N0ZXBfY2FsbGJhY2sgICAgICA6IGZ1bmN0aW9uICgpe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHRoaXMuJHRhcmdldC5maXJzdCgpLmF0dHIoJ2lkJykpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKHRoaXMuJHRhcmdldC5maXJzdCgpLmF0dHIoJ2lkJykgPT0gXCJwcmV2aWV3XCIpe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJChcImlmcmFtZVwiKS5jb250ZW50cygpLmZpbmQoXCJjYW52YXNcIikuYWRkQ2xhc3MoXCJqb3lyaWRlLWhpZ2hsaWdodFwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJHRhcmdldC5maXJzdCgpLmFkZENsYXNzKCdqb3lyaWRlLWhpZ2hsaWdodCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgcG9zdF9zdGVwX2NhbGxiYWNrICAgICA6IGZ1bmN0aW9uICgpe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKHRoaXMuJHRhcmdldC5maXJzdCgpLmF0dHIoJ2lkJykgPT0gXCJwcmV2aWV3XCIpe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJChcImlmcmFtZVwiKS5jb250ZW50cygpLmZpbmQoXCJjYW52YXNcIikucmVtb3ZlQ2xhc3MoXCJqb3lyaWRlLWhpZ2hsaWdodFwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJHRhcmdldC5maXJzdCgpLnJlbW92ZUNsYXNzKCdqb3lyaWRlLWhpZ2hsaWdodCcpOyAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgcG9zdF9yaWRlX2NhbGxiYWNrICAgICA6IGZ1bmN0aW9uICgpe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIkpPWVJJREUgQ0xPU0VEXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9EaXNwbGF5IGFsbCBidXR0b25zIGZvciBqb3lyaWRlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJChcIiNzaG93SGludHNcIikuY3NzKCdkaXNwbGF5JywgJ25vbmUnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKFwiI3ByZXZpb3VzXCIpLmNzcygnZGlzcGxheScsICdub25lJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJChcIiNuZXh0XCIpLmNzcygnZGlzcGxheScsICdub25lJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgIGFib3J0X29uX2Nsb3NlICAgICAgICAgICA6IGZhbHNlXG4gICAgICB9KTtcbn1cblxuZnVuY3Rpb24gbGV2ZWxTZWxlY3RNZW51KCl7XG4gICQoJyNsZXZlbFNlbGVjdE1lbnVNb2RhbCcpLmZvdW5kYXRpb24oJ3JldmVhbCcsICdvcGVuJyk7ICBcbn1cblxuZnVuY3Rpb24gc2tpcFRvTGV2ZWwobGV2ZWwpe1xuICAgICQoJyNsZXZlbFNlbGVjdE1lbnVNb2RhbCcpLmZvdW5kYXRpb24oJ3JldmVhbCcsICdjbG9zZScpO1xuXG4gICAgaWYobGV2ZWwgPT0gJ3NhbmRib3gnKXtcbiAgICAgICAgc3RvcmFnZS5zZXQoJ3NraXBUb1NhbmRib3gnLCB0cnVlKTtcbiAgICAgICAgbG9hZE1pbmlDb3Vyc2UoKTtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGN1cnJlbnRMZXZlbCA9IGxldmVsO1xuICAgIGxvYWRNaW5pQ291cnNlKCk7XG59XG5cbmZ1bmN0aW9uIHJldmVydE1pbmlDb3Vyc2UoKSB7XG4gICAgbG9hZE1pbmlDb3Vyc2UocmVmcmVzaFByZXZpZXcpO1xufVxuXG5mdW5jdGlvbiBwdWJsaXNoUHJvbXB0KCl7XG4gICQoJyNwdWJsaXNoTW9kYWwnKS5mb3VuZGF0aW9uKCdyZXZlYWwnLCAnb3BlbicpO1xufVxuXG5mdW5jdGlvbiB1bmRvKCl7XG4gICAgZWRpdG9yX2pzLnVuZG8oKTtcbn1cblxuZnVuY3Rpb24gcHVibGlzaCgpe1xuICBjb25zb2xlLmxvZyhcIlBBUkVOVCBQVUJMSVNIXCIpO1xuICBcbiAgZ2VuZXJhdGVkSFRNTCA9IG51bGw7XG4gIE1pbmljb3Vyc2VQdWJsaXNoZXIuZ2VuZXJhdGVIVE1MKHtcbiAgICBiYXNlVVJMOiAnLi9taW5pLycsXG4gICAgYmFzZUxldmVsOiBtYXhMZXZlbCxcbiAgICBqczogZWRpdG9yX2pzLmdldFZhbHVlKCksXG4gICAgZm9ybUluZm86ICc8c3BhbiBpZD1cImZpcnN0X25hbWVcIj4nKyAkKCcjZmlyc3RfbmFtZScpLnZhbCgpLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgJCgnI2ZpcnN0X25hbWUnKS52YWwoKS5zbGljZSgxKSArJzwvc3Bhbj4gZnJvbSA8c3BhbiBpZD1cInNjaG9vbFwiPicrJCgnIzAwTlUwMDAwMDA1UE43ZScpLnZhbCgpKyc8L3NwYW4+J1xuICAgICAgICAgICAgICArJzxzcGFuIGlkPVwiZ3JhZGVcIiBzdHlsZT1cImRpc3BsYXk6IG5vbmU7XCI+JyskKCcjZ3JhZGUnKS52YWwoKSsnPC9zcGFuPidcbiAgICAgICAgICAgICAgKyc8c3BhbiBpZD1cImNpdHlcIiBzdHlsZT1cImRpc3BsYXk6IG5vbmU7XCI+JyskKCcjY2l0eScpLnZhbCgpKyc8L3NwYW4+J1xuICAgICAgICAgICAgICArJzxzcGFuIGlkPVwic3RhdGVcIiBzdHlsZT1cImRpc3BsYXk6IG5vbmU7XCI+JyskKCcjc3RhdGUnKS52YWwoKSsnPC9zcGFuPidcbiAgICAgICAgICAgICAgKyc8c3BhbiBpZD1cImNvdW50cnlcIiBzdHlsZT1cImRpc3BsYXk6IG5vbmU7XCI+JyskKCcjY291bnRyeScpLnZhbCgpKyc8L3NwYW4+J1xuICB9LCBmdW5jdGlvbihlcnIsIGh0bWwpIHtcbiAgICBpZiAoZXJyKSB7XG4gICAgICBhbGVydChcIkVycm9yIGdlbmVyYXRpbmcgcHVibGlzaGVkIEhUTUw6IFwiICsgZXJyLm1lc3NhZ2UpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBcbiAgICBnZW5lcmF0ZWRIVE1MID0gaHRtbDtcbiAgICBjb25zb2xlLmxvZyhcIkdFTkVSQVRFRCBIVE1MXCIpO1xuICAgIGNvbnNvbGUubG9nKGdlbmVyYXRlZEhUTUwpO1xuXG4gICAgaWYgKCFnZW5lcmF0ZWRIVE1MKSB7XG4gICAgICBhbGVydChcIlRoZXJlIHdhcyBhbiBlcnJvciBwdWJsaXNoaW5nIHlvdXIgZ2FtZS4gUGxlYXNlIHRyeSBhZ2FpbiBsYXRlciFcIik7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIFxuICAgIC8vIEJlZ2luIHB1Ymxpc2hpbmdcbiAgICAkKFwiI3B1Ymxpc2hlZFwiKS5oaWRlKCk7XG4gICAgJChcIiNwdWJsaXNoaW5nXCIpLmZhZGVJbigpO1xuXG4gICAgLy8gUHVibGlzaCBldmVyeXRoaW5nIHRvIG15Y29kZSB1bnRpbCB3ZSBoYXZlIGEgc2Vjb25kIGJ1Y2tldCB3aXRoIENPUlMgZW5hYmxlZFxuICAgIC8vIHZhciBiYXNlVVJMID0gd2luZG93LmxvY2F0aW9uLmhvc3RuYW1lLmluZGV4T2YoJ2NvZGUuZ2xvYmFsb3JpYS5jb20nKSA+IC0xXG4gICAgLy8gICAgICAgICAgICAgICA/ICdodHRwOi8vZ2xvYmFsb3JpYS5jb206ODAwMC8nXG4gICAgLy8gICAgICAgICAgICAgICA6ICdodHRwczovL2hhY2twdWIuaGVyb2t1YXBwLmNvbS9idWNrZXRzL2dsb2JhbG9yaWEvJztcbiAgICB2YXIgYmFzZVVSTDtcbiAgICBpZiggd2luZG93LmxvY2F0aW9uLmhvc3RuYW1lLmluZGV4T2YoJ2NvZGUuZ2xvYmFsb3JpYS5jb20nKSA+IC0xICl7XG4gICAgICAgIGJhc2VVUkwgPSAnaHR0cDovL2dsb2JhbG9yaWEuY29tOjgwMDAvJztcbiAgICB9ZWxzZSBpZiggd2luZG93LmxvY2F0aW9uLmhvc3RuYW1lLmluZGV4T2YoJ21ha2VxdWVzdC5nbG9iYWxvcmlhLmNvbScpID4gLTEgKXtcbiAgICAgICAgLy8gYmFzZVVSTCA9ICdodHRwczovL2dsb2JhbG9yaWEuY29tOjgwMDEvJztcbiAgICAgICAgYmFzZVVSTCA9ICdodHRwczovL3B1Ymxpc2guZ2xvYmFsb3JpYS5jb20vJztcbiAgICB9ZWxzZXtcbiAgICAgICAgLy8gYmFzZVVSTCA9ICdodHRwczovL2hhY2twdWIuaGVyb2t1YXBwLmNvbS9idWNrZXRzL2dsb2JhbG9yaWEvJztcbiAgICAgICAgYmFzZVVSTCA9ICdodHRwczovL3B1Ymxpc2gtZGV2Lmhlcm9rdWFwcC5jb20vJztcbiAgICB9XG4gICAgXG4gICAgJC5hamF4KHtcbiAgICAgIHR5cGU6ICdQT1NUJyxcbiAgICAgIHVybDogYmFzZVVSTCArICdwdWJsaXNoJyxcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgJ2h0bWwnOiBnZW5lcmF0ZWRIVE1MXG4gICAgICB9LFxuICAgICAgY3Jvc3NEb21haW46IHRydWUsXG4gICAgICBkYXRhVHlwZTogJ2pzb24nLFxuICAgICAgZXJyb3I6IGZ1bmN0aW9uKHhociwgc3RhdHVzLCBlcnJvcikge1xuICAgICAgICBhbGVydChcIkl0IGxvb2tzIGxpa2Ugc29tZXRoaW5nIHdlbnQgd3JvbmcuIFBsZWFzZSB2ZXJpZnkgeW91ciBpbnRlcm5ldCBjb25uZWN0aW9uIGFuZCBjbGljayBQdWJsaXNoIGFnYWluLlwiKTtcbiAgICAgICAgY29uc29sZS5sb2coYXJndW1lbnRzKTtcblxuICAgICAgICAvLyBMb2cgZXJyb3IgdG8gZ2FcbiAgICAgICAgZ2EoJ3NlbmQnLCAnZXZlbnQnLCAnQWpheCBFcnJvcicsIHN0YXR1cywgJ3B1Ymxpc2hlcicsIHsgJ25vbkludGVyYWN0aW9uJzogMSB9KTtcbiAgICAgIH0sXG4gICAgICBzdWNjZXNzOiBmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgIHZhciB1cmwgPSBkYXRhWydwdWJsaXNoZWQtdXJsJ107XG4gICAgICAgIGlmKGxhbmd1YWdlICYmIGxhbmd1YWdlID09ICdlcycpe1xuICAgICAgICAgICAgdXJsICs9ICc/bGFuZz1lcyc7XG4gICAgICAgIH1cblxuICAgICAgICAkKFwiI3B1Ymxpc2hlZFwiKS5mYWRlSW4oKVxuICAgICAgICAgIC5maW5kKCdhJylcbiAgICAgICAgICAuYXR0cignaHJlZicsIHVybClcbiAgICAgICAgICAudGV4dCh1cmwpO1xuXG4gICAgICAgIC8vIERpc2FibGUgUHVibGlzaCBidXR0b24gdG8gYXZvaWQgcHVibGlzaGluZyBzcGFtXG4gICAgICAgIC8vICQoJ2J1dHRvblt0eXBlPVwic3VibWl0XCJdJykuYXR0cignZGlzYWJsZWQnLCAnZGlzYWJsZWQnKTtcblxuICAgICAgICAvLyBjb2RlLmdsb2JhbG9yaWEuY29tIE9OTFlcbiAgICAgICAgLy8gLy8gUmVwbGFjZSB0aGUgZm9ybSdzIHJldHVybiBVUkwgYW5kIHN1Ym1pdCB0aGUgZm9ybVxuICAgICAgICAvLyAkKCcjcHVibGlzaC1mb3JtIGlucHV0I3JldFVybCcpLnZhbCggZGF0YVsncHVibGlzaGVkLXVybCddICk7XG4gICAgICAgIFxuICAgICAgICAvLyAvLyBQb3B1bGF0ZSBnYW1lIGxpbmsgZm9yIHNhbGVzZm9yY2UgY2FwdHVyZVxuICAgICAgICAvLyAkKCcjMDBOVTAwMDAwMDVQTjd0JykudmFsKGRhdGFbJ3B1Ymxpc2hlZC11cmwnXSk7XG5cbiAgICAgICAgLy8gLy8gUG9wdWxhdGUgdGhlIHJvbGUgZmllbGQgZm9yIHNhbGVzZm9yY2VcbiAgICAgICAgLy8gdmFyIHJvbGUgPSBbXTtcbiAgICAgICAgLy8gaWYoICQoJyNpc1N0dWRlbnQnKS5wcm9wKCdjaGVja2VkJykgKSByb2xlLnB1c2goICQoJyNpc1N0dWRlbnQnKS52YWwoKSApO1xuICAgICAgICAvLyBpZiggJCgnI2lzVGVhY2hlcicpLnByb3AoJ2NoZWNrZWQnKSApIHJvbGUucHVzaCggJCgnI2lzVGVhY2hlcicpLnZhbCgpICk7XG4gICAgICAgIC8vIGlmKCAkKCcjaXNQYXJlbnQnKS5wcm9wKCdjaGVja2VkJykgKSByb2xlLnB1c2goICQoJyNpc1BhcmVudCcpLnZhbCgpICk7XG4gICAgICAgIC8vIGlmKCAkKCcjaXNBZG1pbmlzdHJhdG9yJykucHJvcCgnY2hlY2tlZCcpICkgcm9sZS5wdXNoKCAkKCcjaXNBZG1pbmlzdHJhdG9yJykudmFsKCkgKTtcbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgIC8vICQoJyMwME5VMDAwMDAwNVBoMksnKS52YWwoIHJvbGUuam9pbignLCcpICk7XG5cbiAgICAgICAgLy9VbmJpbmQgZm9ybSB0byBwcmV2ZW50IHN1Ym1pdCBsb29wXG4gICAgICAgIC8vICQoJyNwdWJsaXNoLWZvcm0nKS51bmJpbmQoKS5zdWJtaXQoKTtcblxuXG5cbiAgICAgICAgLy8gbWFrcXVlc3QuZ2xvYmFsb3JpYS5jb20gT05MWVxuICAgICAgICAvLyB3aW5kb3cubG9jYXRpb24uaHJlZiA9ICdkYXRhWydwdWJsaXNoZWQtdXJsJ10nO1xuXG5cblxuICAgICAgfSxcbiAgICAgIGNvbXBsZXRlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgJChcIiNwdWJsaXNoaW5nXCIpLmhpZGUoKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSk7XG59XG5cbmZ1bmN0aW9uIGxvYWRNaW5pQ291cnNlKGNiKXtcbiAgICBjYiA9IGNiIHx8IGZ1bmN0aW9uKCkge31cbiAgICBjb25zb2xlLmxvZyhcIkxvYWRpbmcgbWluaSBjb3Vyc2UgdGVtcGxhdGVcIik7XG4gICAgdmFyIHplcm9QYWRkZWRMZXZlbCA9IChjdXJyZW50TGV2ZWwgPCAxMCkgPyAnMCcgKyBjdXJyZW50TGV2ZWwgOiBjdXJyZW50TGV2ZWw7XG5cbiAgICAvLyBTa2lwIHRvIHNhbmRib3hcbiAgICBpZiggc3RvcmFnZS5nZXQoJ3NraXBUb1NhbmRib3gnKSA9PSAndHJ1ZScgKXtcbiAgICAgICAgemVyb1BhZGRlZExldmVsID0gbWF4TGV2ZWw7XG4gICAgICAgICQoXCIjbGV2ZWxNZW51XCIpLmNzcygnZGlzcGxheScsICdub25lJyk7XG4gICAgfWVsc2V7XG4gICAgICAgICQoXCIjbGV2ZWxNZW51XCIpLmNzcygnZGlzcGxheScsICdibG9jaycpO1xuICAgIH1cblxuICAgIHZhciBjb2RlVXJsID0gJ21pbmkvJytsYW5ndWFnZVBhdGgrJ2xldmVscy8nICsgemVyb1BhZGRlZExldmVsICsgJy5qcyc7XG5cbiAgICAvLyBMb2FkIHJlbWl4IGNvZGUgZm9yIHNhbmRib3ggd2hlbiBhdmFpbGFibGVcbiAgICBpZiggcmVtaXhVcmwgJiYgc3RvcmFnZS5nZXQoJ3NraXBUb1NhbmRib3gnKSA9PSAndHJ1ZScgKXtcbiAgICAgICAgLy8gUHVsbCBnYW1lIGZyb20gZGV2IG9yIGxpdmUgKENPUlMgaXMgY3VycmVudGx5IGJyZWFraW5nIHB1bGxzIGZyb20gZ2xvYmFsb3JpYS1kZXYuczMpXG4gICAgICAgIGlmKHdpbmRvdy5sb2NhdGlvbi5ocmVmLm1hdGNoKC9jb2RlLmdsb2JhbG9yaWEuY29tLykpe1xuICAgICAgICAgICAgY29kZVVybCA9ICdodHRwOi8vbXljb2RlLmdsb2JhbG9yaWEuY29tLycrcmVtaXhVcmxbMV07XG4gICAgICAgIH1lbHNlIGlmKHdpbmRvdy5sb2NhdGlvbi5ocmVmLm1hdGNoKC9tYWtlcXVlc3QuZ2xvYmFsb3JpYS5jb20vKSl7XG4gICAgICAgICAgICAvLyBOZWVkIHRvIHVzZSBmdWxsIGJ1Y2tldCBuYW1lLiBVc2luZyBteW1ha2VxdWVzdCB3aWxsIHRocm93IGFuIGVycm9yXG4gICAgICAgICAgICAvLyBjb2RlVXJsID0gJ2h0dHA6Ly9teW1ha2VxdWVzdC5nbG9iYWxvcmlhLnMzLXdlYnNpdGUtdXMtZWFzdC0xLmFtYXpvbmF3cy5jb20vJytyZW1peFVybFsxXTtcbiAgICAgICAgICAgIC8vIGNvZGVVcmwgPSAnaHR0cDovL215bWFrZXF1ZXN0Lmdsb2JhbG9yaWEuY29tLnMzLXdlYnNpdGUtdXMtZWFzdC0xLmFtYXpvbmF3cy5jb20vJytyZW1peFVybFsxXTtcbiAgICAgICAgICAgIGNvZGVVcmwgPSAnaHR0cHM6Ly9teW1ha2VxdWVzdC5nbG9iYWxvcmlhLmNvbS8nK3JlbWl4VXJsWzFdO1xuICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgIC8vIGNvZGVVcmwgPSAnaHR0cHM6Ly9nbG9iYWxvcmlhLWRldi5zMy5hbWF6b25hd3MuY29tLycrcmVtaXhVcmxbMV07XG4gICAgICAgICAgICBjb2RlVXJsID0gJ2h0dHBzOi8vaGFja3B1Yi1wdWJsaXNoZXItZGV2LnMzLmFtYXpvbmF3cy5jb20vJytyZW1peFVybFsxXTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgICQuZ2V0KGNvZGVVcmwsIGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgLy8gRXh0cmFjdCBlZGl0b3IgY29kZSBmcm9tIHRoZSBwdWJsaXNoZWQgSFRNTCBkb2N1bWVudFxuICAgICAgICBpZihyZW1peFVybCl7XG4gICAgICAgICAgICBkZWJ1ZzIgPSBkYXRhO1xuICAgICAgICAgICAgdmFyIHJlbWl4Q29kZSA9IGRhdGEubWF0Y2goLzxzY3JpcHQgaWQ9XCJwdWJsaXNoZWQtbGV2ZWwtY29kZVwiPihbXFxzXFxTXSkrPzxcXC9zY3JpcHQ+L2cpO1xuICAgICAgICAgICAgaWYocmVtaXhDb2RlKXtcbiAgICAgICAgICAgICAgICAvLyBEYXRhIHNob3VsZCBvbmx5IGJlIHRoZSBlZGl0b3Igc3BlY2lmaWMgY29kZSAoaS5lLiB0aGUgY2FwdHVyZWQgZ3JvdXApXG4gICAgICAgICAgICAgICAgZGF0YSA9IHJlbWl4Q29kZVswXS5yZXBsYWNlKCc8c2NyaXB0IGlkPVwicHVibGlzaGVkLWxldmVsLWNvZGVcIj4nLCAnJykucmVwbGFjZSgnPC9zY3JpcHQ+JywgJycpO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiTkVXIERBVEFcIik7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coZGF0YSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgbWFya0hpbnRzID0gW107XG4gICAgICAgIHZhciByZWFkT25seVRva2VucyA9IFtdO1xuICAgICAgICB2YXIgcmVhZE9ubHlSYW5nZXMgPSBbXTtcbiAgICAgICAgdmFyIGZvbGRlZFJhbmdlcyA9IFtdO1xuICAgICAgICB2YXIgY3VyckxpbmVOdW1iZXIgPSAwO1xuICAgICAgICB2YXIgY3VyckluZGVudGF0aW9uID0gMDtcbiAgICAgICAgdmFyIGVkaXRvclRvb2x0aXBzID0gW107XG4gICAgICAgIHZhciBlZGl0b3JDb21tYW5kcyA9IHtcbiAgICAgICAgICAgIG1hcmtIaW50OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBtYXJrSGludHMucHVzaChhcmd1bWVudHMpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJlYWRPbmx5VG9rZW46IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgcmVhZE9ubHlUb2tlbnMucHVzaChhcmd1bWVudHMpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGJlZ2luUmVhZE9ubHk6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHJlYWRPbmx5UmFuZ2VzLnB1c2goW2N1cnJMaW5lTnVtYmVyXSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZW5kUmVhZE9ubHk6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHZhciBjdXJyUmFuZ2UgPSByZWFkT25seVJhbmdlc1tyZWFkT25seVJhbmdlcy5sZW5ndGggLSAxXTtcbiAgICAgICAgICAgICAgICBjdXJyUmFuZ2UucHVzaChjdXJyTGluZU51bWJlcik7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgYmVnaW5Db2RlRm9sZDogZnVuY3Rpb24obGlua1RleHQpIHtcbiAgICAgICAgICAgICAgICBmb2xkZWRSYW5nZXMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgIGJlZ2luOiBjdXJyTGluZU51bWJlcixcbiAgICAgICAgICAgICAgICAgICAgaW5kZW50YXRpb246IGN1cnJJbmRlbnRhdGlvbixcbiAgICAgICAgICAgICAgICAgICAgbGlua1RleHQ6IGxpbmtUZXh0IHx8ICdNb3JlXFx1MjAyNidcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBlbmRDb2RlRm9sZDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdmFyIGN1cnJSYW5nZSA9IGZvbGRlZFJhbmdlc1tmb2xkZWRSYW5nZXMubGVuZ3RoIC0gMV07XG4gICAgICAgICAgICAgICAgY3VyclJhbmdlLmVuZCA9IGN1cnJMaW5lTnVtYmVyO1xuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgaW5zZXJ0VG9vbHRpcDogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICBlZGl0b3JUb29sdGlwcy5wdXNoKGFyZ3VtZW50cyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc29sZS5sb2coXCJDb3Vyc2UgcmV0cmlldmVkOiBcIik7XG4gICAgICAgIGNvbnNvbGUubG9nKGRhdGEpO1xuXG4gICAgICAgIC8vIE5vcm1hbGl6ZSB3aGl0ZXNwYWNlIGlmIHdlJ3JlIG9uIHdpbmRvd3MuXG4gICAgICAgIGRhdGEgPSBkYXRhLnJlcGxhY2UoL1xcclxcbi9nLCAnXFxuJyk7XG5cbiAgICAgICAgLy8gV2Ugd2FudCB0byBtYWtlIGl0IGxlc3MgbGlrZWx5IHRoYXQgdGhlIHVzZXIgYWNjaWRlbnRhbGx5XG4gICAgICAgIC8vIGRlbGV0ZXMgdGhlIGNsb3NpbmcgYnJhY2Ugb2YgYSBmdW5jdGlvbiBkZWZpbml0aW9uIG9yIGFkZHNcbiAgICAgICAgLy8gY29kZSBhZnRlciBpdCwgc28gd2UnbGwgbW92ZSBpdCB3YXkgZG93biB0byB0aGUgYm90dG9tIG9mXG4gICAgICAgIC8vIHRoZSBmaWxlIHdpdGggcGxlbnR5IG9mIHdoaXRlLXNwYWNlIGluIGJldHdlZW4uXG4gICAgICAgIGRhdGEgPSBkYXRhLnJlcGxhY2UoL31cXG4qJC8sICdcXG5cXG5cXG5cXG5cXG5cXG5cXG5cXG5cXG5cXG59XFxuJyk7XG5cbiAgICAgICAgZGF0YSA9IGRhdGEuc3BsaXQoJ1xcbicpLmZpbHRlcihmdW5jdGlvbihsaW5lKSB7XG4gICAgICAgICAgICB2YXIgbWF0Y2ggPSBsaW5lLm1hdGNoKC8oXFxzKilcXC9cXC9cXHMqRURJVE9SOiguKikvKTtcbiAgICAgICAgICAgIGlmICghbWF0Y2gpIHtcbiAgICAgICAgICAgICAgICBjdXJyTGluZU51bWJlcisrO1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjdXJySW5kZW50YXRpb24gPSBtYXRjaFsxXTtcbiAgICAgICAgICAgIHdpdGggKGVkaXRvckNvbW1hbmRzKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJFeGVjdXRpbmcgZWRpdG9yIGNvbW1hbmQ6IFwiICsgbWF0Y2hbMl0pO1xuICAgICAgICAgICAgICAgIGV2YWwobWF0Y2hbMl0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH0pLmpvaW4oJ1xcbicpO1xuXG4gICAgICAgIG9yaWdpbmFsRWRpdG9yQ29udGVudCA9IGRhdGE7XG4gICAgICAgIGVkaXRvcl9qcy5zZXRWYWx1ZShkYXRhKTtcbiAgICAgICAgLy8gTWFyayBlZGl0b3IgYXMgY2xlYW4gYWZ0ZXIgaW5zZXJ0aW5nIHRoZSBiYXNlIHRlbXBsYXRlIHRvIGhhbmRsZSBVbmRvIGRpc3BsYXlcbiAgICAgICAgZWRpdG9yX2pzLm1hcmtDbGVhbigpO1xuICAgICAgICAvLyBTaW5jZSB0aGUgZWRpdG9yIHdpbGwgYmUgY2xlYW4gdG8gc3RhcnQgd2l0aCwgZGlzYWJsZSBVbmRvXG4gICAgICAgICQoXCIjdW5kb1wiKS5wcm9wKFwiZGlzYWJsZWRcIix0cnVlKTtcblxuICAgICAgICAvLyBNYWtlIHRoZSBmaXJzdCBsaW5lIHJlYWQtb25seS5cbiAgICAgICAgcmVhZE9ubHlSYW5nZXMucHVzaChbMCwgMV0pO1xuXG4gICAgICAgIC8vIE1ha2UgdGhlIGxhc3QgdHdvIGxpbmVzIHJlYWQtb25seS5cbiAgICAgICAgcmVhZE9ubHlSYW5nZXMucHVzaChbZWRpdG9yX2pzLmxpbmVDb3VudCgpIC0gMiwgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVkaXRvcl9qcy5saW5lQ291bnQoKV0pO1xuXG4gICAgICAgIHJlYWRPbmx5UmFuZ2VzLmZvckVhY2goZnVuY3Rpb24ocmFuZ2UpIHtcbiAgICAgICAgICAgIGVkaXRvcl9qcy5tYXJrVGV4dCh7bGluZTogcmFuZ2VbMF0sIGNoOiAwfSwge1xuICAgICAgICAgICAgICBsaW5lOiByYW5nZVsxXSxcbiAgICAgICAgICAgICAgY2g6IDBcbiAgICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgICAgY2xhc3NOYW1lOiAnanMtcmVhZC1vbmx5JyxcbiAgICAgICAgICAgICAgcmVhZE9ubHk6IHRydWVcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmVhZE9ubHlUb2tlbnMuZm9yRWFjaChmdW5jdGlvbihhcmd1bWVudHMpIHtcbiAgICAgICAgICAgIHJlYWRPbmx5VG9rZW4uYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgbWFya0hpbnRzLmZvckVhY2goZnVuY3Rpb24oYXJndW1lbnRzKSB7XG4gICAgICAgICAgICBtYXJrSGludC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgICB9KTtcblxuICAgICAgICAkKFwiI2pzX2VkaXRvclwiKS5yZW1vdmVDbGFzcygnc2hvdy1qcy1oaW50cycpO1xuXG4gICAgICAgIGlmIChtYXJrSGludHMubGVuZ3RoKSB7XG4gICAgICAgICAgICAkKFwiI3Nob3dIaW50c1wiKS5zaG93KCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAkKFwiI3Nob3dIaW50c1wiKS5oaWRlKCk7XG4gICAgICAgIH1cblxuICAgICAgICBmb2xkZWRSYW5nZXMuZm9yRWFjaChmdW5jdGlvbihyYW5nZSkge1xuICAgICAgICAgICAgdmFyIHN0YXJ0ID0ge2xpbmU6IHJhbmdlLmJlZ2luLCBjaDogMH07XG4gICAgICAgICAgICB2YXIgc3BhbiA9ICQoJzxzcGFuIGNsYXNzPVwiY20tY29tbWVudFwiPicgKyByYW5nZS5pbmRlbnRhdGlvbiArXG4gICAgICAgICAgICAgICAgICAgICAgICAgJy8vIDwvc3Bhbj4nKTtcbiAgICAgICAgICAgICQoJzxzcGFuIGNsYXNzPVwianMtY29kZS1mb2xkLWxpbmtcIj48L3NwYW4+JylcbiAgICAgICAgICAgICAgLnRleHQocmFuZ2UubGlua1RleHQpXG4gICAgICAgICAgICAgIC5hcHBlbmRUbyhzcGFuKTtcbiAgICAgICAgICAgIGVkaXRvcl9qcy5mb2xkQ29kZShzdGFydCwge1xuICAgICAgICAgICAgICAgIHdpZGdldDogc3BhblswXSxcbiAgICAgICAgICAgICAgICByYW5nZUZpbmRlcjogZnVuY3Rpb24oY20sIHBvcykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgZnJvbTogc3RhcnQsXG4gICAgICAgICAgICAgICAgICAgICAgICB0bzoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbmU6IHJhbmdlLmVuZCAtIDEsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2g6IGVkaXRvcl9qcy5nZXRMaW5lKHJhbmdlLmVuZCAtIDEpLmxlbmd0aFxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcblxuICAgICAgICBlZGl0b3JUb29sdGlwcy5mb3JFYWNoKGZ1bmN0aW9uKGFyZ3VtZW50cyl7XG4gICAgICAgICAgICBpbnNlcnRFZGl0b1Rvb2x0aXAuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgY2IoKTtcbiAgICB9KTtcbiAgICBcbiAgICAvLyBTZXQgc2Vzc2lvbiBzdG9yYWdlIGFuZCByZWxvYWQgdGhlIGlmcmFtZSB0byBiZSBzeW5jaGVkXG4gICAgc3RvcmFnZS5zZXQoJ2N1cnJlbnRMZXZlbCcsIGN1cnJlbnRMZXZlbCk7XG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3ByZXZpZXcnKS5jb250ZW50V2luZG93LmxvY2F0aW9uLnJlbG9hZCgpO1xufVxuXG5mdW5jdGlvbiBzaG93SGludHMoKSB7XG4gICAgJChcIiNqc19lZGl0b3JcIikuYWRkQ2xhc3MoJ3Nob3ctanMtaGludHMnKTtcbiAgICAkKFwiI3Nob3dIaW50c1wiKS5mYWRlT3V0KCk7XG59XG5cbmZ1bmN0aW9uIG5leHRMZXZlbCgpe1xuICAgIGN1cnJlbnRMZXZlbCA9PSBtYXhMZXZlbCA/IG1heExldmVsIDogY3VycmVudExldmVsKys7XG4gICAgXG4gICAgLy9VcGRhdGUgaWZyYW1lIHNvdXJjZVxuICAgIC8vICQoJ2lmcmFtZSNwcmV2aWV3JykuYXR0cignc3JjJywgJ3Byb2plY3RfdGVtcGxhdGUvaW5kZXgnK2N1cnJlbnRMZXZlbCsnLmh0bWwnKTtcbiAgICAvLyAkaW5zdHJ1Y3Rpb25zLmZpbmQoXCJoM1wiKS50ZXh0KGluc3RydWN0aW9uc1tcImxldmVsXCIrY3VycmVudExldmVsXS50aXRsZSk7XG4gICAgLy8gJGluc3RydWN0aW9ucy5maW5kKFwicFwiKS50ZXh0KGluc3RydWN0aW9uc1tcImxldmVsXCIrY3VycmVudExldmVsXS5jb250ZW50KTtcbiAgICBsb2FkTWluaUNvdXJzZSgpO1xufVxuXG5mdW5jdGlvbiBwcmV2TGV2ZWwoKXtcbiAgICBjdXJyZW50TGV2ZWwgPT0gMSA/IDEgOiBjdXJyZW50TGV2ZWwtLTtcbiAgICBcbiAgICAvL1VwZGF0ZSBpZnJhbWUgc291cmNlXG4gICAgLy8gJCgnaWZyYW1lI3ByZXZpZXcnKS5hdHRyKCdzcmMnLCAncHJvamVjdF90ZW1wbGF0ZS9pbmRleCcrY3VycmVudExldmVsKycuaHRtbCcpO1xuICAgIC8vICRpbnN0cnVjdGlvbnMuZmluZChcImgzXCIpLnRleHQoaW5zdHJ1Y3Rpb25zW1wibGV2ZWxcIitjdXJyZW50TGV2ZWxdLnRpdGxlKTtcbiAgICAvLyAkaW5zdHJ1Y3Rpb25zLmZpbmQoXCJwXCIpLnRleHQoaW5zdHJ1Y3Rpb25zW1wibGV2ZWxcIitjdXJyZW50TGV2ZWxdLmNvbnRlbnQpO1xuICAgIGxvYWRNaW5pQ291cnNlKCk7XG59XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
