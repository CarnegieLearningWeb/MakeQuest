function startWalkthrough(){$(document).foundation("joyride","start",{pre_ride_callback:function(){$("#showHints").css("display","block"),$("#previous").css("display","block"),$("#next").css("display","block")},pre_step_callback:function(){console.log(this.$target.first().attr("id")),"preview"==this.$target.first().attr("id")?$("iframe").contents().find("canvas").addClass("joyride-highlight"):this.$target.first().addClass("joyride-highlight")},post_step_callback:function(){"preview"==this.$target.first().attr("id")?$("iframe").contents().find("canvas").removeClass("joyride-highlight"):this.$target.first().removeClass("joyride-highlight")},post_ride_callback:function(){console.log("JOYRIDE CLOSED"),$("#showHints").css("display","none"),$("#previous").css("display","none"),$("#next").css("display","none")},abort_on_close:!1})}function levelSelectMenu(){$("#levelSelectMenuModal").foundation("reveal","open")}function skipToLevel(e){return $("#levelSelectMenuModal").foundation("reveal","close"),"sandbox"==e?(storage.set("skipToSandbox",!0),void loadMiniCourse()):(currentLevel=e,void loadMiniCourse())}function revertMiniCourse(){loadMiniCourse(refreshPreview)}function publishPrompt(){$("#publishModal").foundation("reveal","open")}function undo(){editor_js.undo()}function publish(){console.log("PARENT PUBLISH"),generatedHTML=null,MinicoursePublisher.generateHTML({baseURL:"./mini/",baseLevel:maxLevel,js:editor_js.getValue(),formInfo:'<span id="first_name">'+$("#first_name").val().charAt(0).toUpperCase()+$("#first_name").val().slice(1)+'</span> from <span id="school">'+$("#00NU0000005PN7e").val()+'</span><span id="grade" style="display: none;">'+$("#grade").val()+'</span><span id="city" style="display: none;">'+$("#city").val()+'</span><span id="state" style="display: none;">'+$("#state").val()+'</span><span id="country" style="display: none;">'+$("#country").val()+"</span>"},function(e,n){if(e)return void alert("Error generating published HTML: "+e.message);if(generatedHTML=n,console.log("GENERATED HTML"),console.log(generatedHTML),!generatedHTML)return void alert("There was an error publishing your game. Please try again later!");$("#published").hide(),$("#publishing").fadeIn();var o;o=window.location.hostname.indexOf("code.globaloria.com")>-1?"http://globaloria.com:8000/":window.location.hostname.indexOf("makequest.globaloria.com")>-1?"https://globaloria.com:8001/":"https://hackpub.herokuapp.com/buckets/globaloria/",$.ajax({type:"POST",url:o+"publish",data:{html:generatedHTML},crossDomain:!0,dataType:"json",error:function(){alert("Error publishing HTML!"),console.log(arguments)},success:function(e){$("#published").fadeIn().find("a").attr("href",e["published-url"]).text(e["published-url"]),$('button[type="submit"]').attr("disabled","disabled")},complete:function(){$("#publishing").hide()}})})}function loadMiniCourse(cb){cb=cb||function(){},console.log("Loading mini course template");var zeroPaddedLevel=currentLevel<10?"0"+currentLevel:currentLevel;"true"==storage.get("skipToSandbox")?(zeroPaddedLevel=maxLevel,$("#levelMenu").css("display","none")):$("#levelMenu").css("display","block");var codeUrl="mini/levels/"+zeroPaddedLevel+".js";remixUrl&&"true"==storage.get("skipToSandbox")&&(codeUrl=window.location.href.match(/code.globaloria.com/)?"http://mycode.globaloria.com/"+remixUrl[1]:window.location.href.match(/makequest.globaloria.com/)?"http://mymakequest.globaloria.com.s3-website-us-east-1.amazonaws.com/"+remixUrl[1]:"https://globaloria-dev.s3.amazonaws.com/"+remixUrl[1]),$.get(codeUrl,function(data){if(remixUrl){debug2=data;var remixCode=data.match(/<script id="published-level-code">([\s\S])+?<\/script>/g);remixCode&&(data=remixCode[0].replace('<script id="published-level-code">',"").replace("</script>",""),console.log("NEW DATA"),console.log(data))}var markHints=[],readOnlyTokens=[],readOnlyRanges=[],foldedRanges=[],currLineNumber=0,currIndentation=0,editorTooltips=[],editorCommands={markHint:function(){markHints.push(arguments)},readOnlyToken:function(){readOnlyTokens.push(arguments)},beginReadOnly:function(){readOnlyRanges.push([currLineNumber])},endReadOnly:function(){var e=readOnlyRanges[readOnlyRanges.length-1];e.push(currLineNumber)},beginCodeFold:function(e){foldedRanges.push({begin:currLineNumber,indentation:currIndentation,linkText:e||"Moreâ€¦"})},endCodeFold:function(){var e=foldedRanges[foldedRanges.length-1];e.end=currLineNumber},insertTooltip:function(){editorTooltips.push(arguments)}};console.log("Course retrieved: "),console.log(data),data=data.replace(/\r\n/g,"\n"),data=data.replace(/}\n*$/,"\n\n\n\n\n\n\n\n\n\n}\n"),data=data.split("\n").filter(function(line){var match=line.match(/(\s*)\/\/\s*EDITOR:(.*)/);if(!match)return currLineNumber++,!0;with(currIndentation=match[1],editorCommands)console.log("Executing editor command: "+match[2]),eval(match[2]);return!1}).join("\n"),originalEditorContent=data,editor_js.setValue(data),editor_js.markClean(),$("#undo").prop("disabled",!0),readOnlyRanges.push([0,1]),readOnlyRanges.push([editor_js.lineCount()-2,editor_js.lineCount()]),readOnlyRanges.forEach(function(e){editor_js.markText({line:e[0],ch:0},{line:e[1],ch:0},{className:"js-read-only",readOnly:!0})}),readOnlyTokens.forEach(function(e){readOnlyToken.apply(this,e)}),markHints.forEach(function(e){markHint.apply(this,e)}),$("#js_editor").removeClass("show-js-hints"),markHints.length?$("#showHints").show():$("#showHints").hide(),foldedRanges.forEach(function(e){var n={line:e.begin,ch:0},o=$('<span class="cm-comment">'+e.indentation+"// </span>");$('<span class="js-code-fold-link"></span>').text(e.linkText).appendTo(o),editor_js.foldCode(n,{widget:o[0],rangeFinder:function(o,t){return{from:n,to:{line:e.end-1,ch:editor_js.getLine(e.end-1).length}}}})}),editorTooltips.forEach(function(e){insertEditoTooltip.apply(this,e)}),cb()}),storage.set("currentLevel",currentLevel),document.getElementById("preview").contentWindow.location.reload()}function showHints(){$("#js_editor").addClass("show-js-hints"),$("#showHints").fadeOut()}function nextLevel(){currentLevel==maxLevel?maxLevel:currentLevel++,loadMiniCourse()}function prevLevel(){1==currentLevel?1:currentLevel--,loadMiniCourse()}var maxLevel=gameConstants.MAX_LEVEL,remixUrl=window.location.href.match(/remix=(.+)/);$(document).ready(function(){storage.set("skipToSandbox",!1),remixUrl&&storage.set("skipToSandbox",!0),$("main").css("height",window.innerHeight-36),remixUrl||startWalkthrough(),$(document).on("close.fndtn.reveal","#welcomeModal",function(){startWalkthrough()}),$(document).on("click",".joyride-close-tip",function(){console.log(this)});var e=0,n=window.location.search.match(/debugLevel=(\d+)/);n&&(e=parseInt(n[1])),window.sessionStorage.currentLevel=e,currentLevel=e,$instructions=$("#instructions"),$(document).on("click","span.tooltip",function(){Foundation.libs.tooltip.hide($("#editor-tooltip")),$(this).remove(),$("#editor-tooltip").remove()}),$(document).on("click","#signupButton",function(e){e.preventDefault(),console.log("signup"),console.log(this);var n=document.getElementById("sign_up_email").value,o=document.getElementById("sign_up_password").value;createUserAndLogin({email:n,password:o}),$("#signupModal").foundation("reveal","close")}),$(document).on("click","#logout",function(e){e.preventDefault(),console.log("logout"),console.log(this),logout()}),loadMiniCourse(refreshPreview),setTimeout(function(){console.log("REFRESH 2000"),refreshPreview()},2e3),$("iframe#preview").attr("src","mini/index.html").focus(),$("form #00NU0000005PN7j").on("change",function(){console.log($(this).prop("checked")),$(this).prop("checked")?($("#first_name").prop("disabled",!1),$("#email").prop("disabled",!1),$("#phone").prop("disabled",!1)):($("#first_name").val(""),$("#email").val(""),$("#phone").val(""),$("#first_name").prop("disabled",!0),$("#email").prop("disabled",!0),$("#phone").prop("disabled",!0))}),$("#publish-form").submit(function(e){return console.log("VALIDATING"),""==$("#00NU0000005PN7e").val()||""==$("#city").val()||""==$("#country").val()||""==$("#state").val()?(console.log("VALIDATION FAILED"),!1):(console.log("PUBLISHING"),publish(),e.preventDefault(),!1)})});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpzL21haW4uanMiXSwibmFtZXMiOlsic3RhcnRXYWxrdGhyb3VnaCIsIiQiLCJkb2N1bWVudCIsImZvdW5kYXRpb24iLCJwcmVfcmlkZV9jYWxsYmFjayIsImNzcyIsInByZV9zdGVwX2NhbGxiYWNrIiwiY29uc29sZSIsImxvZyIsInRoaXMiLCIkdGFyZ2V0IiwiZmlyc3QiLCJhdHRyIiwiY29udGVudHMiLCJmaW5kIiwiYWRkQ2xhc3MiLCJwb3N0X3N0ZXBfY2FsbGJhY2siLCJyZW1vdmVDbGFzcyIsInBvc3RfcmlkZV9jYWxsYmFjayIsImFib3J0X29uX2Nsb3NlIiwibGV2ZWxTZWxlY3RNZW51Iiwic2tpcFRvTGV2ZWwiLCJsZXZlbCIsInN0b3JhZ2UiLCJzZXQiLCJsb2FkTWluaUNvdXJzZSIsImN1cnJlbnRMZXZlbCIsInJldmVydE1pbmlDb3Vyc2UiLCJyZWZyZXNoUHJldmlldyIsInB1Ymxpc2hQcm9tcHQiLCJ1bmRvIiwiZWRpdG9yX2pzIiwicHVibGlzaCIsImdlbmVyYXRlZEhUTUwiLCJNaW5pY291cnNlUHVibGlzaGVyIiwiZ2VuZXJhdGVIVE1MIiwiYmFzZVVSTCIsImJhc2VMZXZlbCIsIm1heExldmVsIiwianMiLCJnZXRWYWx1ZSIsImZvcm1JbmZvIiwidmFsIiwiY2hhckF0IiwidG9VcHBlckNhc2UiLCJzbGljZSIsImVyciIsImh0bWwiLCJhbGVydCIsIm1lc3NhZ2UiLCJoaWRlIiwiZmFkZUluIiwid2luZG93IiwibG9jYXRpb24iLCJob3N0bmFtZSIsImluZGV4T2YiLCJhamF4IiwidHlwZSIsInVybCIsImRhdGEiLCJjcm9zc0RvbWFpbiIsImRhdGFUeXBlIiwiZXJyb3IiLCJhcmd1bWVudHMiLCJzdWNjZXNzIiwidGV4dCIsImNvbXBsZXRlIiwiY2IiLCJ6ZXJvUGFkZGVkTGV2ZWwiLCJnZXQiLCJjb2RlVXJsIiwicmVtaXhVcmwiLCJocmVmIiwibWF0Y2giLCJkZWJ1ZzIiLCJyZW1peENvZGUiLCJyZXBsYWNlIiwibWFya0hpbnRzIiwicmVhZE9ubHlUb2tlbnMiLCJyZWFkT25seVJhbmdlcyIsImZvbGRlZFJhbmdlcyIsImN1cnJMaW5lTnVtYmVyIiwiY3VyckluZGVudGF0aW9uIiwiZWRpdG9yVG9vbHRpcHMiLCJlZGl0b3JDb21tYW5kcyIsIm1hcmtIaW50IiwicHVzaCIsInJlYWRPbmx5VG9rZW4iLCJiZWdpblJlYWRPbmx5IiwiZW5kUmVhZE9ubHkiLCJjdXJyUmFuZ2UiLCJsZW5ndGgiLCJiZWdpbkNvZGVGb2xkIiwibGlua1RleHQiLCJiZWdpbiIsImluZGVudGF0aW9uIiwiZW5kQ29kZUZvbGQiLCJlbmQiLCJpbnNlcnRUb29sdGlwIiwic3BsaXQiLCJmaWx0ZXIiLCJsaW5lIiwiZXZhbCIsImpvaW4iLCJvcmlnaW5hbEVkaXRvckNvbnRlbnQiLCJzZXRWYWx1ZSIsIm1hcmtDbGVhbiIsInByb3AiLCJsaW5lQ291bnQiLCJmb3JFYWNoIiwicmFuZ2UiLCJtYXJrVGV4dCIsImNoIiwiY2xhc3NOYW1lIiwicmVhZE9ubHkiLCJhcHBseSIsInNob3ciLCJzdGFydCIsInNwYW4iLCJhcHBlbmRUbyIsImZvbGRDb2RlIiwid2lkZ2V0IiwicmFuZ2VGaW5kZXIiLCJjbSIsInBvcyIsImZyb20iLCJ0byIsImdldExpbmUiLCJpbnNlcnRFZGl0b1Rvb2x0aXAiLCJnZXRFbGVtZW50QnlJZCIsImNvbnRlbnRXaW5kb3ciLCJyZWxvYWQiLCJzaG93SGludHMiLCJmYWRlT3V0IiwibmV4dExldmVsIiwicHJldkxldmVsIiwiZ2FtZUNvbnN0YW50cyIsIk1BWF9MRVZFTCIsInJlYWR5IiwiaW5uZXJIZWlnaHQiLCJvbiIsInN0YXJ0TGV2ZWwiLCJkZWJ1Z0xldmVsIiwic2VhcmNoIiwicGFyc2VJbnQiLCJzZXNzaW9uU3RvcmFnZSIsIiRpbnN0cnVjdGlvbnMiLCJGb3VuZGF0aW9uIiwibGlicyIsInRvb2x0aXAiLCJyZW1vdmUiLCJlIiwicHJldmVudERlZmF1bHQiLCJlbWFpbCIsInZhbHVlIiwicGFzc3dvcmQiLCJjcmVhdGVV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QUFLLFlBQVksR0FFbEMxRyxFQUFFLFVBQVUwRyxLQUFLLFlBQVksR0FDN0IxRyxFQUFFLFVBQVUwRyxLQUFLLFlBQVksTUFJckMxRyxFQUFFLGlCQUFpQitKLE9BQU8sU0FBU0MsR0FHL0IsTUFGQTFKLFNBQVFDLElBQUksY0FFdUIsSUFBL0JQLEVBQUUsb0JBQW9CeUMsT0FDQyxJQUFwQnpDLEVBQUUsU0FBU3lDLE9BQ1ksSUFBdkJ6QyxFQUFFLFlBQVl5QyxPQUNPLElBQXJCekMsRUFBRSxVQUFVeUMsT0FFZm5DLFFBQVFDLElBQUksc0JBQ0wsSUFNWEQsUUFBUUMsSUFBSSxjQUNad0IsVUFDQWlJLEVBQU1ULGtCQUNDIiwiZmlsZSI6ImpzL21haW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgbWF4TGV2ZWwgPSBnYW1lQ29uc3RhbnRzLk1BWF9MRVZFTDtcbi8vIENoZWNrIGlmIHdlJ3JlIGFjY2Vzc2luZyBhIHJlbWl4IHVybCwgaWYgc28sIHN0b3JlIHRoZSB1cmwgZm9yIGxhdGVyIHVzZVxudmFyIHJlbWl4VXJsID0gd2luZG93LmxvY2F0aW9uLmhyZWYubWF0Y2goL3JlbWl4PSguKykvKTtcblxuJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7XG4gICAgLy8gRG9uJ3Qgc3RhcnQgaW4gc2FuZGJveCBpZiB0aGUgcGFnZSBpcyByZWZyZXNoZWQgYW5kIHdlJ3JlIG5vdCBpbiByZW1peCBtb2RlXG4gICAgc3RvcmFnZS5zZXQoJ3NraXBUb1NhbmRib3gnLCBmYWxzZSk7XG4gICAgaWYocmVtaXhVcmwpe1xuICAgICAgICBzdG9yYWdlLnNldCgnc2tpcFRvU2FuZGJveCcsIHRydWUpO1xuICAgIH1cblxuICAgIC8vUmVzaXplIHRvIHZpZXdwb3J0XG4gICAgJChcIm1haW5cIikuY3NzKFwiaGVpZ2h0XCIsIHdpbmRvdy5pbm5lckhlaWdodC0zNik7XG5cbiAgICBcblxuICAgIC8vT3BlbiB3ZWxjb21lIG1vZGFsIG9uIGZpcnN0IGxvYWRcbiAgICAvLyBjb2RlLmdsb2JhbG9yaWEuY29tIG9ubHlcbiAgICAvLyAkKCcjd2VsY29tZU1vZGFsJykuZm91bmRhdGlvbigncmV2ZWFsJywgJ29wZW4nKTtcbiAgICBcbiAgICAvL09wZW4gd2Fsa3Rocm91Z2ggb24gZmlyc3QgbG9hZFxuICAgIC8vIG1ha2VxdWVzdC5nbG9iYWxvcmlhLmNvbSBvbmx5XG4gICAgaWYoICFyZW1peFVybCApe1xuICAgICAgICBzdGFydFdhbGt0aHJvdWdoKCk7XG4gICAgfVxuXG5cblxuXG4gICAgLy8gSW5pdCBqb3lyaWRlIGFmdGVyIFdlbGNvbWUgTW9kYWxcbiAgICAkKGRvY3VtZW50KS5vbignY2xvc2UuZm5kdG4ucmV2ZWFsJywgJyN3ZWxjb21lTW9kYWwnLCBmdW5jdGlvbiAoKSB7XG4gICAgICBcbiAgICAgICAgc3RhcnRXYWxrdGhyb3VnaCgpO1xuICAgICAgXG4gICAgfSk7XG4gICAgJChkb2N1bWVudCkub24oJ2NsaWNrJywgJy5qb3lyaWRlLWNsb3NlLXRpcCcsIGZ1bmN0aW9uKCl7XG4gICAgICBjb25zb2xlLmxvZyh0aGlzKTtcbiAgICB9KTtcblxuXG4gICAgdmFyIHN0YXJ0TGV2ZWwgPSAwO1xuICAgIHZhciBkZWJ1Z0xldmVsID0gd2luZG93LmxvY2F0aW9uLnNlYXJjaC5tYXRjaCgvZGVidWdMZXZlbD0oXFxkKykvKTtcblxuICAgIGlmIChkZWJ1Z0xldmVsKSB7XG4gICAgICAgIHN0YXJ0TGV2ZWwgPSBwYXJzZUludChkZWJ1Z0xldmVsWzFdKTtcbiAgICB9XG5cblxuICAgIC8vUmVzZXQgc2Vzc2lvblN0b3JhZ2UgdG8ga2VlcCBlZGl0b3IgYW5kIGlmcmFtZSBpbiBzeW5jXG4gICAgd2luZG93LnNlc3Npb25TdG9yYWdlWydjdXJyZW50TGV2ZWwnXSA9IHN0YXJ0TGV2ZWw7XG5cbiAgICBjdXJyZW50TGV2ZWwgPSBzdGFydExldmVsO1xuXG4gICAgJGluc3RydWN0aW9ucyA9ICQoXCIjaW5zdHJ1Y3Rpb25zXCIpO1xuXG4gICAgLy9SZW1vdmUgdG9vbHRpcHMgZnJvbSBjb2RlIGVkaXRvclxuICAgICQoZG9jdW1lbnQpLm9uKCdjbGljaycsICdzcGFuLnRvb2x0aXAnLCBmdW5jdGlvbigpe1xuICAgICAgICBGb3VuZGF0aW9uLmxpYnMudG9vbHRpcC5oaWRlKCAkKCcjZWRpdG9yLXRvb2x0aXAnKSApO1xuICAgICAgICAkKHRoaXMpLnJlbW92ZSgpO1xuICAgICAgICAkKCcjZWRpdG9yLXRvb2x0aXAnKS5yZW1vdmUoKTtcbiAgICB9KTtcblxuICAgICQoZG9jdW1lbnQpLm9uKCdjbGljaycsICcjc2lnbnVwQnV0dG9uJywgZnVuY3Rpb24oZSkge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGNvbnNvbGUubG9nKFwic2lnbnVwXCIpO1xuICAgICAgICBjb25zb2xlLmxvZyh0aGlzKTtcbiAgICAgICAgXG4gICAgICAgIHZhciBlbWFpbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzaWduX3VwX2VtYWlsJykudmFsdWU7XG4gICAgICAgIHZhciBwYXNzd29yZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzaWduX3VwX3Bhc3N3b3JkJykudmFsdWU7XG5cbiAgICAgICAgY3JlYXRlVXNlckFuZExvZ2luKHtcbiAgICAgICAgICAgIGVtYWlsOiBlbWFpbCxcbiAgICAgICAgICAgIHBhc3N3b3JkOiBwYXNzd29yZFxuICAgICAgICB9KTtcbiAgICAgICAgXG5cbiAgICAgICAgJCgnI3NpZ251cE1vZGFsJykuZm91bmRhdGlvbigncmV2ZWFsJywgJ2Nsb3NlJyk7XG4gICAgfSk7XG5cbiAgICAkKGRvY3VtZW50KS5vbignY2xpY2snLCAnI2xvZ291dCcsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBjb25zb2xlLmxvZyhcImxvZ291dFwiKTtcbiAgICAgICAgY29uc29sZS5sb2codGhpcyk7XG5cbiAgICAgICAgbG9nb3V0KCk7XG4gICAgfSk7XG5cbiAgICBsb2FkTWluaUNvdXJzZShyZWZyZXNoUHJldmlldyk7XG5cbiAgICAvLyBGaXggdGhpcyB1Z2x5IGhhY2sgc28gdGhhdCB0aGUgZ2FtZSBpcyBkaXNwbGF5ZWQgY29ycmVjdGx5IHdoZW4gcmVtaXhpbmcuXG4gICAgLy8gQ3VycmVudGx5IGhhdmUgdG8gaGl0IFJ1biB3aGVuIG9wZW5pbmcgZm9yIFJlbWl4IG9yIHVzZSB0aGlzIHRpbWVvdXQgY2FsbDogXG4gICAgc2V0VGltZW91dChmdW5jdGlvbigpe1xuICAgICAgICBjb25zb2xlLmxvZyhcIlJFRlJFU0ggMjAwMFwiKTtcbiAgICAgICAgcmVmcmVzaFByZXZpZXcoKTtcbiAgICB9LCAyMDAwKTtcblxuICAgIC8vU2V0IGlmcmFtZSB0byByaWdodCBsZXZlbFxuICAgICQoJ2lmcmFtZSNwcmV2aWV3JykuYXR0cignc3JjJywgJ21pbmkvaW5kZXguaHRtbCcpLmZvY3VzKCk7XG5cbiAgICAvLyBQdWJsaXNoaW5nIGZvcm0gc3VibWlzc2lvblxuICAgIC8vaXMtYWR1bHRcbiAgICAkKCdmb3JtICMwME5VMDAwMDAwNVBON2onKS5vbignY2hhbmdlJywgZnVuY3Rpb24oKXtcbiAgICAgICAgY29uc29sZS5sb2coICQodGhpcykucHJvcCgnY2hlY2tlZCcpICk7XG4gICAgICAgIGlmKCAkKHRoaXMpLnByb3AoJ2NoZWNrZWQnKSApe1xuICAgICAgICAgICAgJCgnI2ZpcnN0X25hbWUnKS5wcm9wKCdkaXNhYmxlZCcsIGZhbHNlKTtcbiAgICAgICAgICAgIC8vICQoJyNsYXN0X25hbWUnKS5wcm9wKCdkaXNhYmxlZCcsIGZhbHNlKTtcbiAgICAgICAgICAgICQoJyNlbWFpbCcpLnByb3AoJ2Rpc2FibGVkJywgZmFsc2UpO1xuICAgICAgICAgICAgJCgnI3Bob25lJykucHJvcCgnZGlzYWJsZWQnLCBmYWxzZSk7XG4gICAgICAgIH1lbHNle1xuICAgICAgICAgICAgJCgnI2ZpcnN0X25hbWUnKS52YWwoJycpO1xuICAgICAgICAgICAgLy8gJCgnI2xhc3RfbmFtZScpLnZhbCgnJyk7XG4gICAgICAgICAgICAkKCcjZW1haWwnKS52YWwoJycpO1xuICAgICAgICAgICAgJCgnI3Bob25lJykudmFsKCcnKTtcblxuICAgICAgICAgICAgJCgnI2ZpcnN0X25hbWUnKS5wcm9wKCdkaXNhYmxlZCcsIHRydWUpO1xuICAgICAgICAgICAgLy8gJCgnI2xhc3RfbmFtZScpLnByb3AoJ2Rpc2FibGVkJywgdHJ1ZSk7XG4gICAgICAgICAgICAkKCcjZW1haWwnKS5wcm9wKCdkaXNhYmxlZCcsIHRydWUpO1xuICAgICAgICAgICAgJCgnI3Bob25lJykucHJvcCgnZGlzYWJsZWQnLCB0cnVlKTtcbiAgICAgICAgfVxuICAgIH0pO1xuICAgIFxuICAgICQoJyNwdWJsaXNoLWZvcm0nKS5zdWJtaXQoZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgY29uc29sZS5sb2coXCJWQUxJREFUSU5HXCIpO1xuICAgICAgICAvLyBGb3JtIHZhbGlkYXRpb25cbiAgICAgICAgaWYoICQoJyMwME5VMDAwMDAwNVBON2UnKS52YWwoKSA9PSBcIlwiXG4gICAgICAgICAgICB8fCAkKCcjY2l0eScpLnZhbCgpID09IFwiXCJcbiAgICAgICAgICAgIHx8ICQoJyNjb3VudHJ5JykudmFsKCkgPT0gXCJcIlxuICAgICAgICAgICAgfHwgJCgnI3N0YXRlJykudmFsKCkgPT0gXCJcIlxuICAgICAgICAgICAgKXtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiVkFMSURBVElPTiBGQUlMRURcIik7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBQcmV2ZW50IGZvcm0gc3VibWlzc2lvblxuICAgICAgICAvLyBQdWJsaXNoIGdhbWUgYW5kIHNldCB1cmwgYXMgdGhlIHJldHVybiBwYXJhbWV0ZXIgZm9yIHRoZSBmb3JtLlxuICAgICAgICAvLyBTdWJtaXQgdGhlIGZvcm0gZnJvbSBwdWJsaXNoXG4gICAgICAgIGNvbnNvbGUubG9nKFwiUFVCTElTSElOR1wiKTtcbiAgICAgICAgcHVibGlzaCgpO1xuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSk7XG59KTtcblxuZnVuY3Rpb24gc3RhcnRXYWxrdGhyb3VnaCgpe1xuICAgICQoZG9jdW1lbnQpLmZvdW5kYXRpb24oJ2pveXJpZGUnLCAnc3RhcnQnLCB7XG4gICAgICAgIFxuICAgICAgICBwcmVfcmlkZV9jYWxsYmFjayAgICAgIDogZnVuY3Rpb24gKCl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9EaXNwbGF5IGFsbCBidXR0b25zIGZvciBqb3lyaWRlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJChcIiNzaG93SGludHNcIikuY3NzKCdkaXNwbGF5JywgJ2Jsb2NrJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJChcIiNwcmV2aW91c1wiKS5jc3MoJ2Rpc3BsYXknLCAnYmxvY2snKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKFwiI25leHRcIikuY3NzKCdkaXNwbGF5JywgJ2Jsb2NrJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgIHByZV9zdGVwX2NhbGxiYWNrICAgICAgOiBmdW5jdGlvbiAoKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyh0aGlzLiR0YXJnZXQuZmlyc3QoKS5hdHRyKCdpZCcpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZih0aGlzLiR0YXJnZXQuZmlyc3QoKS5hdHRyKCdpZCcpID09IFwicHJldmlld1wiKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoXCJpZnJhbWVcIikuY29udGVudHMoKS5maW5kKFwiY2FudmFzXCIpLmFkZENsYXNzKFwiam95cmlkZS1oaWdobGlnaHRcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiR0YXJnZXQuZmlyc3QoKS5hZGRDbGFzcygnam95cmlkZS1oaWdobGlnaHQnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgIHBvc3Rfc3RlcF9jYWxsYmFjayAgICAgOiBmdW5jdGlvbiAoKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZih0aGlzLiR0YXJnZXQuZmlyc3QoKS5hdHRyKCdpZCcpID09IFwicHJldmlld1wiKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoXCJpZnJhbWVcIikuY29udGVudHMoKS5maW5kKFwiY2FudmFzXCIpLnJlbW92ZUNsYXNzKFwiam95cmlkZS1oaWdobGlnaHRcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiR0YXJnZXQuZmlyc3QoKS5yZW1vdmVDbGFzcygnam95cmlkZS1oaWdobGlnaHQnKTsgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgIHBvc3RfcmlkZV9jYWxsYmFjayAgICAgOiBmdW5jdGlvbiAoKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJKT1lSSURFIENMT1NFRFwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vRGlzcGxheSBhbGwgYnV0dG9ucyBmb3Igam95cmlkZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoXCIjc2hvd0hpbnRzXCIpLmNzcygnZGlzcGxheScsICdub25lJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJChcIiNwcmV2aW91c1wiKS5jc3MoJ2Rpc3BsYXknLCAnbm9uZScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoXCIjbmV4dFwiKS5jc3MoJ2Rpc3BsYXknLCAnbm9uZScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICBhYm9ydF9vbl9jbG9zZSAgICAgICAgICAgOiBmYWxzZVxuICAgICAgfSk7XG59XG5cbmZ1bmN0aW9uIGxldmVsU2VsZWN0TWVudSgpe1xuICAkKCcjbGV2ZWxTZWxlY3RNZW51TW9kYWwnKS5mb3VuZGF0aW9uKCdyZXZlYWwnLCAnb3BlbicpOyAgXG59XG5cbmZ1bmN0aW9uIHNraXBUb0xldmVsKGxldmVsKXtcbiAgICAkKCcjbGV2ZWxTZWxlY3RNZW51TW9kYWwnKS5mb3VuZGF0aW9uKCdyZXZlYWwnLCAnY2xvc2UnKTtcblxuICAgIGlmKGxldmVsID09ICdzYW5kYm94Jyl7XG4gICAgICAgIHN0b3JhZ2Uuc2V0KCdza2lwVG9TYW5kYm94JywgdHJ1ZSk7XG4gICAgICAgIGxvYWRNaW5pQ291cnNlKCk7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjdXJyZW50TGV2ZWwgPSBsZXZlbDtcbiAgICBsb2FkTWluaUNvdXJzZSgpO1xufVxuXG5mdW5jdGlvbiByZXZlcnRNaW5pQ291cnNlKCkge1xuICAgIGxvYWRNaW5pQ291cnNlKHJlZnJlc2hQcmV2aWV3KTtcbn1cblxuZnVuY3Rpb24gcHVibGlzaFByb21wdCgpe1xuICAkKCcjcHVibGlzaE1vZGFsJykuZm91bmRhdGlvbigncmV2ZWFsJywgJ29wZW4nKTtcbn1cblxuZnVuY3Rpb24gdW5kbygpe1xuICAgIGVkaXRvcl9qcy51bmRvKCk7XG59XG5cbmZ1bmN0aW9uIHB1Ymxpc2goKXtcbiAgY29uc29sZS5sb2coXCJQQVJFTlQgUFVCTElTSFwiKTtcbiAgXG4gIGdlbmVyYXRlZEhUTUwgPSBudWxsO1xuICBNaW5pY291cnNlUHVibGlzaGVyLmdlbmVyYXRlSFRNTCh7XG4gICAgYmFzZVVSTDogJy4vbWluaS8nLFxuICAgIGJhc2VMZXZlbDogbWF4TGV2ZWwsXG4gICAganM6IGVkaXRvcl9qcy5nZXRWYWx1ZSgpLFxuICAgIGZvcm1JbmZvOiAnPHNwYW4gaWQ9XCJmaXJzdF9uYW1lXCI+JysgJCgnI2ZpcnN0X25hbWUnKS52YWwoKS5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArICQoJyNmaXJzdF9uYW1lJykudmFsKCkuc2xpY2UoMSkgKyc8L3NwYW4+IGZyb20gPHNwYW4gaWQ9XCJzY2hvb2xcIj4nKyQoJyMwME5VMDAwMDAwNVBON2UnKS52YWwoKSsnPC9zcGFuPidcbiAgICAgICAgICAgICAgKyc8c3BhbiBpZD1cImdyYWRlXCIgc3R5bGU9XCJkaXNwbGF5OiBub25lO1wiPicrJCgnI2dyYWRlJykudmFsKCkrJzwvc3Bhbj4nXG4gICAgICAgICAgICAgICsnPHNwYW4gaWQ9XCJjaXR5XCIgc3R5bGU9XCJkaXNwbGF5OiBub25lO1wiPicrJCgnI2NpdHknKS52YWwoKSsnPC9zcGFuPidcbiAgICAgICAgICAgICAgKyc8c3BhbiBpZD1cInN0YXRlXCIgc3R5bGU9XCJkaXNwbGF5OiBub25lO1wiPicrJCgnI3N0YXRlJykudmFsKCkrJzwvc3Bhbj4nXG4gICAgICAgICAgICAgICsnPHNwYW4gaWQ9XCJjb3VudHJ5XCIgc3R5bGU9XCJkaXNwbGF5OiBub25lO1wiPicrJCgnI2NvdW50cnknKS52YWwoKSsnPC9zcGFuPidcbiAgfSwgZnVuY3Rpb24oZXJyLCBodG1sKSB7XG4gICAgaWYgKGVycikge1xuICAgICAgYWxlcnQoXCJFcnJvciBnZW5lcmF0aW5nIHB1Ymxpc2hlZCBIVE1MOiBcIiArIGVyci5tZXNzYWdlKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgXG4gICAgZ2VuZXJhdGVkSFRNTCA9IGh0bWw7XG4gICAgY29uc29sZS5sb2coXCJHRU5FUkFURUQgSFRNTFwiKTtcbiAgICBjb25zb2xlLmxvZyhnZW5lcmF0ZWRIVE1MKTtcblxuICAgIGlmICghZ2VuZXJhdGVkSFRNTCkge1xuICAgICAgYWxlcnQoXCJUaGVyZSB3YXMgYW4gZXJyb3IgcHVibGlzaGluZyB5b3VyIGdhbWUuIFBsZWFzZSB0cnkgYWdhaW4gbGF0ZXIhXCIpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBcbiAgICAvLyBCZWdpbiBwdWJsaXNoaW5nXG4gICAgJChcIiNwdWJsaXNoZWRcIikuaGlkZSgpO1xuICAgICQoXCIjcHVibGlzaGluZ1wiKS5mYWRlSW4oKTtcblxuICAgIC8vIFB1Ymxpc2ggZXZlcnl0aGluZyB0byBteWNvZGUgdW50aWwgd2UgaGF2ZSBhIHNlY29uZCBidWNrZXQgd2l0aCBDT1JTIGVuYWJsZWRcbiAgICAvLyB2YXIgYmFzZVVSTCA9IHdpbmRvdy5sb2NhdGlvbi5ob3N0bmFtZS5pbmRleE9mKCdjb2RlLmdsb2JhbG9yaWEuY29tJykgPiAtMVxuICAgIC8vICAgICAgICAgICAgICAgPyAnaHR0cDovL2dsb2JhbG9yaWEuY29tOjgwMDAvJ1xuICAgIC8vICAgICAgICAgICAgICAgOiAnaHR0cHM6Ly9oYWNrcHViLmhlcm9rdWFwcC5jb20vYnVja2V0cy9nbG9iYWxvcmlhLyc7XG4gICAgdmFyIGJhc2VVUkw7XG4gICAgaWYoIHdpbmRvdy5sb2NhdGlvbi5ob3N0bmFtZS5pbmRleE9mKCdjb2RlLmdsb2JhbG9yaWEuY29tJykgPiAtMSApe1xuICAgICAgICBiYXNlVVJMID0gJ2h0dHA6Ly9nbG9iYWxvcmlhLmNvbTo4MDAwLyc7XG4gICAgfWVsc2UgaWYoIHdpbmRvdy5sb2NhdGlvbi5ob3N0bmFtZS5pbmRleE9mKCdtYWtlcXVlc3QuZ2xvYmFsb3JpYS5jb20nKSA+IC0xICl7XG4gICAgICAgIGJhc2VVUkwgPSAnaHR0cHM6Ly9nbG9iYWxvcmlhLmNvbTo4MDAxLyc7XG4gICAgfWVsc2V7XG4gICAgICAgIGJhc2VVUkwgPSAnaHR0cHM6Ly9oYWNrcHViLmhlcm9rdWFwcC5jb20vYnVja2V0cy9nbG9iYWxvcmlhLyc7XG4gICAgfVxuICAgIFxuICAgICQuYWpheCh7XG4gICAgICB0eXBlOiAnUE9TVCcsXG4gICAgICB1cmw6IGJhc2VVUkwgKyAncHVibGlzaCcsXG4gICAgICBkYXRhOiB7XG4gICAgICAgICdodG1sJzogZ2VuZXJhdGVkSFRNTFxuICAgICAgfSxcbiAgICAgIGNyb3NzRG9tYWluOiB0cnVlLFxuICAgICAgZGF0YVR5cGU6ICdqc29uJyxcbiAgICAgIGVycm9yOiBmdW5jdGlvbigpIHtcbiAgICAgICAgYWxlcnQoXCJFcnJvciBwdWJsaXNoaW5nIEhUTUwhXCIpO1xuICAgICAgICBjb25zb2xlLmxvZyhhcmd1bWVudHMpO1xuICAgICAgfSxcbiAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgJChcIiNwdWJsaXNoZWRcIikuZmFkZUluKClcbiAgICAgICAgICAuZmluZCgnYScpXG4gICAgICAgICAgLmF0dHIoJ2hyZWYnLCBkYXRhWydwdWJsaXNoZWQtdXJsJ10pXG4gICAgICAgICAgLnRleHQoZGF0YVsncHVibGlzaGVkLXVybCddKTtcblxuICAgICAgICAvLyBEaXNhYmxlIFB1Ymxpc2ggYnV0dG9uIHRvIGF2b2lkIHB1Ymxpc2hpbmcgc3BhbVxuICAgICAgICAkKCdidXR0b25bdHlwZT1cInN1Ym1pdFwiXScpLmF0dHIoJ2Rpc2FibGVkJywgJ2Rpc2FibGVkJyk7XG5cbiAgICAgICAgLy8gY29kZS5nbG9iYWxvcmlhLmNvbSBPTkxZXG4gICAgICAgIC8vIC8vIFJlcGxhY2UgdGhlIGZvcm0ncyByZXR1cm4gVVJMIGFuZCBzdWJtaXQgdGhlIGZvcm1cbiAgICAgICAgLy8gJCgnI3B1Ymxpc2gtZm9ybSBpbnB1dCNyZXRVcmwnKS52YWwoIGRhdGFbJ3B1Ymxpc2hlZC11cmwnXSApO1xuICAgICAgICBcbiAgICAgICAgLy8gLy8gUG9wdWxhdGUgZ2FtZSBsaW5rIGZvciBzYWxlc2ZvcmNlIGNhcHR1cmVcbiAgICAgICAgLy8gJCgnIzAwTlUwMDAwMDA1UE43dCcpLnZhbChkYXRhWydwdWJsaXNoZWQtdXJsJ10pO1xuXG4gICAgICAgIC8vIC8vIFBvcHVsYXRlIHRoZSByb2xlIGZpZWxkIGZvciBzYWxlc2ZvcmNlXG4gICAgICAgIC8vIHZhciByb2xlID0gW107XG4gICAgICAgIC8vIGlmKCAkKCcjaXNTdHVkZW50JykucHJvcCgnY2hlY2tlZCcpICkgcm9sZS5wdXNoKCAkKCcjaXNTdHVkZW50JykudmFsKCkgKTtcbiAgICAgICAgLy8gaWYoICQoJyNpc1RlYWNoZXInKS5wcm9wKCdjaGVja2VkJykgKSByb2xlLnB1c2goICQoJyNpc1RlYWNoZXInKS52YWwoKSApO1xuICAgICAgICAvLyBpZiggJCgnI2lzUGFyZW50JykucHJvcCgnY2hlY2tlZCcpICkgcm9sZS5wdXNoKCAkKCcjaXNQYXJlbnQnKS52YWwoKSApO1xuICAgICAgICAvLyBpZiggJCgnI2lzQWRtaW5pc3RyYXRvcicpLnByb3AoJ2NoZWNrZWQnKSApIHJvbGUucHVzaCggJCgnI2lzQWRtaW5pc3RyYXRvcicpLnZhbCgpICk7XG4gICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAvLyAkKCcjMDBOVTAwMDAwMDVQaDJLJykudmFsKCByb2xlLmpvaW4oJywnKSApO1xuXG4gICAgICAgIC8vVW5iaW5kIGZvcm0gdG8gcHJldmVudCBzdWJtaXQgbG9vcFxuICAgICAgICAvLyAkKCcjcHVibGlzaC1mb3JtJykudW5iaW5kKCkuc3VibWl0KCk7XG5cblxuXG4gICAgICAgIC8vIG1ha3F1ZXN0Lmdsb2JhbG9yaWEuY29tIE9OTFlcbiAgICAgICAgLy8gd2luZG93LmxvY2F0aW9uLmhyZWYgPSAnZGF0YVsncHVibGlzaGVkLXVybCddJztcblxuXG5cbiAgICAgIH0sXG4gICAgICBjb21wbGV0ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICQoXCIjcHVibGlzaGluZ1wiKS5oaWRlKCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH0pO1xufVxuXG5mdW5jdGlvbiBsb2FkTWluaUNvdXJzZShjYil7XG4gICAgY2IgPSBjYiB8fCBmdW5jdGlvbigpIHt9XG4gICAgY29uc29sZS5sb2coXCJMb2FkaW5nIG1pbmkgY291cnNlIHRlbXBsYXRlXCIpO1xuICAgIHZhciB6ZXJvUGFkZGVkTGV2ZWwgPSAoY3VycmVudExldmVsIDwgMTApID8gJzAnICsgY3VycmVudExldmVsIDogY3VycmVudExldmVsO1xuXG4gICAgLy8gU2tpcCB0byBzYW5kYm94XG4gICAgaWYoIHN0b3JhZ2UuZ2V0KCdza2lwVG9TYW5kYm94JykgPT0gJ3RydWUnICl7XG4gICAgICAgIHplcm9QYWRkZWRMZXZlbCA9IG1heExldmVsO1xuICAgICAgICAkKFwiI2xldmVsTWVudVwiKS5jc3MoJ2Rpc3BsYXknLCAnbm9uZScpO1xuICAgIH1lbHNle1xuICAgICAgICAkKFwiI2xldmVsTWVudVwiKS5jc3MoJ2Rpc3BsYXknLCAnYmxvY2snKTtcbiAgICB9XG5cbiAgICB2YXIgY29kZVVybCA9ICdtaW5pL2xldmVscy8nICsgemVyb1BhZGRlZExldmVsICsgJy5qcyc7XG5cbiAgICAvLyBMb2FkIHJlbWl4IGNvZGUgZm9yIHNhbmRib3ggd2hlbiBhdmFpbGFibGVcbiAgICBpZiggcmVtaXhVcmwgJiYgc3RvcmFnZS5nZXQoJ3NraXBUb1NhbmRib3gnKSA9PSAndHJ1ZScgKXtcbiAgICAgICAgLy8gUHVsbCBnYW1lIGZyb20gZGV2IG9yIGxpdmUgKENPUlMgaXMgY3VycmVudGx5IGJyZWFraW5nIHB1bGxzIGZyb20gZ2xvYmFsb3JpYS1kZXYuczMpXG4gICAgICAgIGlmKHdpbmRvdy5sb2NhdGlvbi5ocmVmLm1hdGNoKC9jb2RlLmdsb2JhbG9yaWEuY29tLykpe1xuICAgICAgICAgICAgY29kZVVybCA9ICdodHRwOi8vbXljb2RlLmdsb2JhbG9yaWEuY29tLycrcmVtaXhVcmxbMV07XG4gICAgICAgIH1lbHNlIGlmKHdpbmRvdy5sb2NhdGlvbi5ocmVmLm1hdGNoKC9tYWtlcXVlc3QuZ2xvYmFsb3JpYS5jb20vKSl7XG4gICAgICAgICAgICAvLyBOZWVkIHRvIHVzZSBmdWxsIGJ1Y2tldCBuYW1lLiBVc2luZyBteW1ha2VxdWVzdCB3aWxsIHRocm93IGFuIGVycm9yXG4gICAgICAgICAgICAvLyBjb2RlVXJsID0gJ2h0dHA6Ly9teW1ha2VxdWVzdC5nbG9iYWxvcmlhLnMzLXdlYnNpdGUtdXMtZWFzdC0xLmFtYXpvbmF3cy5jb20vJytyZW1peFVybFsxXTtcbiAgICAgICAgICAgIGNvZGVVcmwgPSAnaHR0cDovL215bWFrZXF1ZXN0Lmdsb2JhbG9yaWEuY29tLnMzLXdlYnNpdGUtdXMtZWFzdC0xLmFtYXpvbmF3cy5jb20vJytyZW1peFVybFsxXTtcbiAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICBjb2RlVXJsID0gJ2h0dHBzOi8vZ2xvYmFsb3JpYS1kZXYuczMuYW1hem9uYXdzLmNvbS8nK3JlbWl4VXJsWzFdO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgJC5nZXQoY29kZVVybCwgZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAvLyBFeHRyYWN0IGVkaXRvciBjb2RlIGZyb20gdGhlIHB1Ymxpc2hlZCBIVE1MIGRvY3VtZW50XG4gICAgICAgIGlmKHJlbWl4VXJsKXtcbiAgICAgICAgICAgIGRlYnVnMiA9IGRhdGE7XG4gICAgICAgICAgICB2YXIgcmVtaXhDb2RlID0gZGF0YS5tYXRjaCgvPHNjcmlwdCBpZD1cInB1Ymxpc2hlZC1sZXZlbC1jb2RlXCI+KFtcXHNcXFNdKSs/PFxcL3NjcmlwdD4vZyk7XG4gICAgICAgICAgICBpZihyZW1peENvZGUpe1xuICAgICAgICAgICAgICAgIC8vIERhdGEgc2hvdWxkIG9ubHkgYmUgdGhlIGVkaXRvciBzcGVjaWZpYyBjb2RlIChpLmUuIHRoZSBjYXB0dXJlZCBncm91cClcbiAgICAgICAgICAgICAgICBkYXRhID0gcmVtaXhDb2RlWzBdLnJlcGxhY2UoJzxzY3JpcHQgaWQ9XCJwdWJsaXNoZWQtbGV2ZWwtY29kZVwiPicsICcnKS5yZXBsYWNlKCc8L3NjcmlwdD4nLCAnJyk7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJORVcgREFUQVwiKTtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhkYXRhKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBtYXJrSGludHMgPSBbXTtcbiAgICAgICAgdmFyIHJlYWRPbmx5VG9rZW5zID0gW107XG4gICAgICAgIHZhciByZWFkT25seVJhbmdlcyA9IFtdO1xuICAgICAgICB2YXIgZm9sZGVkUmFuZ2VzID0gW107XG4gICAgICAgIHZhciBjdXJyTGluZU51bWJlciA9IDA7XG4gICAgICAgIHZhciBjdXJySW5kZW50YXRpb24gPSAwO1xuICAgICAgICB2YXIgZWRpdG9yVG9vbHRpcHMgPSBbXTtcbiAgICAgICAgdmFyIGVkaXRvckNvbW1hbmRzID0ge1xuICAgICAgICAgICAgbWFya0hpbnQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIG1hcmtIaW50cy5wdXNoKGFyZ3VtZW50cyk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmVhZE9ubHlUb2tlbjogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICByZWFkT25seVRva2Vucy5wdXNoKGFyZ3VtZW50cyk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgYmVnaW5SZWFkT25seTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgcmVhZE9ubHlSYW5nZXMucHVzaChbY3VyckxpbmVOdW1iZXJdKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBlbmRSZWFkT25seTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdmFyIGN1cnJSYW5nZSA9IHJlYWRPbmx5UmFuZ2VzW3JlYWRPbmx5UmFuZ2VzLmxlbmd0aCAtIDFdO1xuICAgICAgICAgICAgICAgIGN1cnJSYW5nZS5wdXNoKGN1cnJMaW5lTnVtYmVyKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBiZWdpbkNvZGVGb2xkOiBmdW5jdGlvbihsaW5rVGV4dCkge1xuICAgICAgICAgICAgICAgIGZvbGRlZFJhbmdlcy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgYmVnaW46IGN1cnJMaW5lTnVtYmVyLFxuICAgICAgICAgICAgICAgICAgICBpbmRlbnRhdGlvbjogY3VyckluZGVudGF0aW9uLFxuICAgICAgICAgICAgICAgICAgICBsaW5rVGV4dDogbGlua1RleHQgfHwgJ01vcmVcXHUyMDI2J1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVuZENvZGVGb2xkOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB2YXIgY3VyclJhbmdlID0gZm9sZGVkUmFuZ2VzW2ZvbGRlZFJhbmdlcy5sZW5ndGggLSAxXTtcbiAgICAgICAgICAgICAgICBjdXJyUmFuZ2UuZW5kID0gY3VyckxpbmVOdW1iZXI7XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICBpbnNlcnRUb29sdGlwOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIGVkaXRvclRvb2x0aXBzLnB1c2goYXJndW1lbnRzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICBjb25zb2xlLmxvZyhcIkNvdXJzZSByZXRyaWV2ZWQ6IFwiKTtcbiAgICAgICAgY29uc29sZS5sb2coZGF0YSk7XG5cbiAgICAgICAgLy8gTm9ybWFsaXplIHdoaXRlc3BhY2UgaWYgd2UncmUgb24gd2luZG93cy5cbiAgICAgICAgZGF0YSA9IGRhdGEucmVwbGFjZSgvXFxyXFxuL2csICdcXG4nKTtcblxuICAgICAgICAvLyBXZSB3YW50IHRvIG1ha2UgaXQgbGVzcyBsaWtlbHkgdGhhdCB0aGUgdXNlciBhY2NpZGVudGFsbHlcbiAgICAgICAgLy8gZGVsZXRlcyB0aGUgY2xvc2luZyBicmFjZSBvZiBhIGZ1bmN0aW9uIGRlZmluaXRpb24gb3IgYWRkc1xuICAgICAgICAvLyBjb2RlIGFmdGVyIGl0LCBzbyB3ZSdsbCBtb3ZlIGl0IHdheSBkb3duIHRvIHRoZSBib3R0b20gb2ZcbiAgICAgICAgLy8gdGhlIGZpbGUgd2l0aCBwbGVudHkgb2Ygd2hpdGUtc3BhY2UgaW4gYmV0d2Vlbi5cbiAgICAgICAgZGF0YSA9IGRhdGEucmVwbGFjZSgvfVxcbiokLywgJ1xcblxcblxcblxcblxcblxcblxcblxcblxcblxcbn1cXG4nKTtcblxuICAgICAgICBkYXRhID0gZGF0YS5zcGxpdCgnXFxuJykuZmlsdGVyKGZ1bmN0aW9uKGxpbmUpIHtcbiAgICAgICAgICAgIHZhciBtYXRjaCA9IGxpbmUubWF0Y2goLyhcXHMqKVxcL1xcL1xccypFRElUT1I6KC4qKS8pO1xuICAgICAgICAgICAgaWYgKCFtYXRjaCkge1xuICAgICAgICAgICAgICAgIGN1cnJMaW5lTnVtYmVyKys7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGN1cnJJbmRlbnRhdGlvbiA9IG1hdGNoWzFdO1xuICAgICAgICAgICAgd2l0aCAoZWRpdG9yQ29tbWFuZHMpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIkV4ZWN1dGluZyBlZGl0b3IgY29tbWFuZDogXCIgKyBtYXRjaFsyXSk7XG4gICAgICAgICAgICAgICAgZXZhbChtYXRjaFsyXSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfSkuam9pbignXFxuJyk7XG5cbiAgICAgICAgb3JpZ2luYWxFZGl0b3JDb250ZW50ID0gZGF0YTtcbiAgICAgICAgZWRpdG9yX2pzLnNldFZhbHVlKGRhdGEpO1xuICAgICAgICAvLyBNYXJrIGVkaXRvciBhcyBjbGVhbiBhZnRlciBpbnNlcnRpbmcgdGhlIGJhc2UgdGVtcGxhdGUgdG8gaGFuZGxlIFVuZG8gZGlzcGxheVxuICAgICAgICBlZGl0b3JfanMubWFya0NsZWFuKCk7XG4gICAgICAgIC8vIFNpbmNlIHRoZSBlZGl0b3Igd2lsbCBiZSBjbGVhbiB0byBzdGFydCB3aXRoLCBkaXNhYmxlIFVuZG9cbiAgICAgICAgJChcIiN1bmRvXCIpLnByb3AoXCJkaXNhYmxlZFwiLHRydWUpO1xuXG4gICAgICAgIC8vIE1ha2UgdGhlIGZpcnN0IGxpbmUgcmVhZC1vbmx5LlxuICAgICAgICByZWFkT25seVJhbmdlcy5wdXNoKFswLCAxXSk7XG5cbiAgICAgICAgLy8gTWFrZSB0aGUgbGFzdCB0d28gbGluZXMgcmVhZC1vbmx5LlxuICAgICAgICByZWFkT25seVJhbmdlcy5wdXNoKFtlZGl0b3JfanMubGluZUNvdW50KCkgLSAyLCBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWRpdG9yX2pzLmxpbmVDb3VudCgpXSk7XG5cbiAgICAgICAgcmVhZE9ubHlSYW5nZXMuZm9yRWFjaChmdW5jdGlvbihyYW5nZSkge1xuICAgICAgICAgICAgZWRpdG9yX2pzLm1hcmtUZXh0KHtsaW5lOiByYW5nZVswXSwgY2g6IDB9LCB7XG4gICAgICAgICAgICAgIGxpbmU6IHJhbmdlWzFdLFxuICAgICAgICAgICAgICBjaDogMFxuICAgICAgICAgICAgfSwge1xuICAgICAgICAgICAgICBjbGFzc05hbWU6ICdqcy1yZWFkLW9ubHknLFxuICAgICAgICAgICAgICByZWFkT25seTogdHJ1ZVxuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcblxuICAgICAgICByZWFkT25seVRva2Vucy5mb3JFYWNoKGZ1bmN0aW9uKGFyZ3VtZW50cykge1xuICAgICAgICAgICAgcmVhZE9ubHlUb2tlbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgICB9KTtcblxuICAgICAgICBtYXJrSGludHMuZm9yRWFjaChmdW5jdGlvbihhcmd1bWVudHMpIHtcbiAgICAgICAgICAgIG1hcmtIaW50LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgICQoXCIjanNfZWRpdG9yXCIpLnJlbW92ZUNsYXNzKCdzaG93LWpzLWhpbnRzJyk7XG5cbiAgICAgICAgaWYgKG1hcmtIaW50cy5sZW5ndGgpIHtcbiAgICAgICAgICAgICQoXCIjc2hvd0hpbnRzXCIpLnNob3coKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICQoXCIjc2hvd0hpbnRzXCIpLmhpZGUoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZvbGRlZFJhbmdlcy5mb3JFYWNoKGZ1bmN0aW9uKHJhbmdlKSB7XG4gICAgICAgICAgICB2YXIgc3RhcnQgPSB7bGluZTogcmFuZ2UuYmVnaW4sIGNoOiAwfTtcbiAgICAgICAgICAgIHZhciBzcGFuID0gJCgnPHNwYW4gY2xhc3M9XCJjbS1jb21tZW50XCI+JyArIHJhbmdlLmluZGVudGF0aW9uICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAnLy8gPC9zcGFuPicpO1xuICAgICAgICAgICAgJCgnPHNwYW4gY2xhc3M9XCJqcy1jb2RlLWZvbGQtbGlua1wiPjwvc3Bhbj4nKVxuICAgICAgICAgICAgICAudGV4dChyYW5nZS5saW5rVGV4dClcbiAgICAgICAgICAgICAgLmFwcGVuZFRvKHNwYW4pO1xuICAgICAgICAgICAgZWRpdG9yX2pzLmZvbGRDb2RlKHN0YXJ0LCB7XG4gICAgICAgICAgICAgICAgd2lkZ2V0OiBzcGFuWzBdLFxuICAgICAgICAgICAgICAgIHJhbmdlRmluZGVyOiBmdW5jdGlvbihjbSwgcG9zKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmcm9tOiBzdGFydCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGluZTogcmFuZ2UuZW5kIC0gMSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaDogZWRpdG9yX2pzLmdldExpbmUocmFuZ2UuZW5kIC0gMSkubGVuZ3RoXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGVkaXRvclRvb2x0aXBzLmZvckVhY2goZnVuY3Rpb24oYXJndW1lbnRzKXtcbiAgICAgICAgICAgIGluc2VydEVkaXRvVG9vbHRpcC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgICB9KTtcblxuICAgICAgICBjYigpO1xuICAgIH0pO1xuICAgIFxuICAgIC8vIFNldCBzZXNzaW9uIHN0b3JhZ2UgYW5kIHJlbG9hZCB0aGUgaWZyYW1lIHRvIGJlIHN5bmNoZWRcbiAgICBzdG9yYWdlLnNldCgnY3VycmVudExldmVsJywgY3VycmVudExldmVsKTtcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJldmlldycpLmNvbnRlbnRXaW5kb3cubG9jYXRpb24ucmVsb2FkKCk7XG59XG5cbmZ1bmN0aW9uIHNob3dIaW50cygpIHtcbiAgICAkKFwiI2pzX2VkaXRvclwiKS5hZGRDbGFzcygnc2hvdy1qcy1oaW50cycpO1xuICAgICQoXCIjc2hvd0hpbnRzXCIpLmZhZGVPdXQoKTtcbn1cblxuZnVuY3Rpb24gbmV4dExldmVsKCl7XG4gICAgY3VycmVudExldmVsID09IG1heExldmVsID8gbWF4TGV2ZWwgOiBjdXJyZW50TGV2ZWwrKztcbiAgICBcbiAgICAvL1VwZGF0ZSBpZnJhbWUgc291cmNlXG4gICAgLy8gJCgnaWZyYW1lI3ByZXZpZXcnKS5hdHRyKCdzcmMnLCAncHJvamVjdF90ZW1wbGF0ZS9pbmRleCcrY3VycmVudExldmVsKycuaHRtbCcpO1xuICAgIC8vICRpbnN0cnVjdGlvbnMuZmluZChcImgzXCIpLnRleHQoaW5zdHJ1Y3Rpb25zW1wibGV2ZWxcIitjdXJyZW50TGV2ZWxdLnRpdGxlKTtcbiAgICAvLyAkaW5zdHJ1Y3Rpb25zLmZpbmQoXCJwXCIpLnRleHQoaW5zdHJ1Y3Rpb25zW1wibGV2ZWxcIitjdXJyZW50TGV2ZWxdLmNvbnRlbnQpO1xuICAgIGxvYWRNaW5pQ291cnNlKCk7XG59XG5cbmZ1bmN0aW9uIHByZXZMZXZlbCgpe1xuICAgIGN1cnJlbnRMZXZlbCA9PSAxID8gMSA6IGN1cnJlbnRMZXZlbC0tO1xuICAgIFxuICAgIC8vVXBkYXRlIGlmcmFtZSBzb3VyY2VcbiAgICAvLyAkKCdpZnJhbWUjcHJldmlldycpLmF0dHIoJ3NyYycsICdwcm9qZWN0X3RlbXBsYXRlL2luZGV4JytjdXJyZW50TGV2ZWwrJy5odG1sJyk7XG4gICAgLy8gJGluc3RydWN0aW9ucy5maW5kKFwiaDNcIikudGV4dChpbnN0cnVjdGlvbnNbXCJsZXZlbFwiK2N1cnJlbnRMZXZlbF0udGl0bGUpO1xuICAgIC8vICRpbnN0cnVjdGlvbnMuZmluZChcInBcIikudGV4dChpbnN0cnVjdGlvbnNbXCJsZXZlbFwiK2N1cnJlbnRMZXZlbF0uY29udGVudCk7XG4gICAgbG9hZE1pbmlDb3Vyc2UoKTtcbn1cbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
