function startWalkthrough(){$(document).foundation("joyride","start",{pre_ride_callback:function(){$("#showHints").css("display","block"),$("#previous").css("display","block"),$("#next").css("display","block")},pre_step_callback:function(){console.log(this.$target.first().attr("id")),"preview"==this.$target.first().attr("id")?$("iframe").contents().find("canvas").addClass("joyride-highlight"):this.$target.first().addClass("joyride-highlight")},post_step_callback:function(){"preview"==this.$target.first().attr("id")?$("iframe").contents().find("canvas").removeClass("joyride-highlight"):this.$target.first().removeClass("joyride-highlight")},post_ride_callback:function(){console.log("JOYRIDE CLOSED"),$("#showHints").css("display","none"),$("#previous").css("display","none"),$("#next").css("display","none")},abort_on_close:!1})}function levelSelectMenu(){$("#levelSelectMenuModal").foundation("reveal","open")}function skipToLevel(e){return $("#levelSelectMenuModal").foundation("reveal","close"),"sandbox"==e?(storage.set("skipToSandbox",!0),void loadMiniCourse()):(currentLevel=e,void loadMiniCourse())}function revertMiniCourse(){loadMiniCourse(refreshPreview)}function publishPrompt(){$("#publishModal").foundation("reveal","open")}function undo(){editor_js.undo()}function publish(){console.log("PARENT PUBLISH"),generatedHTML=null,MinicoursePublisher.generateHTML({baseURL:"./mini/",baseLevel:maxLevel,js:editor_js.getValue(),formInfo:'<span id="first_name">'+$("#first_name").val().charAt(0).toUpperCase()+$("#first_name").val().slice(1)+'</span> from <span id="school">'+$("#00NU0000005PN7e").val()+'</span><span id="grade" style="display: none;">'+$("#grade").val()+'</span><span id="city" style="display: none;">'+$("#city").val()+'</span><span id="state" style="display: none;">'+$("#state").val()+'</span><span id="country" style="display: none;">'+$("#country").val()+"</span>"},function(e,n){return e?void alert("Error generating published HTML: "+e.message):(generatedHTML=n,generatedHTML?($("#published").hide(),$("#publishing").fadeIn(),void $.ajax({type:"POST",url:"https://publish.emcl.com/publish",data:{html:generatedHTML},crossDomain:!0,dataType:"json",error:function(e,n,o){alert("It looks like something went wrong. Please verify your internet connection and click Publish again."),console.log(arguments),ga("send","event","Ajax Error",n,"publisher",{nonInteraction:1})},success:function(e){var n=e["published-url"];language&&"es"==language&&(n+="?lang=es"),n=n.replace("globaloria.com","carnegielearning.com"),n=n.replace("myglife.org","carnegielearning.com"),$("#published").fadeIn().find("a").attr("href",n).text(n)},complete:function(){$("#publishing").hide()}})):void alert("There was an error publishing your game. Please try again later!"))})}function loadMiniCourse(cb){cb=cb||function(){};var zeroPaddedLevel=currentLevel<10?"0"+currentLevel:currentLevel;"true"==storage.get("skipToSandbox")?(zeroPaddedLevel=maxLevel,$("#levelMenu").css("display","none")):$("#levelMenu").css("display","block");var codeUrl="mini/"+languagePath+"levels/"+zeroPaddedLevel+".js";remixUrl&&"true"==storage.get("skipToSandbox")&&(codeUrl=window.location.href.match(/makequest.carnegielearning.com/)?"https://mymakequest.carnegielearning.com/"+remixUrl[1]:"https://hackpub-publisher-dev.s3.amazonaws.com/"+remixUrl[1]),$.get(codeUrl,function(data){if(remixUrl){debug2=data;var remixCode=data.match(/<script id="published-level-code">([\s\S])+?<\/script>/g);remixCode&&(data=remixCode[0].replace('<script id="published-level-code">',"").replace("</script>",""))}var markHints=[],readOnlyTokens=[],readOnlyRanges=[],foldedRanges=[],currLineNumber=0,currIndentation=0,editorTooltips=[],editorCommands={markHint:function(){markHints.push(arguments)},readOnlyToken:function(){readOnlyTokens.push(arguments)},beginReadOnly:function(){readOnlyRanges.push([currLineNumber])},endReadOnly:function(){var e=readOnlyRanges[readOnlyRanges.length-1];e.push(currLineNumber)},beginCodeFold:function(e){foldedRanges.push({begin:currLineNumber,indentation:currIndentation,linkText:e||"Moreâ€¦"})},endCodeFold:function(){var e=foldedRanges[foldedRanges.length-1];e.end=currLineNumber},insertTooltip:function(){editorTooltips.push(arguments)}};data=data.replace(/\r\n/g,"\n"),data=data.replace(/}\n*$/,"\n\n\n\n\n\n\n\n\n\n}\n"),data=data.split("\n").filter(function(line){var match=line.match(/(\s*)\/\/\s*EDITOR:(.*)/);if(!match)return currLineNumber++,!0;with(currIndentation=match[1],editorCommands)console.log("Executing editor command: "+match[2]),eval(match[2]);return!1}).join("\n"),originalEditorContent=data,editor_js.setValue(data),editor_js.markClean(),$("#undo").prop("disabled",!0),readOnlyRanges.push([0,1]),readOnlyRanges.push([editor_js.lineCount()-2,editor_js.lineCount()]),readOnlyRanges.forEach(function(e){editor_js.markText({line:e[0],ch:0},{line:e[1],ch:0},{className:"js-read-only",readOnly:!0})}),readOnlyTokens.forEach(function(arguments){readOnlyToken.apply(this,arguments)}),markHints.forEach(function(arguments){markHint.apply(this,arguments)}),$("#js_editor").removeClass("show-js-hints"),markHints.length?$("#showHints").show():$("#showHints").hide(),foldedRanges.forEach(function(e){var n={line:e.begin,ch:0},o=$('<span class="cm-comment">'+e.indentation+"// </span>");$('<span class="js-code-fold-link"></span>').text(e.linkText).appendTo(o),editor_js.foldCode(n,{widget:o[0],rangeFinder:function(o,t){return{from:n,to:{line:e.end-1,ch:editor_js.getLine(e.end-1).length}}}})}),editorTooltips.forEach(function(arguments){insertEditoTooltip.apply(this,arguments)}),cb()}),storage.set("currentLevel",currentLevel),document.getElementById("preview").contentWindow.location.reload()}function showHints(){$("#js_editor").addClass("show-js-hints"),$("#showHints").fadeOut()}function nextLevel(){currentLevel==maxLevel?maxLevel:currentLevel++,loadMiniCourse()}function prevLevel(){1==currentLevel?1:currentLevel--,loadMiniCourse()}for(var maxLevel=gameConstants.MAX_LEVEL,remixUrl=window.location.href.match(/remix=(.+)/),queryParams=window.location.search.substring(1).split("&"),language="",languagePath="",i=0;i<queryParams.length;i++)queryParams[i].indexOf("lang")>-1&&(language=queryParams[i].split("=")[1],languagePath=language+"/");$(document).ready(function(){storage.set("languagePath",languagePath),storage.set("skipToSandbox",!1),remixUrl&&storage.set("skipToSandbox",!0),$("main").css("height",window.innerHeight-36),remixUrl||startWalkthrough(),$(document).on("close.fndtn.reveal","#welcomeModal",function(){startWalkthrough()}),$(document).on("click",".joyride-close-tip",function(){console.log(this)});var e=0,n=window.location.search.match(/debugLevel=(\d+)/);n&&(e=parseInt(n[1])),window.sessionStorage.currentLevel=e,currentLevel=e,$instructions=$("#instructions"),$(document).on("click","span.tooltip",function(){Foundation.libs.tooltip.hide($("#editor-tooltip")),$(this).remove(),$("#editor-tooltip").remove()}),$(document).on("click","#signupButton",function(e){e.preventDefault(),console.log("signup"),console.log(this);var n=document.getElementById("sign_up_email").value,o=document.getElementById("sign_up_password").value;createUserAndLogin({email:n,password:o}),$("#signupModal").foundation("reveal","close")}),$(document).on("click","#logout",function(e){e.preventDefault(),console.log("logout"),console.log(this),logout()}),loadMiniCourse(refreshPreview),setTimeout(function(){console.log("REFRESH 2000"),refreshPreview()},2e3),$("iframe#preview").attr("src","mini/index.html").focus(),$("form #00NU0000005PN7j").on("change",function(){console.log($(this).prop("checked")),$(this).prop("checked")?($("#first_name").prop("disabled",!1),$("#email").prop("disabled",!1),$("#phone").prop("disabled",!1)):($("#first_name").val(""),$("#email").val(""),$("#phone").val(""),$("#first_name").prop("disabled",!0),$("#email").prop("disabled",!0),$("#phone").prop("disabled",!0))}),$("#publish-form").submit(function(e){return console.log("VALIDATING"),""==$("#00NU0000005PN7e").val()||""==$("#city").val()||""==$("#country").val()||""==$("#state").val()?(console.log("VALIDATION FAILED"),!1):(console.log("PUBLISHING"),publish(),e.preventDefault(),!1)})});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpzL21haW4uanMiXSwibmFtZXMiOlsic3RhcnRXYWxrdGhyb3VnaCIsIiQiLCJkb2N1bWVudCIsImZvdW5kYXRpb24iLCJwcmVfcmlkZV9jYWxsYmFjayIsImNzcyIsInByZV9zdGVwX2NhbGxiYWNrIiwiY29uc29sZSIsImxvZyIsInRoaXMiLCIkdGFyZ2V0IiwiZmlyc3QiLCJhdHRyIiwiY29udGVudHMiLCJmaW5kIiwiYWRkQ2xhc3MiLCJwb3N0X3N0ZXBfY2FsbGJhY2siLCJyZW1vdmVDbGFzcyIsInBvc3RfcmlkZV9jYWxsYmFjayIsImFib3J0X29uX2Nsb3NlIiwibGV2ZWxTZWxlY3RNZW51Iiwic2tpcFRvTGV2ZWwiLCJsZXZlbCIsInN0b3JhZ2UiLCJzZXQiLCJsb2FkTWluaUNvdXJzZSIsImN1cnJlbnRMZXZlbCIsInJldmVydE1pbmlDb3Vyc2UiLCJyZWZyZXNoUHJldmlldyIsInB1Ymxpc2hQcm9tcHQiLCJ1bmRvIiwiZWRpdG9yX2pzIiwicHVibGlzaCIsImdlbmVyYXRlZEhUTUwiLCJNaW5pY291cnNlUHVibGlzaGVyIiwiZ2VuZXJhdGVIVE1MIiwiYmFzZVVSTCIsImJhc2VMZXZlbCIsIm1heExldmVsIiwianMiLCJnZXRWYWx1ZSIsImZvcm1JbmZvIiwidmFsIiwiY2hhckF0IiwidG9VcHBlckNhc2UiLCJzbGljZSIsImVyciIsImh0bWwiLCJhbGVydCIsIm1lc3NhZ2UiLCJoaWRlIiwiZmFkZUluIiwiYWpheCIsInR5cGUiLCJ1cmwiLCJkYXRhIiwiY3Jvc3NEb21haW4iLCJkYXRhVHlwZSIsImVycm9yIiwieGhyIiwic3RhdHVzIiwiYXJndW1lbnRzIiwiZ2EiLCJub25JbnRlcmFjdGlvbiIsInN1Y2Nlc3MiLCJsYW5ndWFnZSIsInJlcGxhY2UiLCJ0ZXh0IiwiY29tcGxldGUiLCJjYiIsInplcm9QYWRkZWRMZXZlbCIsImdldCIsImNvZGVVcmwiLCJsYW5ndWFnZVBhdGgiLCJyZW1peFVybCIsIndpbmRvdyIsImxvY2F0aW9uIiwiaHJlZiIsIm1hdGNoIiwiZGVidWcyIiwicmVtaXhDb2RlIiwibWFya0hpbnRzIiwicmVhZE9ubHlUb2tlbnMiLCJyZWFkT25seVJhbmdlcyIsImZvbGRlZFJhbmdlcyIsImN1cnJMaW5lTnVtYmVyIiwiY3VyckluZGVudGF0aW9uIiwiZWRpdG9yVG9vbHRpcHMiLCJlZGl0b3JDb21tYW5kcyIsIm1hcmtIaW50IiwicHVzaCIsInJlYWRPbmx5VG9rZW4iLCJiZWdpblJlYWRPbmx5IiwiZW5kUmVhZE9ubHkiLCJjdXJyUmFuZ2UiLCJsZW5ndGgiLCJiZWdpbkNvZGVGb2xkIiwibGlua1RleHQiLCJiZWdpbiIsImluZGVudGF0aW9uIiwiZW5kQ29kZUZvbGQiLCJlbmQiLCJpbnNlcnRUb29sdGlwIiwic3BsaXQiLCJmaWx0ZXIiLCJsaW5lIiwiZXZhbCIsImpvaW4iLCJvcmlnaW5hbEVkaXRvckNvbnRlbnQiLCJzZXRWYWx1ZSIsIm1hcmtDbGVhbiIsInByb3AiLCJsaW5lQ291bnQiLCJmb3JFYWNoIiwicmFuZ2UiLCJtYXJrVGV4dCIsImNoIiwiY2xhc3NOYW1lIiwicmVhZE9ubHkiLCJhcHBseSIsInNob3ciLCJzdGFydCIsInNwYW4iLCJhcHBlbmRUbyIsImZvbGRDb2RlIiwid2lkZ2V0IiwicmFuZ2VGaW5kZXIiLCJjbSIsInBvcyIsImZyb20iLCJ0byIsImdldExpbmUiLCJpbnNlcnRFZGl0b1Rvb2x0aXAiLCJnZXRFbGVtZW50QnlJZCIsImNvbnRlbnRXaW5kb3ciLCJyZWxvYWQiLCJzaG93SGludHMiLCJmYWRlT3V0IiwibmV4dExldmVsIiwicHJldkxldmVsIiwiZ2FtZUNvbnN0YW50cyIsIk1BWF9MRVZFTCIsInF1ZXJ5UGFyYW1zIiwic2VhcmNoIiwic3Vic3RyaW5nIiwiaSIsImluZGV4T2YiLCJyZWFkeSIsImlubmVySGVpZ2h0Iiwib24iLCJzdGFydExldmVsIiwiZGVidWdMZXZlbCIsInBhcnNlSW50Iiwic2Vzc2lvblN0b3JhZ2UiLCIkaW5zdHJ1Y3Rpb25zIiwiRm91bmRhdGlvbiIsImxpYnMiLCJ0b29sdGlwIiwicmVtb3ZlIiwiZSIsInByZXZlbnREZWZhdWx0IiwiZW1haWwiLCJ2YWx1ZSIsInBhc3N3b3JkIiwiY3JlYXRlVXNlckFuZExvZ2luIiwibG9nb3V0Iiwic2V0VGltZW91dCIsImZvY3VzIiwic3VibWl0IiwiZXZlbnQiXSwibWFwcGluZ3MiOiJBQThKQSxRQUFTQSxvQkFDTEMsRUFBRUMsVUFBVUMsV0FBVyxVQUFXLFNBRTlCQyxrQkFBeUIsV0FFQ0gsRUFBRSxjQUFjSSxJQUFJLFVBQVcsU0FDL0JKLEVBQUUsYUFBYUksSUFBSSxVQUFXLFNBQzlCSixFQUFFLFNBQVNJLElBQUksVUFBVyxVQUVwREMsa0JBQXlCLFdBQ0NDLFFBQVFDLElBQUlDLEtBQUtDLFFBQVFDLFFBQVFDLEtBQUssT0FDQSxXQUFuQ0gsS0FBS0MsUUFBUUMsUUFBUUMsS0FBSyxNQUMzQlgsRUFBRSxVQUFVWSxXQUFXQyxLQUFLLFVBQVVDLFNBQVMscUJBRS9DTixLQUFLQyxRQUFRQyxRQUFRSSxTQUFTLHNCQUcxREMsbUJBQXlCLFdBQ3VDLFdBQW5DUCxLQUFLQyxRQUFRQyxRQUFRQyxLQUFLLE1BQzNCWCxFQUFFLFVBQVVZLFdBQVdDLEtBQUssVUFBVUcsWUFBWSxxQkFFbERSLEtBQUtDLFFBQVFDLFFBQVFNLFlBQVksc0JBRzdEQyxtQkFBeUIsV0FDRFgsUUFBUUMsSUFBSSxrQkFFVlAsRUFBRSxjQUFjSSxJQUFJLFVBQVcsUUFDL0JKLEVBQUUsYUFBYUksSUFBSSxVQUFXLFFBQzlCSixFQUFFLFNBQVNJLElBQUksVUFBVyxTQUVwRGMsZ0JBQTJCLElBSW5DLFFBQVNDLG1CQUNQbkIsRUFBRSx5QkFBeUJFLFdBQVcsU0FBVSxRQUdsRCxRQUFTa0IsYUFBWUMsR0FHakIsTUFGQXJCLEdBQUUseUJBQXlCRSxXQUFXLFNBQVUsU0FFcEMsV0FBVG1CLEdBQ0NDLFFBQVFDLElBQUksaUJBQWlCLE9BQzdCQyxvQkFJSkMsYUFBZUosTUFDZkcsbUJBR0osUUFBU0Usb0JBQ0xGLGVBQWVHLGdCQUduQixR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WSxHQUM3QjlHLEVBQUUsVUFBVThHLEtBQUssWUFBWSxLQUU3QjlHLEVBQUUsZUFBZXlDLElBQUksSUFFckJ6QyxFQUFFLFVBQVV5QyxJQUFJLElBQ2hCekMsRUFBRSxVQUFVeUMsSUFBSSxJQUVoQnpDLEVBQUUsZUFBZThHLEtBQUssWUFBWSxHQUVsQzlHLEVBQUUsVUFBVThHLEtBQUssWUFBWSxHQUM3QjlHLEVBQUUsVUFBVThHLEtBQUssWUFBWSxNQUlyQzlHLEVBQUUsaUJBQWlCdUssT0FBTyxTQUFTQyxHQUcvQixNQUZBbEssU0FBUUMsSUFBSSxjQUV1QixJQUEvQlAsRUFBRSxvQkFBb0J5QyxPQUNDLElBQXBCekMsRUFBRSxTQUFTeUMsT0FDWSxJQUF2QnpDLEVBQUUsWUFBWXlDLE9BQ08sSUFBckJ6QyxFQUFFLFVBQVV5QyxPQUVmbkMsUUFBUUMsSUFBSSxzQkFDTCxJQU1YRCxRQUFRQyxJQUFJLGNBQ1p3QixVQUNBeUksRUFBTVQsa0JBQ0MiLCJmaWxlIjoianMvbWFpbi5qcyIsInNvdXJjZXNDb250ZW50IjpbInZhciBtYXhMZXZlbCA9IGdhbWVDb25zdGFudHMuTUFYX0xFVkVMO1xuLy8gQ2hlY2sgaWYgd2UncmUgYWNjZXNzaW5nIGEgcmVtaXggdXJsLCBpZiBzbywgc3RvcmUgdGhlIHVybCBmb3IgbGF0ZXIgdXNlXG52YXIgcmVtaXhVcmwgPSB3aW5kb3cubG9jYXRpb24uaHJlZi5tYXRjaCgvcmVtaXg9KC4rKS8pO1xuXG4vLyBTZXQgbGFuZ3VhZ2VcbnZhciBxdWVyeVBhcmFtcyA9IHdpbmRvdy5sb2NhdGlvbi5zZWFyY2guc3Vic3RyaW5nKDEpLnNwbGl0KCcmJyk7XG4vLyBEZWZhdWx0IHRvIGVuZ2xpc2ggPT4gJydcbnZhciBsYW5ndWFnZSA9ICcnO1xudmFyIGxhbmd1YWdlUGF0aCA9ICcnO1xuZm9yICh2YXIgaSA9IDA7IGkgPCBxdWVyeVBhcmFtcy5sZW5ndGg7IGkrKykge1xuICAgIGlmKHF1ZXJ5UGFyYW1zW2ldLmluZGV4T2YoJ2xhbmcnKT4tMSl7XG4gICAgICBsYW5ndWFnZSA9IHF1ZXJ5UGFyYW1zW2ldLnNwbGl0KCc9JylbMV07XG4gICAgICBsYW5ndWFnZVBhdGggPSBsYW5ndWFnZSsnLyc7XG4gICAgfVxufVxuXG4kKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHtcbiAgICAvLyBTZXQgbGFuZ3VhZ2UgaW4gc3RvcmFnZVxuICAgIHN0b3JhZ2Uuc2V0KCdsYW5ndWFnZVBhdGgnLCBsYW5ndWFnZVBhdGgpO1xuICAgIFxuICAgIC8vIERvbid0IHN0YXJ0IGluIHNhbmRib3ggaWYgdGhlIHBhZ2UgaXMgcmVmcmVzaGVkIGFuZCB3ZSdyZSBub3QgaW4gcmVtaXggbW9kZVxuICAgIHN0b3JhZ2Uuc2V0KCdza2lwVG9TYW5kYm94JywgZmFsc2UpO1xuICAgIGlmKHJlbWl4VXJsKXtcbiAgICAgICAgc3RvcmFnZS5zZXQoJ3NraXBUb1NhbmRib3gnLCB0cnVlKTtcbiAgICB9XG5cbiAgICAvL1Jlc2l6ZSB0byB2aWV3cG9ydFxuICAgICQoXCJtYWluXCIpLmNzcyhcImhlaWdodFwiLCB3aW5kb3cuaW5uZXJIZWlnaHQtMzYpO1xuXG4gICAgXG5cbiAgICAvL09wZW4gd2VsY29tZSBtb2RhbCBvbiBmaXJzdCBsb2FkXG4gICAgLy8gY29kZS5nbG9iYWxvcmlhLmNvbSBvbmx5XG4gICAgLy8gJCgnI3dlbGNvbWVNb2RhbCcpLmZvdW5kYXRpb24oJ3JldmVhbCcsICdvcGVuJyk7XG4gICAgXG4gICAgLy9PcGVuIHdhbGt0aHJvdWdoIG9uIGZpcnN0IGxvYWRcbiAgICAvLyBtYWtlcXVlc3QuZ2xvYmFsb3JpYS5jb20gb25seVxuICAgIGlmKCAhcmVtaXhVcmwgKXtcbiAgICAgICAgc3RhcnRXYWxrdGhyb3VnaCgpO1xuICAgIH1cblxuXG5cblxuICAgIC8vIEluaXQgam95cmlkZSBhZnRlciBXZWxjb21lIE1vZGFsXG4gICAgJChkb2N1bWVudCkub24oJ2Nsb3NlLmZuZHRuLnJldmVhbCcsICcjd2VsY29tZU1vZGFsJywgZnVuY3Rpb24gKCkge1xuICAgICAgXG4gICAgICAgIHN0YXJ0V2Fsa3Rocm91Z2goKTtcbiAgICAgIFxuICAgIH0pO1xuICAgICQoZG9jdW1lbnQpLm9uKCdjbGljaycsICcuam95cmlkZS1jbG9zZS10aXAnLCBmdW5jdGlvbigpe1xuICAgICAgY29uc29sZS5sb2codGhpcyk7XG4gICAgfSk7XG5cblxuICAgIHZhciBzdGFydExldmVsID0gMDtcbiAgICB2YXIgZGVidWdMZXZlbCA9IHdpbmRvdy5sb2NhdGlvbi5zZWFyY2gubWF0Y2goL2RlYnVnTGV2ZWw9KFxcZCspLyk7XG5cbiAgICBpZiAoZGVidWdMZXZlbCkge1xuICAgICAgICBzdGFydExldmVsID0gcGFyc2VJbnQoZGVidWdMZXZlbFsxXSk7XG4gICAgfVxuXG5cbiAgICAvL1Jlc2V0IHNlc3Npb25TdG9yYWdlIHRvIGtlZXAgZWRpdG9yIGFuZCBpZnJhbWUgaW4gc3luY1xuICAgIHdpbmRvdy5zZXNzaW9uU3RvcmFnZVsnY3VycmVudExldmVsJ10gPSBzdGFydExldmVsO1xuXG4gICAgY3VycmVudExldmVsID0gc3RhcnRMZXZlbDtcblxuICAgICRpbnN0cnVjdGlvbnMgPSAkKFwiI2luc3RydWN0aW9uc1wiKTtcblxuICAgIC8vUmVtb3ZlIHRvb2x0aXBzIGZyb20gY29kZSBlZGl0b3JcbiAgICAkKGRvY3VtZW50KS5vbignY2xpY2snLCAnc3Bhbi50b29sdGlwJywgZnVuY3Rpb24oKXtcbiAgICAgICAgRm91bmRhdGlvbi5saWJzLnRvb2x0aXAuaGlkZSggJCgnI2VkaXRvci10b29sdGlwJykgKTtcbiAgICAgICAgJCh0aGlzKS5yZW1vdmUoKTtcbiAgICAgICAgJCgnI2VkaXRvci10b29sdGlwJykucmVtb3ZlKCk7XG4gICAgfSk7XG5cbiAgICAkKGRvY3VtZW50KS5vbignY2xpY2snLCAnI3NpZ251cEJ1dHRvbicsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBjb25zb2xlLmxvZyhcInNpZ251cFwiKTtcbiAgICAgICAgY29uc29sZS5sb2codGhpcyk7XG4gICAgICAgIFxuICAgICAgICB2YXIgZW1haWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2lnbl91cF9lbWFpbCcpLnZhbHVlO1xuICAgICAgICB2YXIgcGFzc3dvcmQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2lnbl91cF9wYXNzd29yZCcpLnZhbHVlO1xuXG4gICAgICAgIGNyZWF0ZVVzZXJBbmRMb2dpbih7XG4gICAgICAgICAgICBlbWFpbDogZW1haWwsXG4gICAgICAgICAgICBwYXNzd29yZDogcGFzc3dvcmRcbiAgICAgICAgfSk7XG4gICAgICAgIFxuXG4gICAgICAgICQoJyNzaWdudXBNb2RhbCcpLmZvdW5kYXRpb24oJ3JldmVhbCcsICdjbG9zZScpO1xuICAgIH0pO1xuXG4gICAgJChkb2N1bWVudCkub24oJ2NsaWNrJywgJyNsb2dvdXQnLCBmdW5jdGlvbihlKSB7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgY29uc29sZS5sb2coXCJsb2dvdXRcIik7XG4gICAgICAgIGNvbnNvbGUubG9nKHRoaXMpO1xuXG4gICAgICAgIGxvZ291dCgpO1xuICAgIH0pO1xuXG4gICAgbG9hZE1pbmlDb3Vyc2UocmVmcmVzaFByZXZpZXcpO1xuXG4gICAgLy8gRml4IHRoaXMgdWdseSBoYWNrIHNvIHRoYXQgdGhlIGdhbWUgaXMgZGlzcGxheWVkIGNvcnJlY3RseSB3aGVuIHJlbWl4aW5nLlxuICAgIC8vIEN1cnJlbnRseSBoYXZlIHRvIGhpdCBSdW4gd2hlbiBvcGVuaW5nIGZvciBSZW1peCBvciB1c2UgdGhpcyB0aW1lb3V0IGNhbGw6IFxuICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKXtcbiAgICAgICAgY29uc29sZS5sb2coXCJSRUZSRVNIIDIwMDBcIik7XG4gICAgICAgIHJlZnJlc2hQcmV2aWV3KCk7XG4gICAgfSwgMjAwMCk7XG5cbiAgICAvL1NldCBpZnJhbWUgdG8gcmlnaHQgbGV2ZWxcbiAgICAkKCdpZnJhbWUjcHJldmlldycpLmF0dHIoJ3NyYycsICdtaW5pL2luZGV4Lmh0bWwnKS5mb2N1cygpO1xuXG4gICAgLy8gUHVibGlzaGluZyBmb3JtIHN1Ym1pc3Npb25cbiAgICAvL2lzLWFkdWx0XG4gICAgJCgnZm9ybSAjMDBOVTAwMDAwMDVQTjdqJykub24oJ2NoYW5nZScsIGZ1bmN0aW9uKCl7XG4gICAgICAgIGNvbnNvbGUubG9nKCAkKHRoaXMpLnByb3AoJ2NoZWNrZWQnKSApO1xuICAgICAgICBpZiggJCh0aGlzKS5wcm9wKCdjaGVja2VkJykgKXtcbiAgICAgICAgICAgICQoJyNmaXJzdF9uYW1lJykucHJvcCgnZGlzYWJsZWQnLCBmYWxzZSk7XG4gICAgICAgICAgICAvLyAkKCcjbGFzdF9uYW1lJykucHJvcCgnZGlzYWJsZWQnLCBmYWxzZSk7XG4gICAgICAgICAgICAkKCcjZW1haWwnKS5wcm9wKCdkaXNhYmxlZCcsIGZhbHNlKTtcbiAgICAgICAgICAgICQoJyNwaG9uZScpLnByb3AoJ2Rpc2FibGVkJywgZmFsc2UpO1xuICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICQoJyNmaXJzdF9uYW1lJykudmFsKCcnKTtcbiAgICAgICAgICAgIC8vICQoJyNsYXN0X25hbWUnKS52YWwoJycpO1xuICAgICAgICAgICAgJCgnI2VtYWlsJykudmFsKCcnKTtcbiAgICAgICAgICAgICQoJyNwaG9uZScpLnZhbCgnJyk7XG5cbiAgICAgICAgICAgICQoJyNmaXJzdF9uYW1lJykucHJvcCgnZGlzYWJsZWQnLCB0cnVlKTtcbiAgICAgICAgICAgIC8vICQoJyNsYXN0X25hbWUnKS5wcm9wKCdkaXNhYmxlZCcsIHRydWUpO1xuICAgICAgICAgICAgJCgnI2VtYWlsJykucHJvcCgnZGlzYWJsZWQnLCB0cnVlKTtcbiAgICAgICAgICAgICQoJyNwaG9uZScpLnByb3AoJ2Rpc2FibGVkJywgdHJ1ZSk7XG4gICAgICAgIH1cbiAgICB9KTtcbiAgICBcbiAgICAkKCcjcHVibGlzaC1mb3JtJykuc3VibWl0KGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiVkFMSURBVElOR1wiKTtcbiAgICAgICAgLy8gRm9ybSB2YWxpZGF0aW9uXG4gICAgICAgIGlmKCAkKCcjMDBOVTAwMDAwMDVQTjdlJykudmFsKCkgPT0gXCJcIlxuICAgICAgICAgICAgfHwgJCgnI2NpdHknKS52YWwoKSA9PSBcIlwiXG4gICAgICAgICAgICB8fCAkKCcjY291bnRyeScpLnZhbCgpID09IFwiXCJcbiAgICAgICAgICAgIHx8ICQoJyNzdGF0ZScpLnZhbCgpID09IFwiXCJcbiAgICAgICAgICAgICl7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIlZBTElEQVRJT04gRkFJTEVEXCIpO1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gUHJldmVudCBmb3JtIHN1Ym1pc3Npb25cbiAgICAgICAgLy8gUHVibGlzaCBnYW1lIGFuZCBzZXQgdXJsIGFzIHRoZSByZXR1cm4gcGFyYW1ldGVyIGZvciB0aGUgZm9ybS5cbiAgICAgICAgLy8gU3VibWl0IHRoZSBmb3JtIGZyb20gcHVibGlzaFxuICAgICAgICBjb25zb2xlLmxvZyhcIlBVQkxJU0hJTkdcIik7XG4gICAgICAgIHB1Ymxpc2goKTtcbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0pO1xufSk7XG5cbmZ1bmN0aW9uIHN0YXJ0V2Fsa3Rocm91Z2goKXtcbiAgICAkKGRvY3VtZW50KS5mb3VuZGF0aW9uKCdqb3lyaWRlJywgJ3N0YXJ0Jywge1xuICAgICAgICBcbiAgICAgICAgcHJlX3JpZGVfY2FsbGJhY2sgICAgICA6IGZ1bmN0aW9uICgpe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vRGlzcGxheSBhbGwgYnV0dG9ucyBmb3Igam95cmlkZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoXCIjc2hvd0hpbnRzXCIpLmNzcygnZGlzcGxheScsICdibG9jaycpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoXCIjcHJldmlvdXNcIikuY3NzKCdkaXNwbGF5JywgJ2Jsb2NrJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJChcIiNuZXh0XCIpLmNzcygnZGlzcGxheScsICdibG9jaycpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICBwcmVfc3RlcF9jYWxsYmFjayAgICAgIDogZnVuY3Rpb24gKCl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2codGhpcy4kdGFyZ2V0LmZpcnN0KCkuYXR0cignaWQnKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYodGhpcy4kdGFyZ2V0LmZpcnN0KCkuYXR0cignaWQnKSA9PSBcInByZXZpZXdcIil7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKFwiaWZyYW1lXCIpLmNvbnRlbnRzKCkuZmluZChcImNhbnZhc1wiKS5hZGRDbGFzcyhcImpveXJpZGUtaGlnaGxpZ2h0XCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kdGFyZ2V0LmZpcnN0KCkuYWRkQ2xhc3MoJ2pveXJpZGUtaGlnaGxpZ2h0Jyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICBwb3N0X3N0ZXBfY2FsbGJhY2sgICAgIDogZnVuY3Rpb24gKCl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYodGhpcy4kdGFyZ2V0LmZpcnN0KCkuYXR0cignaWQnKSA9PSBcInByZXZpZXdcIil7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKFwiaWZyYW1lXCIpLmNvbnRlbnRzKCkuZmluZChcImNhbnZhc1wiKS5yZW1vdmVDbGFzcyhcImpveXJpZGUtaGlnaGxpZ2h0XCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kdGFyZ2V0LmZpcnN0KCkucmVtb3ZlQ2xhc3MoJ2pveXJpZGUtaGlnaGxpZ2h0Jyk7ICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICBwb3N0X3JpZGVfY2FsbGJhY2sgICAgIDogZnVuY3Rpb24gKCl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiSk9ZUklERSBDTE9TRURcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL0Rpc3BsYXkgYWxsIGJ1dHRvbnMgZm9yIGpveXJpZGVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKFwiI3Nob3dIaW50c1wiKS5jc3MoJ2Rpc3BsYXknLCAnbm9uZScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoXCIjcHJldmlvdXNcIikuY3NzKCdkaXNwbGF5JywgJ25vbmUnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKFwiI25leHRcIikuY3NzKCdkaXNwbGF5JywgJ25vbmUnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgYWJvcnRfb25fY2xvc2UgICAgICAgICAgIDogZmFsc2VcbiAgICAgIH0pO1xufVxuXG5mdW5jdGlvbiBsZXZlbFNlbGVjdE1lbnUoKXtcbiAgJCgnI2xldmVsU2VsZWN0TWVudU1vZGFsJykuZm91bmRhdGlvbigncmV2ZWFsJywgJ29wZW4nKTsgIFxufVxuXG5mdW5jdGlvbiBza2lwVG9MZXZlbChsZXZlbCl7XG4gICAgJCgnI2xldmVsU2VsZWN0TWVudU1vZGFsJykuZm91bmRhdGlvbigncmV2ZWFsJywgJ2Nsb3NlJyk7XG5cbiAgICBpZihsZXZlbCA9PSAnc2FuZGJveCcpe1xuICAgICAgICBzdG9yYWdlLnNldCgnc2tpcFRvU2FuZGJveCcsIHRydWUpO1xuICAgICAgICBsb2FkTWluaUNvdXJzZSgpO1xuICAgICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY3VycmVudExldmVsID0gbGV2ZWw7XG4gICAgbG9hZE1pbmlDb3Vyc2UoKTtcbn1cblxuZnVuY3Rpb24gcmV2ZXJ0TWluaUNvdXJzZSgpIHtcbiAgICBsb2FkTWluaUNvdXJzZShyZWZyZXNoUHJldmlldyk7XG59XG5cbmZ1bmN0aW9uIHB1Ymxpc2hQcm9tcHQoKXtcbiAgJCgnI3B1Ymxpc2hNb2RhbCcpLmZvdW5kYXRpb24oJ3JldmVhbCcsICdvcGVuJyk7XG59XG5cbmZ1bmN0aW9uIHVuZG8oKXtcbiAgICBlZGl0b3JfanMudW5kbygpO1xufVxuXG5mdW5jdGlvbiBwdWJsaXNoKCl7XG4gIGNvbnNvbGUubG9nKFwiUEFSRU5UIFBVQkxJU0hcIik7XG4gIFxuICBnZW5lcmF0ZWRIVE1MID0gbnVsbDtcbiAgTWluaWNvdXJzZVB1Ymxpc2hlci5nZW5lcmF0ZUhUTUwoe1xuICAgIGJhc2VVUkw6ICcuL21pbmkvJyxcbiAgICBiYXNlTGV2ZWw6IG1heExldmVsLFxuICAgIGpzOiBlZGl0b3JfanMuZ2V0VmFsdWUoKSxcbiAgICBmb3JtSW5mbzogJzxzcGFuIGlkPVwiZmlyc3RfbmFtZVwiPicrICQoJyNmaXJzdF9uYW1lJykudmFsKCkuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyAkKCcjZmlyc3RfbmFtZScpLnZhbCgpLnNsaWNlKDEpICsnPC9zcGFuPiBmcm9tIDxzcGFuIGlkPVwic2Nob29sXCI+JyskKCcjMDBOVTAwMDAwMDVQTjdlJykudmFsKCkrJzwvc3Bhbj4nXG4gICAgICAgICAgICAgICsnPHNwYW4gaWQ9XCJncmFkZVwiIHN0eWxlPVwiZGlzcGxheTogbm9uZTtcIj4nKyQoJyNncmFkZScpLnZhbCgpKyc8L3NwYW4+J1xuICAgICAgICAgICAgICArJzxzcGFuIGlkPVwiY2l0eVwiIHN0eWxlPVwiZGlzcGxheTogbm9uZTtcIj4nKyQoJyNjaXR5JykudmFsKCkrJzwvc3Bhbj4nXG4gICAgICAgICAgICAgICsnPHNwYW4gaWQ9XCJzdGF0ZVwiIHN0eWxlPVwiZGlzcGxheTogbm9uZTtcIj4nKyQoJyNzdGF0ZScpLnZhbCgpKyc8L3NwYW4+J1xuICAgICAgICAgICAgICArJzxzcGFuIGlkPVwiY291bnRyeVwiIHN0eWxlPVwiZGlzcGxheTogbm9uZTtcIj4nKyQoJyNjb3VudHJ5JykudmFsKCkrJzwvc3Bhbj4nXG4gIH0sIGZ1bmN0aW9uKGVyciwgaHRtbCkge1xuICAgIGlmIChlcnIpIHtcbiAgICAgIGFsZXJ0KFwiRXJyb3IgZ2VuZXJhdGluZyBwdWJsaXNoZWQgSFRNTDogXCIgKyBlcnIubWVzc2FnZSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIFxuICAgIGdlbmVyYXRlZEhUTUwgPSBodG1sO1xuXG4gICAgaWYgKCFnZW5lcmF0ZWRIVE1MKSB7XG4gICAgICBhbGVydChcIlRoZXJlIHdhcyBhbiBlcnJvciBwdWJsaXNoaW5nIHlvdXIgZ2FtZS4gUGxlYXNlIHRyeSBhZ2FpbiBsYXRlciFcIik7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIFxuICAgIC8vIEJlZ2luIHB1Ymxpc2hpbmdcbiAgICAkKFwiI3B1Ymxpc2hlZFwiKS5oaWRlKCk7XG4gICAgJChcIiNwdWJsaXNoaW5nXCIpLmZhZGVJbigpO1xuICAgIFxuICAgICQuYWpheCh7XG4gICAgICB0eXBlOiAnUE9TVCcsXG4gICAgICB1cmw6ICdodHRwczovL3B1Ymxpc2guZW1jbC5jb20vcHVibGlzaCcsXG4gICAgICBkYXRhOiB7XG4gICAgICAgICdodG1sJzogZ2VuZXJhdGVkSFRNTFxuICAgICAgfSxcbiAgICAgIGNyb3NzRG9tYWluOiB0cnVlLFxuICAgICAgZGF0YVR5cGU6ICdqc29uJyxcbiAgICAgIGVycm9yOiBmdW5jdGlvbih4aHIsIHN0YXR1cywgZXJyb3IpIHtcbiAgICAgICAgYWxlcnQoXCJJdCBsb29rcyBsaWtlIHNvbWV0aGluZyB3ZW50IHdyb25nLiBQbGVhc2UgdmVyaWZ5IHlvdXIgaW50ZXJuZXQgY29ubmVjdGlvbiBhbmQgY2xpY2sgUHVibGlzaCBhZ2Fpbi5cIik7XG4gICAgICAgIGNvbnNvbGUubG9nKGFyZ3VtZW50cyk7XG5cbiAgICAgICAgLy8gTG9nIGVycm9yIHRvIGdhXG4gICAgICAgIGdhKCdzZW5kJywgJ2V2ZW50JywgJ0FqYXggRXJyb3InLCBzdGF0dXMsICdwdWJsaXNoZXInLCB7ICdub25JbnRlcmFjdGlvbic6IDEgfSk7XG4gICAgICB9LFxuICAgICAgc3VjY2VzczogZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICB2YXIgdXJsID0gZGF0YVsncHVibGlzaGVkLXVybCddO1xuICAgICAgICBpZihsYW5ndWFnZSAmJiBsYW5ndWFnZSA9PSAnZXMnKXtcbiAgICAgICAgICAgIHVybCArPSAnP2xhbmc9ZXMnO1xuICAgICAgICB9XG4gICAgICAgIHVybCA9IHVybC5yZXBsYWNlKCdnbG9iYWxvcmlhLmNvbScsICdjYXJuZWdpZWxlYXJuaW5nLmNvbScpO1xuICAgICAgICB1cmwgPSB1cmwucmVwbGFjZSgnbXlnbGlmZS5vcmcnLCAnY2FybmVnaWVsZWFybmluZy5jb20nKTtcblxuICAgICAgICAkKFwiI3B1Ymxpc2hlZFwiKS5mYWRlSW4oKVxuICAgICAgICAgIC5maW5kKCdhJylcbiAgICAgICAgICAuYXR0cignaHJlZicsIHVybClcbiAgICAgICAgICAudGV4dCh1cmwpO1xuICAgICAgfSxcbiAgICAgIGNvbXBsZXRlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgJChcIiNwdWJsaXNoaW5nXCIpLmhpZGUoKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSk7XG59XG5cbmZ1bmN0aW9uIGxvYWRNaW5pQ291cnNlKGNiKXtcbiAgICBjYiA9IGNiIHx8IGZ1bmN0aW9uKCkge31cbiAgICB2YXIgemVyb1BhZGRlZExldmVsID0gKGN1cnJlbnRMZXZlbCA8IDEwKSA/ICcwJyArIGN1cnJlbnRMZXZlbCA6IGN1cnJlbnRMZXZlbDtcblxuICAgIC8vIFNraXAgdG8gc2FuZGJveFxuICAgIGlmKCBzdG9yYWdlLmdldCgnc2tpcFRvU2FuZGJveCcpID09ICd0cnVlJyApe1xuICAgICAgICB6ZXJvUGFkZGVkTGV2ZWwgPSBtYXhMZXZlbDtcbiAgICAgICAgJChcIiNsZXZlbE1lbnVcIikuY3NzKCdkaXNwbGF5JywgJ25vbmUnKTtcbiAgICB9ZWxzZXtcbiAgICAgICAgJChcIiNsZXZlbE1lbnVcIikuY3NzKCdkaXNwbGF5JywgJ2Jsb2NrJyk7XG4gICAgfVxuXG4gICAgdmFyIGNvZGVVcmwgPSAnbWluaS8nK2xhbmd1YWdlUGF0aCsnbGV2ZWxzLycgKyB6ZXJvUGFkZGVkTGV2ZWwgKyAnLmpzJztcblxuICAgIC8vIExvYWQgcmVtaXggY29kZSBmb3Igc2FuZGJveCB3aGVuIGF2YWlsYWJsZVxuICAgIGlmKCByZW1peFVybCAmJiBzdG9yYWdlLmdldCgnc2tpcFRvU2FuZGJveCcpID09ICd0cnVlJyApe1xuICAgICAgICAvLyBQdWxsIGdhbWUgZnJvbSBkZXYgb3IgbGl2ZSAoQ09SUyBpcyBjdXJyZW50bHkgYnJlYWtpbmcgcHVsbHMgZnJvbSBnbG9iYWxvcmlhLWRldi5zMylcbiAgICAgICAgaWYod2luZG93LmxvY2F0aW9uLmhyZWYubWF0Y2goL21ha2VxdWVzdC5jYXJuZWdpZWxlYXJuaW5nLmNvbS8pKXtcbiAgICAgICAgICAgIC8vIE5lZWQgdG8gdXNlIGZ1bGwgYnVja2V0IG5hbWUuIFVzaW5nIG15bWFrZXF1ZXN0IHdpbGwgdGhyb3cgYW4gZXJyb3JcbiAgICAgICAgICAgIC8vIGNvZGVVcmwgPSAnaHR0cDovL215bWFrZXF1ZXN0Lmdsb2JhbG9yaWEuczMtd2Vic2l0ZS11cy1lYXN0LTEuYW1hem9uYXdzLmNvbS8nK3JlbWl4VXJsWzFdO1xuICAgICAgICAgICAgLy8gY29kZVVybCA9ICdodHRwOi8vbXltYWtlcXVlc3QuZ2xvYmFsb3JpYS5jb20uczMtd2Vic2l0ZS11cy1lYXN0LTEuYW1hem9uYXdzLmNvbS8nK3JlbWl4VXJsWzFdO1xuICAgICAgICAgICAgY29kZVVybCA9ICdodHRwczovL215bWFrZXF1ZXN0LmNhcm5lZ2llbGVhcm5pbmcuY29tLycrcmVtaXhVcmxbMV07XG4gICAgICAgIH1lbHNle1xuICAgICAgICAgICAgLy8gY29kZVVybCA9ICdodHRwczovL2dsb2JhbG9yaWEtZGV2LnMzLmFtYXpvbmF3cy5jb20vJytyZW1peFVybFsxXTtcbiAgICAgICAgICAgIGNvZGVVcmwgPSAnaHR0cHM6Ly9oYWNrcHViLXB1Ymxpc2hlci1kZXYuczMuYW1hem9uYXdzLmNvbS8nK3JlbWl4VXJsWzFdO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgJC5nZXQoY29kZVVybCwgZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAvLyBFeHRyYWN0IGVkaXRvciBjb2RlIGZyb20gdGhlIHB1Ymxpc2hlZCBIVE1MIGRvY3VtZW50XG4gICAgICAgIGlmKHJlbWl4VXJsKXtcbiAgICAgICAgICAgIGRlYnVnMiA9IGRhdGE7XG4gICAgICAgICAgICB2YXIgcmVtaXhDb2RlID0gZGF0YS5tYXRjaCgvPHNjcmlwdCBpZD1cInB1Ymxpc2hlZC1sZXZlbC1jb2RlXCI+KFtcXHNcXFNdKSs/PFxcL3NjcmlwdD4vZyk7XG4gICAgICAgICAgICBpZihyZW1peENvZGUpe1xuICAgICAgICAgICAgICAgIC8vIERhdGEgc2hvdWxkIG9ubHkgYmUgdGhlIGVkaXRvciBzcGVjaWZpYyBjb2RlIChpLmUuIHRoZSBjYXB0dXJlZCBncm91cClcbiAgICAgICAgICAgICAgICBkYXRhID0gcmVtaXhDb2RlWzBdLnJlcGxhY2UoJzxzY3JpcHQgaWQ9XCJwdWJsaXNoZWQtbGV2ZWwtY29kZVwiPicsICcnKS5yZXBsYWNlKCc8L3NjcmlwdD4nLCAnJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgbWFya0hpbnRzID0gW107XG4gICAgICAgIHZhciByZWFkT25seVRva2VucyA9IFtdO1xuICAgICAgICB2YXIgcmVhZE9ubHlSYW5nZXMgPSBbXTtcbiAgICAgICAgdmFyIGZvbGRlZFJhbmdlcyA9IFtdO1xuICAgICAgICB2YXIgY3VyckxpbmVOdW1iZXIgPSAwO1xuICAgICAgICB2YXIgY3VyckluZGVudGF0aW9uID0gMDtcbiAgICAgICAgdmFyIGVkaXRvclRvb2x0aXBzID0gW107XG4gICAgICAgIHZhciBlZGl0b3JDb21tYW5kcyA9IHtcbiAgICAgICAgICAgIG1hcmtIaW50OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBtYXJrSGludHMucHVzaChhcmd1bWVudHMpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJlYWRPbmx5VG9rZW46IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgcmVhZE9ubHlUb2tlbnMucHVzaChhcmd1bWVudHMpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGJlZ2luUmVhZE9ubHk6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHJlYWRPbmx5UmFuZ2VzLnB1c2goW2N1cnJMaW5lTnVtYmVyXSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZW5kUmVhZE9ubHk6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHZhciBjdXJyUmFuZ2UgPSByZWFkT25seVJhbmdlc1tyZWFkT25seVJhbmdlcy5sZW5ndGggLSAxXTtcbiAgICAgICAgICAgICAgICBjdXJyUmFuZ2UucHVzaChjdXJyTGluZU51bWJlcik7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgYmVnaW5Db2RlRm9sZDogZnVuY3Rpb24obGlua1RleHQpIHtcbiAgICAgICAgICAgICAgICBmb2xkZWRSYW5nZXMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgIGJlZ2luOiBjdXJyTGluZU51bWJlcixcbiAgICAgICAgICAgICAgICAgICAgaW5kZW50YXRpb246IGN1cnJJbmRlbnRhdGlvbixcbiAgICAgICAgICAgICAgICAgICAgbGlua1RleHQ6IGxpbmtUZXh0IHx8ICdNb3JlXFx1MjAyNidcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBlbmRDb2RlRm9sZDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdmFyIGN1cnJSYW5nZSA9IGZvbGRlZFJhbmdlc1tmb2xkZWRSYW5nZXMubGVuZ3RoIC0gMV07XG4gICAgICAgICAgICAgICAgY3VyclJhbmdlLmVuZCA9IGN1cnJMaW5lTnVtYmVyO1xuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgaW5zZXJ0VG9vbHRpcDogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICBlZGl0b3JUb29sdGlwcy5wdXNoKGFyZ3VtZW50cyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gTm9ybWFsaXplIHdoaXRlc3BhY2UgaWYgd2UncmUgb24gd2luZG93cy5cbiAgICAgICAgZGF0YSA9IGRhdGEucmVwbGFjZSgvXFxyXFxuL2csICdcXG4nKTtcblxuICAgICAgICAvLyBXZSB3YW50IHRvIG1ha2UgaXQgbGVzcyBsaWtlbHkgdGhhdCB0aGUgdXNlciBhY2NpZGVudGFsbHlcbiAgICAgICAgLy8gZGVsZXRlcyB0aGUgY2xvc2luZyBicmFjZSBvZiBhIGZ1bmN0aW9uIGRlZmluaXRpb24gb3IgYWRkc1xuICAgICAgICAvLyBjb2RlIGFmdGVyIGl0LCBzbyB3ZSdsbCBtb3ZlIGl0IHdheSBkb3duIHRvIHRoZSBib3R0b20gb2ZcbiAgICAgICAgLy8gdGhlIGZpbGUgd2l0aCBwbGVudHkgb2Ygd2hpdGUtc3BhY2UgaW4gYmV0d2Vlbi5cbiAgICAgICAgZGF0YSA9IGRhdGEucmVwbGFjZSgvfVxcbiokLywgJ1xcblxcblxcblxcblxcblxcblxcblxcblxcblxcbn1cXG4nKTtcblxuICAgICAgICBkYXRhID0gZGF0YS5zcGxpdCgnXFxuJykuZmlsdGVyKGZ1bmN0aW9uKGxpbmUpIHtcbiAgICAgICAgICAgIHZhciBtYXRjaCA9IGxpbmUubWF0Y2goLyhcXHMqKVxcL1xcL1xccypFRElUT1I6KC4qKS8pO1xuICAgICAgICAgICAgaWYgKCFtYXRjaCkge1xuICAgICAgICAgICAgICAgIGN1cnJMaW5lTnVtYmVyKys7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGN1cnJJbmRlbnRhdGlvbiA9IG1hdGNoWzFdO1xuICAgICAgICAgICAgd2l0aCAoZWRpdG9yQ29tbWFuZHMpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIkV4ZWN1dGluZyBlZGl0b3IgY29tbWFuZDogXCIgKyBtYXRjaFsyXSk7XG4gICAgICAgICAgICAgICAgZXZhbChtYXRjaFsyXSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfSkuam9pbignXFxuJyk7XG5cbiAgICAgICAgb3JpZ2luYWxFZGl0b3JDb250ZW50ID0gZGF0YTtcbiAgICAgICAgZWRpdG9yX2pzLnNldFZhbHVlKGRhdGEpO1xuICAgICAgICAvLyBNYXJrIGVkaXRvciBhcyBjbGVhbiBhZnRlciBpbnNlcnRpbmcgdGhlIGJhc2UgdGVtcGxhdGUgdG8gaGFuZGxlIFVuZG8gZGlzcGxheVxuICAgICAgICBlZGl0b3JfanMubWFya0NsZWFuKCk7XG4gICAgICAgIC8vIFNpbmNlIHRoZSBlZGl0b3Igd2lsbCBiZSBjbGVhbiB0byBzdGFydCB3aXRoLCBkaXNhYmxlIFVuZG9cbiAgICAgICAgJChcIiN1bmRvXCIpLnByb3AoXCJkaXNhYmxlZFwiLHRydWUpO1xuXG4gICAgICAgIC8vIE1ha2UgdGhlIGZpcnN0IGxpbmUgcmVhZC1vbmx5LlxuICAgICAgICByZWFkT25seVJhbmdlcy5wdXNoKFswLCAxXSk7XG5cbiAgICAgICAgLy8gTWFrZSB0aGUgbGFzdCB0d28gbGluZXMgcmVhZC1vbmx5LlxuICAgICAgICByZWFkT25seVJhbmdlcy5wdXNoKFtlZGl0b3JfanMubGluZUNvdW50KCkgLSAyLCBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWRpdG9yX2pzLmxpbmVDb3VudCgpXSk7XG5cbiAgICAgICAgcmVhZE9ubHlSYW5nZXMuZm9yRWFjaChmdW5jdGlvbihyYW5nZSkge1xuICAgICAgICAgICAgZWRpdG9yX2pzLm1hcmtUZXh0KHtsaW5lOiByYW5nZVswXSwgY2g6IDB9LCB7XG4gICAgICAgICAgICAgIGxpbmU6IHJhbmdlWzFdLFxuICAgICAgICAgICAgICBjaDogMFxuICAgICAgICAgICAgfSwge1xuICAgICAgICAgICAgICBjbGFzc05hbWU6ICdqcy1yZWFkLW9ubHknLFxuICAgICAgICAgICAgICByZWFkT25seTogdHJ1ZVxuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcblxuICAgICAgICByZWFkT25seVRva2Vucy5mb3JFYWNoKGZ1bmN0aW9uKGFyZ3VtZW50cykge1xuICAgICAgICAgICAgcmVhZE9ubHlUb2tlbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgICB9KTtcblxuICAgICAgICBtYXJrSGludHMuZm9yRWFjaChmdW5jdGlvbihhcmd1bWVudHMpIHtcbiAgICAgICAgICAgIG1hcmtIaW50LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgICQoXCIjanNfZWRpdG9yXCIpLnJlbW92ZUNsYXNzKCdzaG93LWpzLWhpbnRzJyk7XG5cbiAgICAgICAgaWYgKG1hcmtIaW50cy5sZW5ndGgpIHtcbiAgICAgICAgICAgICQoXCIjc2hvd0hpbnRzXCIpLnNob3coKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICQoXCIjc2hvd0hpbnRzXCIpLmhpZGUoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZvbGRlZFJhbmdlcy5mb3JFYWNoKGZ1bmN0aW9uKHJhbmdlKSB7XG4gICAgICAgICAgICB2YXIgc3RhcnQgPSB7bGluZTogcmFuZ2UuYmVnaW4sIGNoOiAwfTtcbiAgICAgICAgICAgIHZhciBzcGFuID0gJCgnPHNwYW4gY2xhc3M9XCJjbS1jb21tZW50XCI+JyArIHJhbmdlLmluZGVudGF0aW9uICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAnLy8gPC9zcGFuPicpO1xuICAgICAgICAgICAgJCgnPHNwYW4gY2xhc3M9XCJqcy1jb2RlLWZvbGQtbGlua1wiPjwvc3Bhbj4nKVxuICAgICAgICAgICAgICAudGV4dChyYW5nZS5saW5rVGV4dClcbiAgICAgICAgICAgICAgLmFwcGVuZFRvKHNwYW4pO1xuICAgICAgICAgICAgZWRpdG9yX2pzLmZvbGRDb2RlKHN0YXJ0LCB7XG4gICAgICAgICAgICAgICAgd2lkZ2V0OiBzcGFuWzBdLFxuICAgICAgICAgICAgICAgIHJhbmdlRmluZGVyOiBmdW5jdGlvbihjbSwgcG9zKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmcm9tOiBzdGFydCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGluZTogcmFuZ2UuZW5kIC0gMSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaDogZWRpdG9yX2pzLmdldExpbmUocmFuZ2UuZW5kIC0gMSkubGVuZ3RoXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGVkaXRvclRvb2x0aXBzLmZvckVhY2goZnVuY3Rpb24oYXJndW1lbnRzKXtcbiAgICAgICAgICAgIGluc2VydEVkaXRvVG9vbHRpcC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgICB9KTtcblxuICAgICAgICBjYigpO1xuICAgIH0pO1xuICAgIFxuICAgIC8vIFNldCBzZXNzaW9uIHN0b3JhZ2UgYW5kIHJlbG9hZCB0aGUgaWZyYW1lIHRvIGJlIHN5bmNoZWRcbiAgICBzdG9yYWdlLnNldCgnY3VycmVudExldmVsJywgY3VycmVudExldmVsKTtcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJldmlldycpLmNvbnRlbnRXaW5kb3cubG9jYXRpb24ucmVsb2FkKCk7XG59XG5cbmZ1bmN0aW9uIHNob3dIaW50cygpIHtcbiAgICAkKFwiI2pzX2VkaXRvclwiKS5hZGRDbGFzcygnc2hvdy1qcy1oaW50cycpO1xuICAgICQoXCIjc2hvd0hpbnRzXCIpLmZhZGVPdXQoKTtcbn1cblxuZnVuY3Rpb24gbmV4dExldmVsKCl7XG4gICAgY3VycmVudExldmVsID09IG1heExldmVsID8gbWF4TGV2ZWwgOiBjdXJyZW50TGV2ZWwrKztcbiAgICBcbiAgICAvL1VwZGF0ZSBpZnJhbWUgc291cmNlXG4gICAgLy8gJCgnaWZyYW1lI3ByZXZpZXcnKS5hdHRyKCdzcmMnLCAncHJvamVjdF90ZW1wbGF0ZS9pbmRleCcrY3VycmVudExldmVsKycuaHRtbCcpO1xuICAgIC8vICRpbnN0cnVjdGlvbnMuZmluZChcImgzXCIpLnRleHQoaW5zdHJ1Y3Rpb25zW1wibGV2ZWxcIitjdXJyZW50TGV2ZWxdLnRpdGxlKTtcbiAgICAvLyAkaW5zdHJ1Y3Rpb25zLmZpbmQoXCJwXCIpLnRleHQoaW5zdHJ1Y3Rpb25zW1wibGV2ZWxcIitjdXJyZW50TGV2ZWxdLmNvbnRlbnQpO1xuICAgIGxvYWRNaW5pQ291cnNlKCk7XG59XG5cbmZ1bmN0aW9uIHByZXZMZXZlbCgpe1xuICAgIGN1cnJlbnRMZXZlbCA9PSAxID8gMSA6IGN1cnJlbnRMZXZlbC0tO1xuICAgIFxuICAgIC8vVXBkYXRlIGlmcmFtZSBzb3VyY2VcbiAgICAvLyAkKCdpZnJhbWUjcHJldmlldycpLmF0dHIoJ3NyYycsICdwcm9qZWN0X3RlbXBsYXRlL2luZGV4JytjdXJyZW50TGV2ZWwrJy5odG1sJyk7XG4gICAgLy8gJGluc3RydWN0aW9ucy5maW5kKFwiaDNcIikudGV4dChpbnN0cnVjdGlvbnNbXCJsZXZlbFwiK2N1cnJlbnRMZXZlbF0udGl0bGUpO1xuICAgIC8vICRpbnN0cnVjdGlvbnMuZmluZChcInBcIikudGV4dChpbnN0cnVjdGlvbnNbXCJsZXZlbFwiK2N1cnJlbnRMZXZlbF0uY29udGVudCk7XG4gICAgbG9hZE1pbmlDb3Vyc2UoKTtcbn1cbiJdfQ==
