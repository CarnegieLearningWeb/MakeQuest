function startWalkthrough(){$(document).foundation("joyride","start",{pre_ride_callback:function(){$("#showHints").css("display","block"),$("#previous").css("display","block"),$("#next").css("display","block")},pre_step_callback:function(){console.log(this.$target.first().attr("id")),"preview"==this.$target.first().attr("id")?$("iframe").contents().find("canvas").addClass("joyride-highlight"):this.$target.first().addClass("joyride-highlight")},post_step_callback:function(){"preview"==this.$target.first().attr("id")?$("iframe").contents().find("canvas").removeClass("joyride-highlight"):this.$target.first().removeClass("joyride-highlight")},post_ride_callback:function(){console.log("JOYRIDE CLOSED"),$("#showHints").css("display","none"),$("#previous").css("display","none"),$("#next").css("display","none")},abort_on_close:!1})}function levelSelectMenu(){$("#levelSelectMenuModal").foundation("reveal","open")}function skipToLevel(e){return $("#levelSelectMenuModal").foundation("reveal","close"),"sandbox"==e?(storage.set("skipToSandbox",!0),void loadMiniCourse()):(currentLevel=e,void loadMiniCourse())}function revertMiniCourse(){loadMiniCourse(refreshPreview)}function publishPrompt(){$("#publishModal").foundation("reveal","open")}function undo(){editor_js.undo()}function publish(){console.log("PARENT PUBLISH"),generatedHTML=null,MinicoursePublisher.generateHTML({baseURL:"./mini/",baseLevel:maxLevel,js:editor_js.getValue(),formInfo:'<span id="first_name">'+$("#first_name").val().charAt(0).toUpperCase()+$("#first_name").val().slice(1)+'</span> from <span id="school">'+$("#00NU0000005PN7e").val()+'</span><span id="grade" style="display: none;">'+$("#grade").val()+'</span><span id="city" style="display: none;">'+$("#city").val()+'</span><span id="state" style="display: none;">'+$("#state").val()+'</span><span id="country" style="display: none;">'+$("#country").val()+"</span>"},function(e,n){if(e)return void alert("Error generating published HTML: "+e.message);if(generatedHTML=n,console.log("GENERATED HTML"),console.log(generatedHTML),!generatedHTML)return void alert("There was an error publishing your game. Please try again later!");$("#published").hide(),$("#publishing").fadeIn();var o;o=window.location.hostname.indexOf("code.globaloria.com")>-1?"http://globaloria.com:8000/":window.location.hostname.indexOf("makequest.globaloria.com")>-1?"http://globaloria.com:8001/":"https://hackpub.herokuapp.com/buckets/globaloria/",$.ajax({type:"POST",url:o+"publish",data:{html:generatedHTML},crossDomain:!0,dataType:"json",error:function(){alert("Error publishing HTML!"),console.log(arguments)},success:function(e){$("#published").fadeIn().find("a").attr("href",e["published-url"]).text(e["published-url"]),$('button[type="submit"]').attr("disabled","disabled")},complete:function(){$("#publishing").hide()}})})}function loadMiniCourse(cb){cb=cb||function(){},console.log("Loading mini course template");var zeroPaddedLevel=currentLevel<10?"0"+currentLevel:currentLevel;"true"==storage.get("skipToSandbox")?(zeroPaddedLevel=maxLevel,$("#levelMenu").css("display","none")):$("#levelMenu").css("display","block");var codeUrl="mini/levels/"+zeroPaddedLevel+".js";remixUrl&&"true"==storage.get("skipToSandbox")&&(codeUrl=window.location.href.match(/code.globaloria.com/)?"http://mycode.globaloria.com/"+remixUrl[1]:window.location.href.match(/makequest.globaloria.com/)?"http://mymakequest.globaloria.com/"+remixUrl[1]:"http://globaloria-dev.s3.amazonaws.com/"+remixUrl[1]),$.get(codeUrl,function(data){if(remixUrl){debug2=data;var remixCode=data.match(/<script id="published-level-code">([\s\S])+?<\/script>/g);remixCode&&(data=remixCode[0].replace('<script id="published-level-code">',"").replace("</script>",""),console.log("NEW DATA"),console.log(data))}var markHints=[],readOnlyTokens=[],readOnlyRanges=[],foldedRanges=[],currLineNumber=0,currIndentation=0,editorTooltips=[],editorCommands={markHint:function(){markHints.push(arguments)},readOnlyToken:function(){readOnlyTokens.push(arguments)},beginReadOnly:function(){readOnlyRanges.push([currLineNumber])},endReadOnly:function(){var e=readOnlyRanges[readOnlyRanges.length-1];e.push(currLineNumber)},beginCodeFold:function(e){foldedRanges.push({begin:currLineNumber,indentation:currIndentation,linkText:e||"Moreâ€¦"})},endCodeFold:function(){var e=foldedRanges[foldedRanges.length-1];e.end=currLineNumber},insertTooltip:function(){editorTooltips.push(arguments)}};console.log("Course retrieved: "),console.log(data),data=data.replace(/\r\n/g,"\n"),data=data.replace(/}\n*$/,"\n\n\n\n\n\n\n\n\n\n}\n"),data=data.split("\n").filter(function(line){var match=line.match(/(\s*)\/\/\s*EDITOR:(.*)/);if(!match)return currLineNumber++,!0;with(currIndentation=match[1],editorCommands)console.log("Executing editor command: "+match[2]),eval(match[2]);return!1}).join("\n"),originalEditorContent=data,editor_js.setValue(data),readOnlyRanges.push([0,1]),readOnlyRanges.push([editor_js.lineCount()-2,editor_js.lineCount()]),readOnlyRanges.forEach(function(e){editor_js.markText({line:e[0],ch:0},{line:e[1],ch:0},{className:"js-read-only",readOnly:!0})}),readOnlyTokens.forEach(function(e){readOnlyToken.apply(this,e)}),markHints.forEach(function(e){markHint.apply(this,e)}),$("#js_editor").removeClass("show-js-hints"),markHints.length?$("#showHints").show():$("#showHints").hide(),foldedRanges.forEach(function(e){var n={line:e.begin,ch:0},o=$('<span class="cm-comment">'+e.indentation+"// </span>");$('<span class="js-code-fold-link"></span>').text(e.linkText).appendTo(o),editor_js.foldCode(n,{widget:o[0],rangeFinder:function(o,t){return{from:n,to:{line:e.end-1,ch:editor_js.getLine(e.end-1).length}}}})}),editorTooltips.forEach(function(e){insertEditoTooltip.apply(this,e)}),cb()}),storage.set("currentLevel",currentLevel),document.getElementById("preview").contentWindow.location.reload()}function showHints(){$("#js_editor").addClass("show-js-hints"),$("#showHints").fadeOut()}function nextLevel(){currentLevel==maxLevel?maxLevel:currentLevel++,loadMiniCourse()}function prevLevel(){1==currentLevel?1:currentLevel--,loadMiniCourse()}var maxLevel=gameConstants.MAX_LEVEL,remixUrl=window.location.href.match(/remix=(.+)/);$(document).ready(function(){storage.set("skipToSandbox",!1),remixUrl&&storage.set("skipToSandbox",!0),$("main").css("height",window.innerHeight-36),remixUrl||startWalkthrough(),$(document).on("close.fndtn.reveal","#welcomeModal",function(){startWalkthrough()}),$(document).on("click",".joyride-close-tip",function(){console.log(this)});var e=0,n=window.location.search.match(/debugLevel=(\d+)/);n&&(e=parseInt(n[1])),window.sessionStorage.currentLevel=e,currentLevel=e,$instructions=$("#instructions"),$(document).on("click","span.tooltip",function(){Foundation.libs.tooltip.hide($("#editor-tooltip")),$(this).remove(),$("#editor-tooltip").remove()}),$(document).on("click","#signupButton",function(e){e.preventDefault(),console.log("signup"),console.log(this);var n=document.getElementById("sign_up_email").value,o=document.getElementById("sign_up_password").value;createUserAndLogin({email:n,password:o}),$("#signupModal").foundation("reveal","close")}),$(document).on("click","#logout",function(e){e.preventDefault(),console.log("logout"),console.log(this),logout()}),loadMiniCourse(refreshPreview),setTimeout(function(){console.log("REFRESH 2000"),refreshPreview()},2e3),$("iframe#preview").attr("src","mini/index.html").focus(),$("form #00NU0000005PN7j").on("change",function(){console.log($(this).prop("checked")),$(this).prop("checked")?($("#first_name").prop("disabled",!1),$("#email").prop("disabled",!1),$("#phone").prop("disabled",!1)):($("#first_name").val(""),$("#email").val(""),$("#phone").val(""),$("#first_name").prop("disabled",!0),$("#email").prop("disabled",!0),$("#phone").prop("disabled",!0))}),$("#publish-form").submit(function(e){return console.log("VALIDATING"),""==$("#00NU0000005PN7e").val()||""==$("#city").val()||""==$("#country").val()||""==$("#state").val()?(console.log("VALIDATION FAILED"),!1):(console.log("PUBLISHING"),publish(),e.preventDefault(),!1)})});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpzL21haW4uanMiXSwibmFtZXMiOlsic3RhcnRXYWxrdGhyb3VnaCIsIiQiLCJkb2N1bWVudCIsImZvdW5kYXRpb24iLCJwcmVfcmlkZV9jYWxsYmFjayIsImNzcyIsInByZV9zdGVwX2NhbGxiYWNrIiwiY29uc29sZSIsImxvZyIsInRoaXMiLCIkdGFyZ2V0IiwiZmlyc3QiLCJhdHRyIiwiY29udGVudHMiLCJmaW5kIiwiYWRkQ2xhc3MiLCJwb3N0X3N0ZXBfY2FsbGJhY2siLCJyZW1vdmVDbGFzcyIsInBvc3RfcmlkZV9jYWxsYmFjayIsImFib3J0X29uX2Nsb3NlIiwibGV2ZWxTZWxlY3RNZW51Iiwic2tpcFRvTGV2ZWwiLCJsZXZlbCIsInN0b3JhZ2UiLCJzZXQiLCJsb2FkTWluaUNvdXJzZSIsImN1cnJlbnRMZXZlbCIsInJldmVydE1pbmlDb3Vyc2UiLCJyZWZyZXNoUHJldmlldyIsInB1Ymxpc2hQcm9tcHQiLCJ1bmRvIiwiZWRpdG9yX2pzIiwicHVibGlzaCIsImdlbmVyYXRlZEhUTUwiLCJNaW5pY291cnNlUHVibGlzaGVyIiwiZ2VuZXJhdGVIVE1MIiwiYmFzZVVSTCIsImJhc2VMZXZlbCIsIm1heExldmVsIiwianMiLCJnZXRWYWx1ZSIsImZvcm1JbmZvIiwidmFsIiwiY2hhckF0IiwidG9VcHBlckNhc2UiLCJzbGljZSIsImVyciIsImh0bWwiLCJhbGVydCIsIm1lc3NhZ2UiLCJoaWRlIiwiZmFkZUluIiwid2luZG93IiwibG9jYXRpb24iLCJob3N0bmFtZSIsImluZGV4T2YiLCJhamF4IiwidHlwZSIsInVybCIsImRhdGEiLCJjcm9zc0RvbWFpbiIsImRhdGFUeXBlIiwiZXJyb3IiLCJhcmd1bWVudHMiLCJzdWNjZXNzIiwidGV4dCIsImNvbXBsZXRlIiwiY2IiLCJ6ZXJvUGFkZGVkTGV2ZWwiLCJnZXQiLCJjb2RlVXJsIiwicmVtaXhVcmwiLCJocmVmIiwibWF0Y2giLCJkZWJ1ZzIiLCJyZW1peENvZGUiLCJyZXBsYWNlIiwibWFya0hpbnRzIiwicmVhZE9ubHlUb2tlbnMiLCJyZWFkT25seVJhbmdlcyIsImZvbGRlZFJhbmdlcyIsImN1cnJMaW5lTnVtYmVyIiwiY3VyckluZGVudGF0aW9uIiwiZWRpdG9yVG9vbHRpcHMiLCJlZGl0b3JDb21tYW5kcyIsIm1hcmtIaW50IiwicHVzaCIsInJlYWRPbmx5VG9rZW4iLCJiZWdpblJlYWRPbmx5IiwiZW5kUmVhZE9ubHkiLCJjdXJyUmFuZ2UiLCJsZW5ndGgiLCJiZWdpbkNvZGVGb2xkIiwibGlua1RleHQiLCJiZWdpbiIsImluZGVudGF0aW9uIiwiZW5kQ29kZUZvbGQiLCJlbmQiLCJpbnNlcnRUb29sdGlwIiwic3BsaXQiLCJmaWx0ZXIiLCJsaW5lIiwiZXZhbCIsImpvaW4iLCJvcmlnaW5hbEVkaXRvckNvbnRlbnQiLCJzZXRWYWx1ZSIsImxpbmVDb3VudCIsImZvckVhY2giLCJyYW5nZSIsIm1hcmtUZXh0IiwiY2giLCJjbGFzc05hbWUiLCJyZWFkT25seSIsImFwcGx5Iiwic2hvdyIsInN0YXJ0Iiwic3BhbiIsImFwcGVuZFRvIiwiZm9sZENvZGUiLCJ3aWRnZXQiLCJyYW5nZUZpbmRlciIsImNtIiwicG9zIiwiZnJvbSIsInRvIiwiZ2V0TGluZSIsImluc2VydEVkaXRvVG9vbHRpcCIsImdldEVsZW1lbnRCeUlkIiwiY29udGVudFdpbmRvdyIsInJlbG9hZCIsInNob3dIaW50cyIsImZhZGVPdXQiLCJuZXh0TGV2ZWwiLCJwcmV2TGV2ZWwiLCJnYW1lQ29uc3RhbnRzIiwiTUFYX0xFVkVMIiwicmVhZHkiLCJpbm5lckhlaWdodCIsIm9uIiwic3RhcnRMZXZlbCIsImRlYnVnTGV2ZWwiLCJzZWFyY2giLCJwYXJzZUludCIsInNlc3Npb25TdG9yYWdlIiwiJGluc3RydWN0aW9ucyIsIkZvdW5kYXRpb24iLCJsaWJzIiwidG9vbHRpcCIsInJlbW92ZSIsImUiLCJwcmV2ZW50RGVmYXVsdCIsImVtYWlsIiwidmFsdWUiLCJwYXNzd29yZCIsImNyZWF0ZVVzZXJBbmRMb2dpbiIsImxvZ291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S0FBSyxZQUFZLE1BSXJDN0osRUFBRSxpQkFBaUI4SixPQUFPLFNBQVNDLEdBRy9CLE1BRkF6SixTQUFRQyxJQUFJLGNBRXVCLElBQS9CUCxFQUFFLG9CQUFvQnlDLE9BQ0MsSUFBcEJ6QyxFQUFFLFNBQVN5QyxPQUNZLElBQXZCekMsRUFBRSxZQUFZeUMsT0FDTyxJQUFyQnpDLEVBQUUsVUFBVXlDLE9BRWZuQyxRQUFRQyxJQUFJLHNCQUNMLElBTVhELFFBQVFDLElBQUksY0FDWndCLFVBQ0FnSSxFQUFNVixrQkFDQyIsImZpbGUiOiJqcy9tYWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsidmFyIG1heExldmVsID0gZ2FtZUNvbnN0YW50cy5NQVhfTEVWRUw7XG4vLyBDaGVjayBpZiB3ZSdyZSBhY2Nlc3NpbmcgYSByZW1peCB1cmwsIGlmIHNvLCBzdG9yZSB0aGUgdXJsIGZvciBsYXRlciB1c2VcbnZhciByZW1peFVybCA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmLm1hdGNoKC9yZW1peD0oLispLyk7XG5cbiQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkge1xuICAgIC8vIERvbid0IHN0YXJ0IGluIHNhbmRib3ggaWYgdGhlIHBhZ2UgaXMgcmVmcmVzaGVkIGFuZCB3ZSdyZSBub3QgaW4gcmVtaXggbW9kZVxuICAgIHN0b3JhZ2Uuc2V0KCdza2lwVG9TYW5kYm94JywgZmFsc2UpO1xuICAgIGlmKHJlbWl4VXJsKXtcbiAgICAgICAgc3RvcmFnZS5zZXQoJ3NraXBUb1NhbmRib3gnLCB0cnVlKTtcbiAgICB9XG5cbiAgICAvL1Jlc2l6ZSB0byB2aWV3cG9ydFxuICAgICQoXCJtYWluXCIpLmNzcyhcImhlaWdodFwiLCB3aW5kb3cuaW5uZXJIZWlnaHQtMzYpO1xuXG4gICAgXG5cbiAgICAvL09wZW4gd2VsY29tZSBtb2RhbCBvbiBmaXJzdCBsb2FkXG4gICAgLy8gY29kZS5nbG9iYWxvcmlhLmNvbSBvbmx5XG4gICAgLy8gJCgnI3dlbGNvbWVNb2RhbCcpLmZvdW5kYXRpb24oJ3JldmVhbCcsICdvcGVuJyk7XG4gICAgXG4gICAgLy9PcGVuIHdhbGt0aHJvdWdoIG9uIGZpcnN0IGxvYWRcbiAgICAvLyBtYWtlcXVlc3QuZ2xvYmFsb3JpYS5jb20gb25seVxuICAgIGlmKCAhcmVtaXhVcmwgKXtcbiAgICAgICAgc3RhcnRXYWxrdGhyb3VnaCgpO1xuICAgIH1cblxuXG5cblxuICAgIC8vIEluaXQgam95cmlkZSBhZnRlciBXZWxjb21lIE1vZGFsXG4gICAgJChkb2N1bWVudCkub24oJ2Nsb3NlLmZuZHRuLnJldmVhbCcsICcjd2VsY29tZU1vZGFsJywgZnVuY3Rpb24gKCkge1xuICAgICAgXG4gICAgICAgIHN0YXJ0V2Fsa3Rocm91Z2goKTtcbiAgICAgIFxuICAgIH0pO1xuICAgICQoZG9jdW1lbnQpLm9uKCdjbGljaycsICcuam95cmlkZS1jbG9zZS10aXAnLCBmdW5jdGlvbigpe1xuICAgICAgY29uc29sZS5sb2codGhpcyk7XG4gICAgfSk7XG5cblxuICAgIHZhciBzdGFydExldmVsID0gMDtcbiAgICB2YXIgZGVidWdMZXZlbCA9IHdpbmRvdy5sb2NhdGlvbi5zZWFyY2gubWF0Y2goL2RlYnVnTGV2ZWw9KFxcZCspLyk7XG5cbiAgICBpZiAoZGVidWdMZXZlbCkge1xuICAgICAgICBzdGFydExldmVsID0gcGFyc2VJbnQoZGVidWdMZXZlbFsxXSk7XG4gICAgfVxuXG5cbiAgICAvL1Jlc2V0IHNlc3Npb25TdG9yYWdlIHRvIGtlZXAgZWRpdG9yIGFuZCBpZnJhbWUgaW4gc3luY1xuICAgIHdpbmRvdy5zZXNzaW9uU3RvcmFnZVsnY3VycmVudExldmVsJ10gPSBzdGFydExldmVsO1xuXG4gICAgY3VycmVudExldmVsID0gc3RhcnRMZXZlbDtcblxuICAgICRpbnN0cnVjdGlvbnMgPSAkKFwiI2luc3RydWN0aW9uc1wiKTtcblxuICAgIC8vUmVtb3ZlIHRvb2x0aXBzIGZyb20gY29kZSBlZGl0b3JcbiAgICAkKGRvY3VtZW50KS5vbignY2xpY2snLCAnc3Bhbi50b29sdGlwJywgZnVuY3Rpb24oKXtcbiAgICAgICAgRm91bmRhdGlvbi5saWJzLnRvb2x0aXAuaGlkZSggJCgnI2VkaXRvci10b29sdGlwJykgKTtcbiAgICAgICAgJCh0aGlzKS5yZW1vdmUoKTtcbiAgICAgICAgJCgnI2VkaXRvci10b29sdGlwJykucmVtb3ZlKCk7XG4gICAgfSk7XG5cbiAgICAkKGRvY3VtZW50KS5vbignY2xpY2snLCAnI3NpZ251cEJ1dHRvbicsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBjb25zb2xlLmxvZyhcInNpZ251cFwiKTtcbiAgICAgICAgY29uc29sZS5sb2codGhpcyk7XG4gICAgICAgIFxuICAgICAgICB2YXIgZW1haWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2lnbl91cF9lbWFpbCcpLnZhbHVlO1xuICAgICAgICB2YXIgcGFzc3dvcmQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2lnbl91cF9wYXNzd29yZCcpLnZhbHVlO1xuXG4gICAgICAgIGNyZWF0ZVVzZXJBbmRMb2dpbih7XG4gICAgICAgICAgICBlbWFpbDogZW1haWwsXG4gICAgICAgICAgICBwYXNzd29yZDogcGFzc3dvcmRcbiAgICAgICAgfSk7XG4gICAgICAgIFxuXG4gICAgICAgICQoJyNzaWdudXBNb2RhbCcpLmZvdW5kYXRpb24oJ3JldmVhbCcsICdjbG9zZScpO1xuICAgIH0pO1xuXG4gICAgJChkb2N1bWVudCkub24oJ2NsaWNrJywgJyNsb2dvdXQnLCBmdW5jdGlvbihlKSB7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgY29uc29sZS5sb2coXCJsb2dvdXRcIik7XG4gICAgICAgIGNvbnNvbGUubG9nKHRoaXMpO1xuXG4gICAgICAgIGxvZ291dCgpO1xuICAgIH0pO1xuXG4gICAgbG9hZE1pbmlDb3Vyc2UocmVmcmVzaFByZXZpZXcpO1xuXG4gICAgLy8gRml4IHRoaXMgdWdseSBoYWNrIHNvIHRoYXQgdGhlIGdhbWUgaXMgZGlzcGxheWVkIGNvcnJlY3RseSB3aGVuIHJlbWl4aW5nLlxuICAgIC8vIEN1cnJlbnRseSBoYXZlIHRvIGhpdCBSdW4gd2hlbiBvcGVuaW5nIGZvciBSZW1peCBvciB1c2UgdGhpcyB0aW1lb3V0IGNhbGw6IFxuICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKXtcbiAgICAgICAgY29uc29sZS5sb2coXCJSRUZSRVNIIDIwMDBcIik7XG4gICAgICAgIHJlZnJlc2hQcmV2aWV3KCk7XG4gICAgfSwgMjAwMCk7XG5cbiAgICAvL1NldCBpZnJhbWUgdG8gcmlnaHQgbGV2ZWxcbiAgICAkKCdpZnJhbWUjcHJldmlldycpLmF0dHIoJ3NyYycsICdtaW5pL2luZGV4Lmh0bWwnKS5mb2N1cygpO1xuXG4gICAgLy8gUHVibGlzaGluZyBmb3JtIHN1Ym1pc3Npb25cbiAgICAvL2lzLWFkdWx0XG4gICAgJCgnZm9ybSAjMDBOVTAwMDAwMDVQTjdqJykub24oJ2NoYW5nZScsIGZ1bmN0aW9uKCl7XG4gICAgICAgIGNvbnNvbGUubG9nKCAkKHRoaXMpLnByb3AoJ2NoZWNrZWQnKSApO1xuICAgICAgICBpZiggJCh0aGlzKS5wcm9wKCdjaGVja2VkJykgKXtcbiAgICAgICAgICAgICQoJyNmaXJzdF9uYW1lJykucHJvcCgnZGlzYWJsZWQnLCBmYWxzZSk7XG4gICAgICAgICAgICAvLyAkKCcjbGFzdF9uYW1lJykucHJvcCgnZGlzYWJsZWQnLCBmYWxzZSk7XG4gICAgICAgICAgICAkKCcjZW1haWwnKS5wcm9wKCdkaXNhYmxlZCcsIGZhbHNlKTtcbiAgICAgICAgICAgICQoJyNwaG9uZScpLnByb3AoJ2Rpc2FibGVkJywgZmFsc2UpO1xuICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICQoJyNmaXJzdF9uYW1lJykudmFsKCcnKTtcbiAgICAgICAgICAgIC8vICQoJyNsYXN0X25hbWUnKS52YWwoJycpO1xuICAgICAgICAgICAgJCgnI2VtYWlsJykudmFsKCcnKTtcbiAgICAgICAgICAgICQoJyNwaG9uZScpLnZhbCgnJyk7XG5cbiAgICAgICAgICAgICQoJyNmaXJzdF9uYW1lJykucHJvcCgnZGlzYWJsZWQnLCB0cnVlKTtcbiAgICAgICAgICAgIC8vICQoJyNsYXN0X25hbWUnKS5wcm9wKCdkaXNhYmxlZCcsIHRydWUpO1xuICAgICAgICAgICAgJCgnI2VtYWlsJykucHJvcCgnZGlzYWJsZWQnLCB0cnVlKTtcbiAgICAgICAgICAgICQoJyNwaG9uZScpLnByb3AoJ2Rpc2FibGVkJywgdHJ1ZSk7XG4gICAgICAgIH1cbiAgICB9KTtcbiAgICBcbiAgICAkKCcjcHVibGlzaC1mb3JtJykuc3VibWl0KGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiVkFMSURBVElOR1wiKTtcbiAgICAgICAgLy8gRm9ybSB2YWxpZGF0aW9uXG4gICAgICAgIGlmKCAkKCcjMDBOVTAwMDAwMDVQTjdlJykudmFsKCkgPT0gXCJcIlxuICAgICAgICAgICAgfHwgJCgnI2NpdHknKS52YWwoKSA9PSBcIlwiXG4gICAgICAgICAgICB8fCAkKCcjY291bnRyeScpLnZhbCgpID09IFwiXCJcbiAgICAgICAgICAgIHx8ICQoJyNzdGF0ZScpLnZhbCgpID09IFwiXCJcbiAgICAgICAgICAgICl7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIlZBTElEQVRJT04gRkFJTEVEXCIpO1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gUHJldmVudCBmb3JtIHN1Ym1pc3Npb25cbiAgICAgICAgLy8gUHVibGlzaCBnYW1lIGFuZCBzZXQgdXJsIGFzIHRoZSByZXR1cm4gcGFyYW1ldGVyIGZvciB0aGUgZm9ybS5cbiAgICAgICAgLy8gU3VibWl0IHRoZSBmb3JtIGZyb20gcHVibGlzaFxuICAgICAgICBjb25zb2xlLmxvZyhcIlBVQkxJU0hJTkdcIik7XG4gICAgICAgIHB1Ymxpc2goKTtcbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0pO1xufSk7XG5cbmZ1bmN0aW9uIHN0YXJ0V2Fsa3Rocm91Z2goKXtcbiAgICAkKGRvY3VtZW50KS5mb3VuZGF0aW9uKCdqb3lyaWRlJywgJ3N0YXJ0Jywge1xuICAgICAgICBcbiAgICAgICAgcHJlX3JpZGVfY2FsbGJhY2sgICAgICA6IGZ1bmN0aW9uICgpe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vRGlzcGxheSBhbGwgYnV0dG9ucyBmb3Igam95cmlkZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoXCIjc2hvd0hpbnRzXCIpLmNzcygnZGlzcGxheScsICdibG9jaycpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoXCIjcHJldmlvdXNcIikuY3NzKCdkaXNwbGF5JywgJ2Jsb2NrJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJChcIiNuZXh0XCIpLmNzcygnZGlzcGxheScsICdibG9jaycpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICBwcmVfc3RlcF9jYWxsYmFjayAgICAgIDogZnVuY3Rpb24gKCl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2codGhpcy4kdGFyZ2V0LmZpcnN0KCkuYXR0cignaWQnKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYodGhpcy4kdGFyZ2V0LmZpcnN0KCkuYXR0cignaWQnKSA9PSBcInByZXZpZXdcIil7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKFwiaWZyYW1lXCIpLmNvbnRlbnRzKCkuZmluZChcImNhbnZhc1wiKS5hZGRDbGFzcyhcImpveXJpZGUtaGlnaGxpZ2h0XCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kdGFyZ2V0LmZpcnN0KCkuYWRkQ2xhc3MoJ2pveXJpZGUtaGlnaGxpZ2h0Jyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICBwb3N0X3N0ZXBfY2FsbGJhY2sgICAgIDogZnVuY3Rpb24gKCl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYodGhpcy4kdGFyZ2V0LmZpcnN0KCkuYXR0cignaWQnKSA9PSBcInByZXZpZXdcIil7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKFwiaWZyYW1lXCIpLmNvbnRlbnRzKCkuZmluZChcImNhbnZhc1wiKS5yZW1vdmVDbGFzcyhcImpveXJpZGUtaGlnaGxpZ2h0XCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kdGFyZ2V0LmZpcnN0KCkucmVtb3ZlQ2xhc3MoJ2pveXJpZGUtaGlnaGxpZ2h0Jyk7ICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICBwb3N0X3JpZGVfY2FsbGJhY2sgICAgIDogZnVuY3Rpb24gKCl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiSk9ZUklERSBDTE9TRURcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL0Rpc3BsYXkgYWxsIGJ1dHRvbnMgZm9yIGpveXJpZGVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKFwiI3Nob3dIaW50c1wiKS5jc3MoJ2Rpc3BsYXknLCAnbm9uZScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoXCIjcHJldmlvdXNcIikuY3NzKCdkaXNwbGF5JywgJ25vbmUnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKFwiI25leHRcIikuY3NzKCdkaXNwbGF5JywgJ25vbmUnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgYWJvcnRfb25fY2xvc2UgICAgICAgICAgIDogZmFsc2VcbiAgICAgIH0pO1xufVxuXG5mdW5jdGlvbiBsZXZlbFNlbGVjdE1lbnUoKXtcbiAgJCgnI2xldmVsU2VsZWN0TWVudU1vZGFsJykuZm91bmRhdGlvbigncmV2ZWFsJywgJ29wZW4nKTsgIFxufVxuXG5mdW5jdGlvbiBza2lwVG9MZXZlbChsZXZlbCl7XG4gICAgJCgnI2xldmVsU2VsZWN0TWVudU1vZGFsJykuZm91bmRhdGlvbigncmV2ZWFsJywgJ2Nsb3NlJyk7XG5cbiAgICBpZihsZXZlbCA9PSAnc2FuZGJveCcpe1xuICAgICAgICBzdG9yYWdlLnNldCgnc2tpcFRvU2FuZGJveCcsIHRydWUpO1xuICAgICAgICBsb2FkTWluaUNvdXJzZSgpO1xuICAgICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY3VycmVudExldmVsID0gbGV2ZWw7XG4gICAgbG9hZE1pbmlDb3Vyc2UoKTtcbn1cblxuZnVuY3Rpb24gcmV2ZXJ0TWluaUNvdXJzZSgpIHtcbiAgICBsb2FkTWluaUNvdXJzZShyZWZyZXNoUHJldmlldyk7XG59XG5cbmZ1bmN0aW9uIHB1Ymxpc2hQcm9tcHQoKXtcbiAgJCgnI3B1Ymxpc2hNb2RhbCcpLmZvdW5kYXRpb24oJ3JldmVhbCcsICdvcGVuJyk7XG59XG5cbmZ1bmN0aW9uIHVuZG8oKXtcbiAgICBlZGl0b3JfanMudW5kbygpO1xufVxuXG5mdW5jdGlvbiBwdWJsaXNoKCl7XG4gIGNvbnNvbGUubG9nKFwiUEFSRU5UIFBVQkxJU0hcIik7XG4gIFxuICBnZW5lcmF0ZWRIVE1MID0gbnVsbDtcbiAgTWluaWNvdXJzZVB1Ymxpc2hlci5nZW5lcmF0ZUhUTUwoe1xuICAgIGJhc2VVUkw6ICcuL21pbmkvJyxcbiAgICBiYXNlTGV2ZWw6IG1heExldmVsLFxuICAgIGpzOiBlZGl0b3JfanMuZ2V0VmFsdWUoKSxcbiAgICBmb3JtSW5mbzogJzxzcGFuIGlkPVwiZmlyc3RfbmFtZVwiPicrICQoJyNmaXJzdF9uYW1lJykudmFsKCkuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyAkKCcjZmlyc3RfbmFtZScpLnZhbCgpLnNsaWNlKDEpICsnPC9zcGFuPiBmcm9tIDxzcGFuIGlkPVwic2Nob29sXCI+JyskKCcjMDBOVTAwMDAwMDVQTjdlJykudmFsKCkrJzwvc3Bhbj4nXG4gICAgICAgICAgICAgICsnPHNwYW4gaWQ9XCJncmFkZVwiIHN0eWxlPVwiZGlzcGxheTogbm9uZTtcIj4nKyQoJyNncmFkZScpLnZhbCgpKyc8L3NwYW4+J1xuICAgICAgICAgICAgICArJzxzcGFuIGlkPVwiY2l0eVwiIHN0eWxlPVwiZGlzcGxheTogbm9uZTtcIj4nKyQoJyNjaXR5JykudmFsKCkrJzwvc3Bhbj4nXG4gICAgICAgICAgICAgICsnPHNwYW4gaWQ9XCJzdGF0ZVwiIHN0eWxlPVwiZGlzcGxheTogbm9uZTtcIj4nKyQoJyNzdGF0ZScpLnZhbCgpKyc8L3NwYW4+J1xuICAgICAgICAgICAgICArJzxzcGFuIGlkPVwiY291bnRyeVwiIHN0eWxlPVwiZGlzcGxheTogbm9uZTtcIj4nKyQoJyNjb3VudHJ5JykudmFsKCkrJzwvc3Bhbj4nXG4gIH0sIGZ1bmN0aW9uKGVyciwgaHRtbCkge1xuICAgIGlmIChlcnIpIHtcbiAgICAgIGFsZXJ0KFwiRXJyb3IgZ2VuZXJhdGluZyBwdWJsaXNoZWQgSFRNTDogXCIgKyBlcnIubWVzc2FnZSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIFxuICAgIGdlbmVyYXRlZEhUTUwgPSBodG1sO1xuICAgIGNvbnNvbGUubG9nKFwiR0VORVJBVEVEIEhUTUxcIik7XG4gICAgY29uc29sZS5sb2coZ2VuZXJhdGVkSFRNTCk7XG5cbiAgICBpZiAoIWdlbmVyYXRlZEhUTUwpIHtcbiAgICAgIGFsZXJ0KFwiVGhlcmUgd2FzIGFuIGVycm9yIHB1Ymxpc2hpbmcgeW91ciBnYW1lLiBQbGVhc2UgdHJ5IGFnYWluIGxhdGVyIVwiKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgXG4gICAgLy8gQmVnaW4gcHVibGlzaGluZ1xuICAgICQoXCIjcHVibGlzaGVkXCIpLmhpZGUoKTtcbiAgICAkKFwiI3B1Ymxpc2hpbmdcIikuZmFkZUluKCk7XG5cbiAgICAvLyBQdWJsaXNoIGV2ZXJ5dGhpbmcgdG8gbXljb2RlIHVudGlsIHdlIGhhdmUgYSBzZWNvbmQgYnVja2V0IHdpdGggQ09SUyBlbmFibGVkXG4gICAgLy8gdmFyIGJhc2VVUkwgPSB3aW5kb3cubG9jYXRpb24uaG9zdG5hbWUuaW5kZXhPZignY29kZS5nbG9iYWxvcmlhLmNvbScpID4gLTFcbiAgICAvLyAgICAgICAgICAgICAgID8gJ2h0dHA6Ly9nbG9iYWxvcmlhLmNvbTo4MDAwLydcbiAgICAvLyAgICAgICAgICAgICAgIDogJ2h0dHBzOi8vaGFja3B1Yi5oZXJva3VhcHAuY29tL2J1Y2tldHMvZ2xvYmFsb3JpYS8nO1xuICAgIHZhciBiYXNlVVJMO1xuICAgIGlmKCB3aW5kb3cubG9jYXRpb24uaG9zdG5hbWUuaW5kZXhPZignY29kZS5nbG9iYWxvcmlhLmNvbScpID4gLTEgKXtcbiAgICAgICAgYmFzZVVSTCA9ICdodHRwOi8vZ2xvYmFsb3JpYS5jb206ODAwMC8nO1xuICAgIH1lbHNlIGlmKCB3aW5kb3cubG9jYXRpb24uaG9zdG5hbWUuaW5kZXhPZignbWFrZXF1ZXN0Lmdsb2JhbG9yaWEuY29tJykgPiAtMSApe1xuICAgICAgICBiYXNlVVJMID0gJ2h0dHA6Ly9nbG9iYWxvcmlhLmNvbTo4MDAxLyc7XG4gICAgfWVsc2V7XG4gICAgICAgIGJhc2VVUkwgPSAnaHR0cHM6Ly9oYWNrcHViLmhlcm9rdWFwcC5jb20vYnVja2V0cy9nbG9iYWxvcmlhLyc7XG4gICAgfVxuICAgIFxuICAgICQuYWpheCh7XG4gICAgICB0eXBlOiAnUE9TVCcsXG4gICAgICB1cmw6IGJhc2VVUkwgKyAncHVibGlzaCcsXG4gICAgICBkYXRhOiB7XG4gICAgICAgICdodG1sJzogZ2VuZXJhdGVkSFRNTFxuICAgICAgfSxcbiAgICAgIGNyb3NzRG9tYWluOiB0cnVlLFxuICAgICAgZGF0YVR5cGU6ICdqc29uJyxcbiAgICAgIGVycm9yOiBmdW5jdGlvbigpIHtcbiAgICAgICAgYWxlcnQoXCJFcnJvciBwdWJsaXNoaW5nIEhUTUwhXCIpO1xuICAgICAgICBjb25zb2xlLmxvZyhhcmd1bWVudHMpO1xuICAgICAgfSxcbiAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgJChcIiNwdWJsaXNoZWRcIikuZmFkZUluKClcbiAgICAgICAgICAuZmluZCgnYScpXG4gICAgICAgICAgLmF0dHIoJ2hyZWYnLCBkYXRhWydwdWJsaXNoZWQtdXJsJ10pXG4gICAgICAgICAgLnRleHQoZGF0YVsncHVibGlzaGVkLXVybCddKTtcblxuICAgICAgICAvLyBEaXNhYmxlIFB1Ymxpc2ggYnV0dG9uIHRvIGF2b2lkIHB1Ymxpc2hpbmcgc3BhbVxuICAgICAgICAkKCdidXR0b25bdHlwZT1cInN1Ym1pdFwiXScpLmF0dHIoJ2Rpc2FibGVkJywgJ2Rpc2FibGVkJyk7XG5cbiAgICAgICAgLy8gY29kZS5nbG9iYWxvcmlhLmNvbSBPTkxZXG4gICAgICAgIC8vIC8vIFJlcGxhY2UgdGhlIGZvcm0ncyByZXR1cm4gVVJMIGFuZCBzdWJtaXQgdGhlIGZvcm1cbiAgICAgICAgLy8gJCgnI3B1Ymxpc2gtZm9ybSBpbnB1dCNyZXRVcmwnKS52YWwoIGRhdGFbJ3B1Ymxpc2hlZC11cmwnXSApO1xuICAgICAgICBcbiAgICAgICAgLy8gLy8gUG9wdWxhdGUgZ2FtZSBsaW5rIGZvciBzYWxlc2ZvcmNlIGNhcHR1cmVcbiAgICAgICAgLy8gJCgnIzAwTlUwMDAwMDA1UE43dCcpLnZhbChkYXRhWydwdWJsaXNoZWQtdXJsJ10pO1xuXG4gICAgICAgIC8vIC8vIFBvcHVsYXRlIHRoZSByb2xlIGZpZWxkIGZvciBzYWxlc2ZvcmNlXG4gICAgICAgIC8vIHZhciByb2xlID0gW107XG4gICAgICAgIC8vIGlmKCAkKCcjaXNTdHVkZW50JykucHJvcCgnY2hlY2tlZCcpICkgcm9sZS5wdXNoKCAkKCcjaXNTdHVkZW50JykudmFsKCkgKTtcbiAgICAgICAgLy8gaWYoICQoJyNpc1RlYWNoZXInKS5wcm9wKCdjaGVja2VkJykgKSByb2xlLnB1c2goICQoJyNpc1RlYWNoZXInKS52YWwoKSApO1xuICAgICAgICAvLyBpZiggJCgnI2lzUGFyZW50JykucHJvcCgnY2hlY2tlZCcpICkgcm9sZS5wdXNoKCAkKCcjaXNQYXJlbnQnKS52YWwoKSApO1xuICAgICAgICAvLyBpZiggJCgnI2lzQWRtaW5pc3RyYXRvcicpLnByb3AoJ2NoZWNrZWQnKSApIHJvbGUucHVzaCggJCgnI2lzQWRtaW5pc3RyYXRvcicpLnZhbCgpICk7XG4gICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAvLyAkKCcjMDBOVTAwMDAwMDVQaDJLJykudmFsKCByb2xlLmpvaW4oJywnKSApO1xuXG4gICAgICAgIC8vVW5iaW5kIGZvcm0gdG8gcHJldmVudCBzdWJtaXQgbG9vcFxuICAgICAgICAvLyAkKCcjcHVibGlzaC1mb3JtJykudW5iaW5kKCkuc3VibWl0KCk7XG5cblxuXG4gICAgICAgIC8vIG1ha3F1ZXN0Lmdsb2JhbG9yaWEuY29tIE9OTFlcbiAgICAgICAgLy8gd2luZG93LmxvY2F0aW9uLmhyZWYgPSAnZGF0YVsncHVibGlzaGVkLXVybCddJztcblxuXG5cbiAgICAgIH0sXG4gICAgICBjb21wbGV0ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICQoXCIjcHVibGlzaGluZ1wiKS5oaWRlKCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH0pO1xufVxuXG5mdW5jdGlvbiBsb2FkTWluaUNvdXJzZShjYil7XG4gICAgY2IgPSBjYiB8fCBmdW5jdGlvbigpIHt9XG4gICAgY29uc29sZS5sb2coXCJMb2FkaW5nIG1pbmkgY291cnNlIHRlbXBsYXRlXCIpO1xuICAgIHZhciB6ZXJvUGFkZGVkTGV2ZWwgPSAoY3VycmVudExldmVsIDwgMTApID8gJzAnICsgY3VycmVudExldmVsIDogY3VycmVudExldmVsO1xuXG4gICAgLy8gU2tpcCB0byBzYW5kYm94XG4gICAgaWYoIHN0b3JhZ2UuZ2V0KCdza2lwVG9TYW5kYm94JykgPT0gJ3RydWUnICl7XG4gICAgICAgIHplcm9QYWRkZWRMZXZlbCA9IG1heExldmVsO1xuICAgICAgICAkKFwiI2xldmVsTWVudVwiKS5jc3MoJ2Rpc3BsYXknLCAnbm9uZScpO1xuICAgIH1lbHNle1xuICAgICAgICAkKFwiI2xldmVsTWVudVwiKS5jc3MoJ2Rpc3BsYXknLCAnYmxvY2snKTtcbiAgICB9XG5cbiAgICB2YXIgY29kZVVybCA9ICdtaW5pL2xldmVscy8nICsgemVyb1BhZGRlZExldmVsICsgJy5qcyc7XG5cbiAgICAvLyBMb2FkIHJlbWl4IGNvZGUgZm9yIHNhbmRib3ggd2hlbiBhdmFpbGFibGVcbiAgICBpZiggcmVtaXhVcmwgJiYgc3RvcmFnZS5nZXQoJ3NraXBUb1NhbmRib3gnKSA9PSAndHJ1ZScgKXtcbiAgICAgICAgLy8gUHVsbCBnYW1lIGZyb20gZGV2IG9yIGxpdmUgKENPUlMgaXMgY3VycmVudGx5IGJyZWFraW5nIHB1bGxzIGZyb20gZ2xvYmFsb3JpYS1kZXYuczMpXG4gICAgICAgIGlmKHdpbmRvdy5sb2NhdGlvbi5ocmVmLm1hdGNoKC9jb2RlLmdsb2JhbG9yaWEuY29tLykpe1xuICAgICAgICAgICAgY29kZVVybCA9ICdodHRwOi8vbXljb2RlLmdsb2JhbG9yaWEuY29tLycrcmVtaXhVcmxbMV07XG4gICAgICAgIH1lbHNlIGlmKHdpbmRvdy5sb2NhdGlvbi5ocmVmLm1hdGNoKC9tYWtlcXVlc3QuZ2xvYmFsb3JpYS5jb20vKSl7XG4gICAgICAgICAgICBjb2RlVXJsID0gJ2h0dHA6Ly9teW1ha2VxdWVzdC5nbG9iYWxvcmlhLmNvbS8nK3JlbWl4VXJsWzFdO1xuICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgIGNvZGVVcmwgPSAnaHR0cDovL2dsb2JhbG9yaWEtZGV2LnMzLmFtYXpvbmF3cy5jb20vJytyZW1peFVybFsxXTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgICQuZ2V0KGNvZGVVcmwsIGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgLy8gRXh0cmFjdCBlZGl0b3IgY29kZSBmcm9tIHRoZSBwdWJsaXNoZWQgSFRNTCBkb2N1bWVudFxuICAgICAgICBpZihyZW1peFVybCl7XG4gICAgICAgICAgICBkZWJ1ZzIgPSBkYXRhO1xuICAgICAgICAgICAgdmFyIHJlbWl4Q29kZSA9IGRhdGEubWF0Y2goLzxzY3JpcHQgaWQ9XCJwdWJsaXNoZWQtbGV2ZWwtY29kZVwiPihbXFxzXFxTXSkrPzxcXC9zY3JpcHQ+L2cpO1xuICAgICAgICAgICAgaWYocmVtaXhDb2RlKXtcbiAgICAgICAgICAgICAgICAvLyBEYXRhIHNob3VsZCBvbmx5IGJlIHRoZSBlZGl0b3Igc3BlY2lmaWMgY29kZSAoaS5lLiB0aGUgY2FwdHVyZWQgZ3JvdXApXG4gICAgICAgICAgICAgICAgZGF0YSA9IHJlbWl4Q29kZVswXS5yZXBsYWNlKCc8c2NyaXB0IGlkPVwicHVibGlzaGVkLWxldmVsLWNvZGVcIj4nLCAnJykucmVwbGFjZSgnPC9zY3JpcHQ+JywgJycpO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiTkVXIERBVEFcIik7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coZGF0YSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgbWFya0hpbnRzID0gW107XG4gICAgICAgIHZhciByZWFkT25seVRva2VucyA9IFtdO1xuICAgICAgICB2YXIgcmVhZE9ubHlSYW5nZXMgPSBbXTtcbiAgICAgICAgdmFyIGZvbGRlZFJhbmdlcyA9IFtdO1xuICAgICAgICB2YXIgY3VyckxpbmVOdW1iZXIgPSAwO1xuICAgICAgICB2YXIgY3VyckluZGVudGF0aW9uID0gMDtcbiAgICAgICAgdmFyIGVkaXRvclRvb2x0aXBzID0gW107XG4gICAgICAgIHZhciBlZGl0b3JDb21tYW5kcyA9IHtcbiAgICAgICAgICAgIG1hcmtIaW50OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBtYXJrSGludHMucHVzaChhcmd1bWVudHMpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJlYWRPbmx5VG9rZW46IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgcmVhZE9ubHlUb2tlbnMucHVzaChhcmd1bWVudHMpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGJlZ2luUmVhZE9ubHk6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHJlYWRPbmx5UmFuZ2VzLnB1c2goW2N1cnJMaW5lTnVtYmVyXSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZW5kUmVhZE9ubHk6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHZhciBjdXJyUmFuZ2UgPSByZWFkT25seVJhbmdlc1tyZWFkT25seVJhbmdlcy5sZW5ndGggLSAxXTtcbiAgICAgICAgICAgICAgICBjdXJyUmFuZ2UucHVzaChjdXJyTGluZU51bWJlcik7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgYmVnaW5Db2RlRm9sZDogZnVuY3Rpb24obGlua1RleHQpIHtcbiAgICAgICAgICAgICAgICBmb2xkZWRSYW5nZXMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgIGJlZ2luOiBjdXJyTGluZU51bWJlcixcbiAgICAgICAgICAgICAgICAgICAgaW5kZW50YXRpb246IGN1cnJJbmRlbnRhdGlvbixcbiAgICAgICAgICAgICAgICAgICAgbGlua1RleHQ6IGxpbmtUZXh0IHx8ICdNb3JlXFx1MjAyNidcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBlbmRDb2RlRm9sZDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdmFyIGN1cnJSYW5nZSA9IGZvbGRlZFJhbmdlc1tmb2xkZWRSYW5nZXMubGVuZ3RoIC0gMV07XG4gICAgICAgICAgICAgICAgY3VyclJhbmdlLmVuZCA9IGN1cnJMaW5lTnVtYmVyO1xuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgaW5zZXJ0VG9vbHRpcDogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICBlZGl0b3JUb29sdGlwcy5wdXNoKGFyZ3VtZW50cyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc29sZS5sb2coXCJDb3Vyc2UgcmV0cmlldmVkOiBcIik7XG4gICAgICAgIGNvbnNvbGUubG9nKGRhdGEpO1xuXG4gICAgICAgIC8vIE5vcm1hbGl6ZSB3aGl0ZXNwYWNlIGlmIHdlJ3JlIG9uIHdpbmRvd3MuXG4gICAgICAgIGRhdGEgPSBkYXRhLnJlcGxhY2UoL1xcclxcbi9nLCAnXFxuJyk7XG5cbiAgICAgICAgLy8gV2Ugd2FudCB0byBtYWtlIGl0IGxlc3MgbGlrZWx5IHRoYXQgdGhlIHVzZXIgYWNjaWRlbnRhbGx5XG4gICAgICAgIC8vIGRlbGV0ZXMgdGhlIGNsb3NpbmcgYnJhY2Ugb2YgYSBmdW5jdGlvbiBkZWZpbml0aW9uIG9yIGFkZHNcbiAgICAgICAgLy8gY29kZSBhZnRlciBpdCwgc28gd2UnbGwgbW92ZSBpdCB3YXkgZG93biB0byB0aGUgYm90dG9tIG9mXG4gICAgICAgIC8vIHRoZSBmaWxlIHdpdGggcGxlbnR5IG9mIHdoaXRlLXNwYWNlIGluIGJldHdlZW4uXG4gICAgICAgIGRhdGEgPSBkYXRhLnJlcGxhY2UoL31cXG4qJC8sICdcXG5cXG5cXG5cXG5cXG5cXG5cXG5cXG5cXG5cXG59XFxuJyk7XG5cbiAgICAgICAgZGF0YSA9IGRhdGEuc3BsaXQoJ1xcbicpLmZpbHRlcihmdW5jdGlvbihsaW5lKSB7XG4gICAgICAgICAgICB2YXIgbWF0Y2ggPSBsaW5lLm1hdGNoKC8oXFxzKilcXC9cXC9cXHMqRURJVE9SOiguKikvKTtcbiAgICAgICAgICAgIGlmICghbWF0Y2gpIHtcbiAgICAgICAgICAgICAgICBjdXJyTGluZU51bWJlcisrO1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjdXJySW5kZW50YXRpb24gPSBtYXRjaFsxXTtcbiAgICAgICAgICAgIHdpdGggKGVkaXRvckNvbW1hbmRzKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJFeGVjdXRpbmcgZWRpdG9yIGNvbW1hbmQ6IFwiICsgbWF0Y2hbMl0pO1xuICAgICAgICAgICAgICAgIGV2YWwobWF0Y2hbMl0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH0pLmpvaW4oJ1xcbicpO1xuXG4gICAgICAgIG9yaWdpbmFsRWRpdG9yQ29udGVudCA9IGRhdGE7XG4gICAgICAgIGVkaXRvcl9qcy5zZXRWYWx1ZShkYXRhKTtcblxuICAgICAgICAvLyBNYWtlIHRoZSBmaXJzdCBsaW5lIHJlYWQtb25seS5cbiAgICAgICAgcmVhZE9ubHlSYW5nZXMucHVzaChbMCwgMV0pO1xuXG4gICAgICAgIC8vIE1ha2UgdGhlIGxhc3QgdHdvIGxpbmVzIHJlYWQtb25seS5cbiAgICAgICAgcmVhZE9ubHlSYW5nZXMucHVzaChbZWRpdG9yX2pzLmxpbmVDb3VudCgpIC0gMiwgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVkaXRvcl9qcy5saW5lQ291bnQoKV0pO1xuXG4gICAgICAgIHJlYWRPbmx5UmFuZ2VzLmZvckVhY2goZnVuY3Rpb24ocmFuZ2UpIHtcbiAgICAgICAgICAgIGVkaXRvcl9qcy5tYXJrVGV4dCh7bGluZTogcmFuZ2VbMF0sIGNoOiAwfSwge1xuICAgICAgICAgICAgICBsaW5lOiByYW5nZVsxXSxcbiAgICAgICAgICAgICAgY2g6IDBcbiAgICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgICAgY2xhc3NOYW1lOiAnanMtcmVhZC1vbmx5JyxcbiAgICAgICAgICAgICAgcmVhZE9ubHk6IHRydWVcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmVhZE9ubHlUb2tlbnMuZm9yRWFjaChmdW5jdGlvbihhcmd1bWVudHMpIHtcbiAgICAgICAgICAgIHJlYWRPbmx5VG9rZW4uYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgbWFya0hpbnRzLmZvckVhY2goZnVuY3Rpb24oYXJndW1lbnRzKSB7XG4gICAgICAgICAgICBtYXJrSGludC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgICB9KTtcblxuICAgICAgICAkKFwiI2pzX2VkaXRvclwiKS5yZW1vdmVDbGFzcygnc2hvdy1qcy1oaW50cycpO1xuXG4gICAgICAgIGlmIChtYXJrSGludHMubGVuZ3RoKSB7XG4gICAgICAgICAgICAkKFwiI3Nob3dIaW50c1wiKS5zaG93KCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAkKFwiI3Nob3dIaW50c1wiKS5oaWRlKCk7XG4gICAgICAgIH1cblxuICAgICAgICBmb2xkZWRSYW5nZXMuZm9yRWFjaChmdW5jdGlvbihyYW5nZSkge1xuICAgICAgICAgICAgdmFyIHN0YXJ0ID0ge2xpbmU6IHJhbmdlLmJlZ2luLCBjaDogMH07XG4gICAgICAgICAgICB2YXIgc3BhbiA9ICQoJzxzcGFuIGNsYXNzPVwiY20tY29tbWVudFwiPicgKyByYW5nZS5pbmRlbnRhdGlvbiArXG4gICAgICAgICAgICAgICAgICAgICAgICAgJy8vIDwvc3Bhbj4nKTtcbiAgICAgICAgICAgICQoJzxzcGFuIGNsYXNzPVwianMtY29kZS1mb2xkLWxpbmtcIj48L3NwYW4+JylcbiAgICAgICAgICAgICAgLnRleHQocmFuZ2UubGlua1RleHQpXG4gICAgICAgICAgICAgIC5hcHBlbmRUbyhzcGFuKTtcbiAgICAgICAgICAgIGVkaXRvcl9qcy5mb2xkQ29kZShzdGFydCwge1xuICAgICAgICAgICAgICAgIHdpZGdldDogc3BhblswXSxcbiAgICAgICAgICAgICAgICByYW5nZUZpbmRlcjogZnVuY3Rpb24oY20sIHBvcykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgZnJvbTogc3RhcnQsXG4gICAgICAgICAgICAgICAgICAgICAgICB0bzoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbmU6IHJhbmdlLmVuZCAtIDEsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2g6IGVkaXRvcl9qcy5nZXRMaW5lKHJhbmdlLmVuZCAtIDEpLmxlbmd0aFxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcblxuICAgICAgICBlZGl0b3JUb29sdGlwcy5mb3JFYWNoKGZ1bmN0aW9uKGFyZ3VtZW50cyl7XG4gICAgICAgICAgICBpbnNlcnRFZGl0b1Rvb2x0aXAuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgY2IoKTtcbiAgICB9KTtcbiAgICBcbiAgICAvLyBTZXQgc2Vzc2lvbiBzdG9yYWdlIGFuZCByZWxvYWQgdGhlIGlmcmFtZSB0byBiZSBzeW5jaGVkXG4gICAgc3RvcmFnZS5zZXQoJ2N1cnJlbnRMZXZlbCcsIGN1cnJlbnRMZXZlbCk7XG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3ByZXZpZXcnKS5jb250ZW50V2luZG93LmxvY2F0aW9uLnJlbG9hZCgpO1xufVxuXG5mdW5jdGlvbiBzaG93SGludHMoKSB7XG4gICAgJChcIiNqc19lZGl0b3JcIikuYWRkQ2xhc3MoJ3Nob3ctanMtaGludHMnKTtcbiAgICAkKFwiI3Nob3dIaW50c1wiKS5mYWRlT3V0KCk7XG59XG5cbmZ1bmN0aW9uIG5leHRMZXZlbCgpe1xuICAgIGN1cnJlbnRMZXZlbCA9PSBtYXhMZXZlbCA/IG1heExldmVsIDogY3VycmVudExldmVsKys7XG4gICAgXG4gICAgLy9VcGRhdGUgaWZyYW1lIHNvdXJjZVxuICAgIC8vICQoJ2lmcmFtZSNwcmV2aWV3JykuYXR0cignc3JjJywgJ3Byb2plY3RfdGVtcGxhdGUvaW5kZXgnK2N1cnJlbnRMZXZlbCsnLmh0bWwnKTtcbiAgICAvLyAkaW5zdHJ1Y3Rpb25zLmZpbmQoXCJoM1wiKS50ZXh0KGluc3RydWN0aW9uc1tcImxldmVsXCIrY3VycmVudExldmVsXS50aXRsZSk7XG4gICAgLy8gJGluc3RydWN0aW9ucy5maW5kKFwicFwiKS50ZXh0KGluc3RydWN0aW9uc1tcImxldmVsXCIrY3VycmVudExldmVsXS5jb250ZW50KTtcbiAgICBsb2FkTWluaUNvdXJzZSgpO1xufVxuXG5mdW5jdGlvbiBwcmV2TGV2ZWwoKXtcbiAgICBjdXJyZW50TGV2ZWwgPT0gMSA/IDEgOiBjdXJyZW50TGV2ZWwtLTtcbiAgICBcbiAgICAvL1VwZGF0ZSBpZnJhbWUgc291cmNlXG4gICAgLy8gJCgnaWZyYW1lI3ByZXZpZXcnKS5hdHRyKCdzcmMnLCAncHJvamVjdF90ZW1wbGF0ZS9pbmRleCcrY3VycmVudExldmVsKycuaHRtbCcpO1xuICAgIC8vICRpbnN0cnVjdGlvbnMuZmluZChcImgzXCIpLnRleHQoaW5zdHJ1Y3Rpb25zW1wibGV2ZWxcIitjdXJyZW50TGV2ZWxdLnRpdGxlKTtcbiAgICAvLyAkaW5zdHJ1Y3Rpb25zLmZpbmQoXCJwXCIpLnRleHQoaW5zdHJ1Y3Rpb25zW1wibGV2ZWxcIitjdXJyZW50TGV2ZWxdLmNvbnRlbnQpO1xuICAgIGxvYWRNaW5pQ291cnNlKCk7XG59XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
