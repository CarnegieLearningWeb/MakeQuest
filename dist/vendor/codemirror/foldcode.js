!function(n){"object"==typeof exports&&"object"==typeof module?n(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],n):n(CodeMirror)}(function(n){"use strict";function o(o,i,t,f){function l(n){var e=d(o,i);if(!e||e.to.line-e.from.line<u)return null;for(var r=o.findMarksAt(e.from),t=0;t<r.length;++t)if(r[t].__isFold&&"fold"!==f){if(!n)return null;e.cleared=!0,r[t].clear()}return e}if(t&&t.call){var d=t;t=null}else var d=r(o,t,"rangeFinder");"number"==typeof i&&(i=n.Pos(i,0));var u=r(o,t,"minFoldSize"),a=l(!0);if(r(o,t,"scanUp"))for(;!a&&i.line>o.firstLine();)i=n.Pos(i.line-1,0),a=l(!1);if(a&&!a.cleared&&"unfold"!==f){var c=e(o,t);n.on(c,"mousedown",function(o){s.clear(),n.e_preventDefault(o)});var s=o.markText(a.from,a.to,{replacedWith:c,clearOnEnter:!0,__isFold:!0});s.on("clear",function(e,r){n.signal(o,"unfold",o,e,r)}),n.signal(o,"fold",o,a.from,a.to)}}function e(n,o){var e=r(n,o,"widget");if("string"==typeof e){var i=document.createTextNode(e);e=document.createElement("span"),e.appendChild(i),e.className="CodeMirror-foldmarker"}return e}function r(n,o,e){if(o&&void 0!==o[e])return o[e];var r=n.options.foldOptions;return r&&void 0!==r[e]?r[e]:i[e]}n.newFoldFunction=function(n,e){return function(r,i){o(r,i,{rangeFinder:n,widget:e})}},n.defineExtension("foldCode",function(n,e,r){o(this,n,e,r)}),n.defineExtension("isFolded",function(n){for(var o=this.findMarksAt(n),e=0;e<o.length;++e)if(o[e].__isFold)return!0}),n.commands.toggleFold=function(n){n.foldCode(n.getCursor())},n.commands.fold=function(n){n.foldCode(n.getCursor(),null,"fold")},n.commands.unfold=function(n){n.foldCode(n.getCursor(),null,"unfold")},n.commands.foldAll=function(o){o.operation(function(){for(var e=o.firstLine(),r=o.lastLine();r>=e;e++)o.foldCode(n.Pos(e,0),null,"fold")})},n.commands.unfoldAll=function(o){o.operation(function(){for(var e=o.firstLine(),r=o.lastLine();r>=e;e++)o.foldCode(n.Pos(e,0),null,"unfold")})},n.registerHelper("fold","combine",function(){var n=Array.prototype.slice.call(arguments,0);return function(o,e){for(var r=0;r<n.length;++r){var i=n[r](o,e);if(i)return i}}}),n.registerHelper("fold","auto",function(n,o){for(var e=n.getHelpers(o,"fold"),r=0;r<e.length;r++){var i=e[r](n,o);if(i)return i}});var i={rangeFinder:n.fold.auto,widget:"â†”",minFoldSize:0,scanUp:!1};n.defineOption("foldOptions",null),n.defineExtension("foldOption",function(n,o){return r(this,n,o)})});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInZlbmRvci9jb2RlbWlycm9yL2ZvbGRjb2RlLmpzIl0sIm5hbWVzIjpbIm1vZCIsImV4cG9ydHMiLCJtb2R1bGUiLCJyZXF1aXJlIiwiZGVmaW5lIiwiYW1kIiwiQ29kZU1pcnJvciIsImRvRm9sZCIsImNtIiwicG9zIiwib3B0aW9ucyIsImZvcmNlIiwiZ2V0UmFuZ2UiLCJhbGxvd0ZvbGRlZCIsInJhbmdlIiwiZmluZGVyIiwidG8iLCJsaW5lIiwiZnJvbSIsIm1pblNpemUiLCJtYXJrcyIsImZpbmRNYXJrc0F0IiwiaSIsImxlbmd0aCIsIl9faXNGb2xkIiwiY2xlYXJlZCIsImNsZWFyIiwiY2FsbCIsImdldE9wdGlvbiIsIlBvcyIsImZpcnN0TGluZSIsIm15V2lkZ2V0IiwibWFrZVdpZGdldCIsIm9uIiwiZSIsIm15UmFuZ2UiLCJlX3ByZXZlbnREZWZhdWx0IiwibWFya1RleHQiLCJyZXBsYWNlZFdpdGgiLCJjbGVhck9uRW50ZXIiLCJzaWduYWwiLCJ3aWRnZXQiLCJ0ZXh0IiwiZG9jdW1lbnQiLCJjcmVhdGVUZXh0Tm9kZSIsImNyZWF0ZUVsZW1lbnQiLCJhcHBlbmRDaGlsZCIsImNsYXNzTmFtZSIsIm5hbWUiLCJ1bmRlZmluZWQiLCJlZGl0b3JPcHRpb25zIiwiZm9sZE9wdGlvbnMiLCJkZWZhdWx0T3B0aW9ucyIsIm5ld0ZvbGRGdW5jdGlvbiIsInJhbmdlRmluZGVyIiwiZGVmaW5lRXh0ZW5zaW9uIiwidGhpcyIsImNvbW1hbmRzIiwidG9nZ2xlRm9sZCIsImZvbGRDb2RlIiwiZ2V0Q3Vyc29yIiwiZm9sZCIsInVuZm9sZCIsImZvbGRBbGwiLCJvcGVyYXRpb24iLCJsYXN0TGluZSIsInVuZm9sZEFsbCIsInJlZ2lzdGVySGVscGVyIiwiZnVuY3MiLCJBcnJheSIsInByb3RvdHlwZSIsInNsaWNlIiwiYXJndW1lbnRzIiwic3RhcnQiLCJmb3VuZCIsImhlbHBlcnMiLCJnZXRIZWxwZXJzIiwiY3VyIiwiYXV0byIsIm1pbkZvbGRTaXplIiwi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SyxHQURERSxHQUFVbkUsRUFBR29FLFdBQVdILEVBQU8sUUFDMUJuRCxFQUFJLEVBQUdBLEVBQUlxRCxFQUFRcEQsT0FBUUQsSUFBSyxDQUN2QyxHQUFJdUQsR0FBTUYsRUFBUXJELEdBQUdkLEVBQUlpRSxFQUN6QixJQUFJSSxFQUFLLE1BQU9BLEtBSXBCLElBQUl6QixJQUNGRSxZQUFhaEQsRUFBV3VELEtBQUtpQixLQUM3QnJDLE9BQVEsSUFDUnNDLFlBQWEsRUFDYkMsUUFBUSxFQUdWMUUsR0FBVzJFLGFBQWEsY0FBZSxNQVd2QzNFLEVBQVdpRCxnQkFBZ0IsYUFBYyxTQUFTN0MsRUFBU3NDLEdBQ3pELE1BQU9wQixHQUFVNEIsS0FBTTlDLEVBQVNzQyIsImZpbGUiOiJ2ZW5kb3IvY29kZW1pcnJvci9mb2xkY29kZS5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vIENvZGVNaXJyb3IsIGNvcHlyaWdodCAoYykgYnkgTWFyaWpuIEhhdmVyYmVrZSBhbmQgb3RoZXJzXG4vLyBEaXN0cmlidXRlZCB1bmRlciBhbiBNSVQgbGljZW5zZTogaHR0cDovL2NvZGVtaXJyb3IubmV0L0xJQ0VOU0VcblxuKGZ1bmN0aW9uKG1vZCkge1xuICBpZiAodHlwZW9mIGV4cG9ydHMgPT0gXCJvYmplY3RcIiAmJiB0eXBlb2YgbW9kdWxlID09IFwib2JqZWN0XCIpIC8vIENvbW1vbkpTXG4gICAgbW9kKHJlcXVpcmUoXCIuLi8uLi9saWIvY29kZW1pcnJvclwiKSk7XG4gIGVsc2UgaWYgKHR5cGVvZiBkZWZpbmUgPT0gXCJmdW5jdGlvblwiICYmIGRlZmluZS5hbWQpIC8vIEFNRFxuICAgIGRlZmluZShbXCIuLi8uLi9saWIvY29kZW1pcnJvclwiXSwgbW9kKTtcbiAgZWxzZSAvLyBQbGFpbiBicm93c2VyIGVudlxuICAgIG1vZChDb2RlTWlycm9yKTtcbn0pKGZ1bmN0aW9uKENvZGVNaXJyb3IpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgZnVuY3Rpb24gZG9Gb2xkKGNtLCBwb3MsIG9wdGlvbnMsIGZvcmNlKSB7XG4gICAgaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5jYWxsKSB7XG4gICAgICB2YXIgZmluZGVyID0gb3B0aW9ucztcbiAgICAgIG9wdGlvbnMgPSBudWxsO1xuICAgIH0gZWxzZSB7XG4gICAgICB2YXIgZmluZGVyID0gZ2V0T3B0aW9uKGNtLCBvcHRpb25zLCBcInJhbmdlRmluZGVyXCIpO1xuICAgIH1cbiAgICBpZiAodHlwZW9mIHBvcyA9PSBcIm51bWJlclwiKSBwb3MgPSBDb2RlTWlycm9yLlBvcyhwb3MsIDApO1xuICAgIHZhciBtaW5TaXplID0gZ2V0T3B0aW9uKGNtLCBvcHRpb25zLCBcIm1pbkZvbGRTaXplXCIpO1xuXG4gICAgZnVuY3Rpb24gZ2V0UmFuZ2UoYWxsb3dGb2xkZWQpIHtcbiAgICAgIHZhciByYW5nZSA9IGZpbmRlcihjbSwgcG9zKTtcbiAgICAgIGlmICghcmFuZ2UgfHwgcmFuZ2UudG8ubGluZSAtIHJhbmdlLmZyb20ubGluZSA8IG1pblNpemUpIHJldHVybiBudWxsO1xuICAgICAgdmFyIG1hcmtzID0gY20uZmluZE1hcmtzQXQocmFuZ2UuZnJvbSk7XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG1hcmtzLmxlbmd0aDsgKytpKSB7XG4gICAgICAgIGlmIChtYXJrc1tpXS5fX2lzRm9sZCAmJiBmb3JjZSAhPT0gXCJmb2xkXCIpIHtcbiAgICAgICAgICBpZiAoIWFsbG93Rm9sZGVkKSByZXR1cm4gbnVsbDtcbiAgICAgICAgICByYW5nZS5jbGVhcmVkID0gdHJ1ZTtcbiAgICAgICAgICBtYXJrc1tpXS5jbGVhcigpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gcmFuZ2U7XG4gICAgfVxuXG4gICAgdmFyIHJhbmdlID0gZ2V0UmFuZ2UodHJ1ZSk7XG4gICAgaWYgKGdldE9wdGlvbihjbSwgb3B0aW9ucywgXCJzY2FuVXBcIikpIHdoaWxlICghcmFuZ2UgJiYgcG9zLmxpbmUgPiBjbS5maXJzdExpbmUoKSkge1xuICAgICAgcG9zID0gQ29kZU1pcnJvci5Qb3MocG9zLmxpbmUgLSAxLCAwKTtcbiAgICAgIHJhbmdlID0gZ2V0UmFuZ2UoZmFsc2UpO1xuICAgIH1cbiAgICBpZiAoIXJhbmdlIHx8IHJhbmdlLmNsZWFyZWQgfHwgZm9yY2UgPT09IFwidW5mb2xkXCIpIHJldHVybjtcblxuICAgIHZhciBteVdpZGdldCA9IG1ha2VXaWRnZXQoY20sIG9wdGlvbnMpO1xuICAgIENvZGVNaXJyb3Iub24obXlXaWRnZXQsIFwibW91c2Vkb3duXCIsIGZ1bmN0aW9uKGUpIHtcbiAgICAgIG15UmFuZ2UuY2xlYXIoKTtcbiAgICAgIENvZGVNaXJyb3IuZV9wcmV2ZW50RGVmYXVsdChlKTtcbiAgICB9KTtcbiAgICB2YXIgbXlSYW5nZSA9IGNtLm1hcmtUZXh0KHJhbmdlLmZyb20sIHJhbmdlLnRvLCB7XG4gICAgICByZXBsYWNlZFdpdGg6IG15V2lkZ2V0LFxuICAgICAgY2xlYXJPbkVudGVyOiB0cnVlLFxuICAgICAgX19pc0ZvbGQ6IHRydWVcbiAgICB9KTtcbiAgICBteVJhbmdlLm9uKFwiY2xlYXJcIiwgZnVuY3Rpb24oZnJvbSwgdG8pIHtcbiAgICAgIENvZGVNaXJyb3Iuc2lnbmFsKGNtLCBcInVuZm9sZFwiLCBjbSwgZnJvbSwgdG8pO1xuICAgIH0pO1xuICAgIENvZGVNaXJyb3Iuc2lnbmFsKGNtLCBcImZvbGRcIiwgY20sIHJhbmdlLmZyb20sIHJhbmdlLnRvKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIG1ha2VXaWRnZXQoY20sIG9wdGlvbnMpIHtcbiAgICB2YXIgd2lkZ2V0ID0gZ2V0T3B0aW9uKGNtLCBvcHRpb25zLCBcIndpZGdldFwiKTtcbiAgICBpZiAodHlwZW9mIHdpZGdldCA9PSBcInN0cmluZ1wiKSB7XG4gICAgICB2YXIgdGV4dCA9IGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKHdpZGdldCk7XG4gICAgICB3aWRnZXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic3BhblwiKTtcbiAgICAgIHdpZGdldC5hcHBlbmRDaGlsZCh0ZXh0KTtcbiAgICAgIHdpZGdldC5jbGFzc05hbWUgPSBcIkNvZGVNaXJyb3ItZm9sZG1hcmtlclwiO1xuICAgIH1cbiAgICByZXR1cm4gd2lkZ2V0O1xuICB9XG5cbiAgLy8gQ2x1bXN5IGJhY2t3YXJkcy1jb21wYXRpYmxlIGludGVyZmFjZVxuICBDb2RlTWlycm9yLm5ld0ZvbGRGdW5jdGlvbiA9IGZ1bmN0aW9uKHJhbmdlRmluZGVyLCB3aWRnZXQpIHtcbiAgICByZXR1cm4gZnVuY3Rpb24oY20sIHBvcykgeyBkb0ZvbGQoY20sIHBvcywge3JhbmdlRmluZGVyOiByYW5nZUZpbmRlciwgd2lkZ2V0OiB3aWRnZXR9KTsgfTtcbiAgfTtcblxuICAvLyBOZXctc3R5bGUgaW50ZXJmYWNlXG4gIENvZGVNaXJyb3IuZGVmaW5lRXh0ZW5zaW9uKFwiZm9sZENvZGVcIiwgZnVuY3Rpb24ocG9zLCBvcHRpb25zLCBmb3JjZSkge1xuICAgIGRvRm9sZCh0aGlzLCBwb3MsIG9wdGlvbnMsIGZvcmNlKTtcbiAgfSk7XG5cbiAgQ29kZU1pcnJvci5kZWZpbmVFeHRlbnNpb24oXCJpc0ZvbGRlZFwiLCBmdW5jdGlvbihwb3MpIHtcbiAgICB2YXIgbWFya3MgPSB0aGlzLmZpbmRNYXJrc0F0KHBvcyk7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBtYXJrcy5sZW5ndGg7ICsraSlcbiAgICAgIGlmIChtYXJrc1tpXS5fX2lzRm9sZCkgcmV0dXJuIHRydWU7XG4gIH0pO1xuXG4gIENvZGVNaXJyb3IuY29tbWFuZHMudG9nZ2xlRm9sZCA9IGZ1bmN0aW9uKGNtKSB7XG4gICAgY20uZm9sZENvZGUoY20uZ2V0Q3Vyc29yKCkpO1xuICB9O1xuICBDb2RlTWlycm9yLmNvbW1hbmRzLmZvbGQgPSBmdW5jdGlvbihjbSkge1xuICAgIGNtLmZvbGRDb2RlKGNtLmdldEN1cnNvcigpLCBudWxsLCBcImZvbGRcIik7XG4gIH07XG4gIENvZGVNaXJyb3IuY29tbWFuZHMudW5mb2xkID0gZnVuY3Rpb24oY20pIHtcbiAgICBjbS5mb2xkQ29kZShjbS5nZXRDdXJzb3IoKSwgbnVsbCwgXCJ1bmZvbGRcIik7XG4gIH07XG4gIENvZGVNaXJyb3IuY29tbWFuZHMuZm9sZEFsbCA9IGZ1bmN0aW9uKGNtKSB7XG4gICAgY20ub3BlcmF0aW9uKGZ1bmN0aW9uKCkge1xuICAgICAgZm9yICh2YXIgaSA9IGNtLmZpcnN0TGluZSgpLCBlID0gY20ubGFzdExpbmUoKTsgaSA8PSBlOyBpKyspXG4gICAgICAgIGNtLmZvbGRDb2RlKENvZGVNaXJyb3IuUG9zKGksIDApLCBudWxsLCBcImZvbGRcIik7XG4gICAgfSk7XG4gIH07XG4gIENvZGVNaXJyb3IuY29tbWFuZHMudW5mb2xkQWxsID0gZnVuY3Rpb24oY20pIHtcbiAgICBjbS5vcGVyYXRpb24oZnVuY3Rpb24oKSB7XG4gICAgICBmb3IgKHZhciBpID0gY20uZmlyc3RMaW5lKCksIGUgPSBjbS5sYXN0TGluZSgpOyBpIDw9IGU7IGkrKylcbiAgICAgICAgY20uZm9sZENvZGUoQ29kZU1pcnJvci5Qb3MoaSwgMCksIG51bGwsIFwidW5mb2xkXCIpO1xuICAgIH0pO1xuICB9O1xuXG4gIENvZGVNaXJyb3IucmVnaXN0ZXJIZWxwZXIoXCJmb2xkXCIsIFwiY29tYmluZVwiLCBmdW5jdGlvbigpIHtcbiAgICB2YXIgZnVuY3MgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDApO1xuICAgIHJldHVybiBmdW5jdGlvbihjbSwgc3RhcnQpIHtcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZnVuY3MubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgdmFyIGZvdW5kID0gZnVuY3NbaV0oY20sIHN0YXJ0KTtcbiAgICAgICAgaWYgKGZvdW5kKSByZXR1cm4gZm91bmQ7XG4gICAgICB9XG4gICAgfTtcbiAgfSk7XG5cbiAgQ29kZU1pcnJvci5yZWdpc3RlckhlbHBlcihcImZvbGRcIiwgXCJhdXRvXCIsIGZ1bmN0aW9uKGNtLCBzdGFydCkge1xuICAgIHZhciBoZWxwZXJzID0gY20uZ2V0SGVscGVycyhzdGFydCwgXCJmb2xkXCIpO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaGVscGVycy5sZW5ndGg7IGkrKykge1xuICAgICAgdmFyIGN1ciA9IGhlbHBlcnNbaV0oY20sIHN0YXJ0KTtcbiAgICAgIGlmIChjdXIpIHJldHVybiBjdXI7XG4gICAgfVxuICB9KTtcblxuICB2YXIgZGVmYXVsdE9wdGlvbnMgPSB7XG4gICAgcmFuZ2VGaW5kZXI6IENvZGVNaXJyb3IuZm9sZC5hdXRvLFxuICAgIHdpZGdldDogXCJcXHUyMTk0XCIsXG4gICAgbWluRm9sZFNpemU6IDAsXG4gICAgc2NhblVwOiBmYWxzZVxuICB9O1xuXG4gIENvZGVNaXJyb3IuZGVmaW5lT3B0aW9uKFwiZm9sZE9wdGlvbnNcIiwgbnVsbCk7XG5cbiAgZnVuY3Rpb24gZ2V0T3B0aW9uKGNtLCBvcHRpb25zLCBuYW1lKSB7XG4gICAgaWYgKG9wdGlvbnMgJiYgb3B0aW9uc1tuYW1lXSAhPT0gdW5kZWZpbmVkKVxuICAgICAgcmV0dXJuIG9wdGlvbnNbbmFtZV07XG4gICAgdmFyIGVkaXRvck9wdGlvbnMgPSBjbS5vcHRpb25zLmZvbGRPcHRpb25zO1xuICAgIGlmIChlZGl0b3JPcHRpb25zICYmIGVkaXRvck9wdGlvbnNbbmFtZV0gIT09IHVuZGVmaW5lZClcbiAgICAgIHJldHVybiBlZGl0b3JPcHRpb25zW25hbWVdO1xuICAgIHJldHVybiBkZWZhdWx0T3B0aW9uc1tuYW1lXTtcbiAgfVxuXG4gIENvZGVNaXJyb3IuZGVmaW5lRXh0ZW5zaW9uKFwiZm9sZE9wdGlvblwiLCBmdW5jdGlvbihvcHRpb25zLCBuYW1lKSB7XG4gICAgcmV0dXJuIGdldE9wdGlvbih0aGlzLCBvcHRpb25zLCBuYW1lKTtcbiAgfSk7XG59KTtcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
